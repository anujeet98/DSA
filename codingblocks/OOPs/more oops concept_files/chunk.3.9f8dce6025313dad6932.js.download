(window.webpackJsonp_ember_auto_import_=window.webpackJsonp_ember_auto_import_||[]).push([[3],{149:function(t,e,n){var r,i
function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(o,s,a){t.exports?t.exports=s():"function"==typeof a.define&&a.define.amd?void 0===(i="function"==typeof(r=s)?r.call(e,n,e,t):r)||(t.exports=i):a.Firepad=s()}(0,(function(){function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,n){if(t){if("string"==typeof t)return e(t,n)
var r=Object.prototype.toString.call(t).slice(8,-1)
return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length)
for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n]
return r}(r=r||{}).utils={},r.utils.makeEventEmitter=function(t,e){t.prototype.allowedEvents_=e,t.prototype.on=function(t,e,n){this.validateEventType_(t),this.eventListeners_=this.eventListeners_||{},this.eventListeners_[t]=this.eventListeners_[t]||[],this.eventListeners_[t].push({callback:e,context:n})},t.prototype.off=function(t,e){this.validateEventType_(t),this.eventListeners_=this.eventListeners_||{}
for(var n=this.eventListeners_[t]||[],r=0;r<n.length;r++)if(n[r].callback===e)return void n.splice(r,1)},t.prototype.trigger=function(t){this.eventListeners_=this.eventListeners_||{}
for(var e=this.eventListeners_[t]||[],n=0;n<e.length;n++)e[n].callback.apply(e[n].context,Array.prototype.slice.call(arguments,1))},t.prototype.validateEventType_=function(t){if(this.allowedEvents_){for(var e=!1,n=0;n<this.allowedEvents_.length;n++)if(this.allowedEvents_[n]===t){e=!0
break}if(!e)throw new Error('Unknown event "'+t+'"')}}},r.utils.elt=function(t,e,n){var i=document.createElement(t)
if("string"==typeof e)r.utils.setTextContent(i,e)
else if(e)for(var o=0;o<e.length;++o)i.appendChild(e[o])
for(var s in n||{})i.setAttribute(s,n[s])
return i},r.utils.setTextContent=function(t,e){t.innerHTML="",t.appendChild(document.createTextNode(e))},r.utils.on=function(t,e,n,r){t.addEventListener?t.addEventListener(e,n,r||!1):t.attachEvent&&t.attachEvent("on"+e,n)},r.utils.off=function(t,e,n,r){t.removeEventListener?t.removeEventListener(e,n,r||!1):t.detachEvent&&t.detachEvent("on"+e,n)},r.utils.preventDefault=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},r.utils.stopPropagation=function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},r.utils.stopEvent=function(t){r.utils.preventDefault(t),r.utils.stopPropagation(t)},r.utils.stopEventAnd=function(t){return function(e){return t(e),r.utils.stopEvent(e),!1}},r.utils.trim=function(t){return t.replace(/^\s+/g,"").replace(/\s+$/g,"")},r.utils.stringEndsWith=function(t,e){for(var n="string"==typeof e?[e]:e,r=0;r<n.length;r++)if(e=n[r],-1!==t.indexOf(e,t.length-e.length))return!0
return!1},r.utils.assert=function(t,e){if(!t)throw new Error(e||"assertion error")},r.utils.log=function(){if("undefined"!=typeof console&&void 0!==console.log){for(var t=["Firepad:"],e=0;e<arguments.length;e++)t.push(arguments[e])
console.log.apply(console,t)}},(r=r||{}).Span=function(){function t(t,e){this.pos=t,this.length=e}return t.prototype.end=function(){return this.pos+this.length},t}(),(r=r||{}).TextOp=function(){var t=r.utils
function e(e){this.type=e,this.chars=null,this.text=null,this.attributes=null,"insert"===e?(this.text=arguments[1],t.assert("string"==typeof this.text),this.attributes=arguments[2]||{},t.assert("object"==o(this.attributes))):"delete"===e?(this.chars=arguments[1],t.assert("number"==typeof this.chars)):"retain"===e&&(this.chars=arguments[1],t.assert("number"==typeof this.chars),this.attributes=arguments[2]||{},t.assert("object"==o(this.attributes)))}return e.prototype.isInsert=function(){return"insert"===this.type},e.prototype.isDelete=function(){return"delete"===this.type},e.prototype.isRetain=function(){return"retain"===this.type},e.prototype.equals=function(t){return this.type===t.type&&this.text===t.text&&this.chars===t.chars&&this.attributesEqual(t.attributes)},e.prototype.attributesEqual=function(t){for(var e in this.attributes)if(this.attributes[e]!==t[e])return!1
for(e in t)if(this.attributes[e]!==t[e])return!1
return!0},e.prototype.hasEmptyAttributes=function(){var t=!0
for(var e in this.attributes){t=!1
break}return t},e}(),(r=r||{}).TextOperation=function(){"use strict"
var t=r.TextOp,e=r.utils
function n(){if(!this||this.constructor!==n)return new n
this.ops=[],this.baseLength=0,this.targetLength=0}function i(t){var e=t.ops
switch(e.length){case 1:return e[0]
case 2:return e[0].isRetain()?e[1]:e[1].isRetain()?e[0]:null
case 3:if(e[0].isRetain()&&e[2].isRetain())return e[1]}return null}function s(t){return t.ops[0].isRetain()?t.ops[0].chars:0}return n.prototype.equals=function(t){if(this.baseLength!==t.baseLength)return!1
if(this.targetLength!==t.targetLength)return!1
if(this.ops.length!==t.ops.length)return!1
for(var e=0;e<this.ops.length;e++)if(!this.ops[e].equals(t.ops[e]))return!1
return!0},n.prototype.retain=function(e,n){if("number"!=typeof e||e<0)throw new Error("retain expects a positive integer.")
if(0===e)return this
this.baseLength+=e,this.targetLength+=e,n=n||{}
var r=this.ops.length>0?this.ops[this.ops.length-1]:null
return r&&r.isRetain()&&r.attributesEqual(n)?r.chars+=e:this.ops.push(new t("retain",e,n)),this},n.prototype.insert=function(e,n){if("string"!=typeof e)throw new Error("insert expects a string")
if(""===e)return this
n=n||{},this.targetLength+=e.length
var r=this.ops.length>0?this.ops[this.ops.length-1]:null,i=this.ops.length>1?this.ops[this.ops.length-2]:null
return r&&r.isInsert()&&r.attributesEqual(n)?r.text+=e:r&&r.isDelete()?i&&i.isInsert()&&i.attributesEqual(n)?i.text+=e:(this.ops[this.ops.length-1]=new t("insert",e,n),this.ops.push(r)):this.ops.push(new t("insert",e,n)),this},n.prototype.delete=function(e){if("string"==typeof e&&(e=e.length),"number"!=typeof e||e<0)throw new Error("delete expects a positive integer or a string")
if(0===e)return this
this.baseLength+=e
var n=this.ops.length>0?this.ops[this.ops.length-1]:null
return n&&n.isDelete()?n.chars+=e:this.ops.push(new t("delete",e)),this},n.prototype.isNoop=function(){return 0===this.ops.length||1===this.ops.length&&this.ops[0].isRetain()&&this.ops[0].hasEmptyAttributes()},n.prototype.clone=function(){for(var t=new n,e=0;e<this.ops.length;e++)this.ops[e].isRetain()?t.retain(this.ops[e].chars,this.ops[e].attributes):this.ops[e].isInsert()?t.insert(this.ops[e].text,this.ops[e].attributes):t.delete(this.ops[e].chars)
return t},n.prototype.toString=function(){return(Array.prototype.map||function(t){for(var e=[],n=0,r=this.length;n<r;n++)e[n]=t(this[n])
return e}).call(this.ops,(function(t){return t.isRetain()?"retain "+t.chars:t.isInsert()?"insert '"+t.text+"'":"delete "+t.chars})).join(", ")},n.prototype.toJSON=function(){for(var t=[],e=0;e<this.ops.length;e++)this.ops[e].hasEmptyAttributes()||t.push(this.ops[e].attributes),"retain"===this.ops[e].type?t.push(this.ops[e].chars):"insert"===this.ops[e].type?t.push(this.ops[e].text):"delete"===this.ops[e].type&&t.push(-this.ops[e].chars)
return 0===t.length&&t.push(0),t},n.fromJSON=function(t){for(var r=new n,i=0,s=t.length;i<s;i++){var a=t[i],u={}
"object"==o(a)&&(u=a,a=t[++i]),"number"==typeof a?a>0?r.retain(a,u):r.delete(-a):(e.assert("string"==typeof a),r.insert(a,u))}return r},n.prototype.apply=function(t,n,r){if(n=n||[],r=r||[],t.length!==this.baseLength)throw new Error("The operation's base length must be equal to the string's length.")
for(var i,o,s=[],a=0,u=0,h=this.ops,c=0,l=h.length;c<l;c++){var p=h[c]
if(p.isRetain()){if(u+p.chars>t.length)throw new Error("Operation can't retain more characters than are left in the string.")
for(s[a++]=t.slice(u,u+p.chars),i=0;i<p.chars;i++){var d=n[u+i]||{},f={}
for(o in d)f[o]=d[o],e.assert(!1!==f[o])
for(o in p.attributes)!1===p.attributes[o]?delete f[o]:f[o]=p.attributes[o],e.assert(!1!==f[o])
r.push(f)}u+=p.chars}else if(p.isInsert())for(s[a++]=p.text,i=0;i<p.text.length;i++){var y={}
for(o in p.attributes)y[o]=p.attributes[o],e.assert(!1!==y[o])
r.push(y)}else u+=p.chars}if(u!==t.length)throw new Error("The operation didn't operate on the whole string.")
var g=s.join("")
return e.assert(g.length===r.length),g},n.prototype.invert=function(t){for(var e=0,r=new n,i=this.ops,o=0,s=i.length;o<s;o++){var a=i[o]
a.isRetain()?(r.retain(a.chars),e+=a.chars):a.isInsert()?r.delete(a.text.length):(r.insert(t.slice(e,e+a.chars)),e+=a.chars)}return r},n.prototype.compose=function(t){if(this.targetLength!==t.baseLength)throw new Error("The base length of the second operation has to be the target length of the first operation")
function e(t,e,n){var r,i={}
for(r in t)i[r]=t[r]
for(r in e)n&&!1===e[r]?delete i[r]:i[r]=e[r]
return i}for(var r,i=new n,o=this.clone().ops,s=t.clone().ops,a=0,u=0,h=o[a++],c=s[u++];void 0!==h||void 0!==c;)if(h&&h.isDelete())i.delete(h.chars),h=o[a++]
else if(c&&c.isInsert())i.insert(c.text,c.attributes),c=s[u++]
else{if(void 0===h)throw new Error("Cannot compose operations: first operation is too short.")
if(void 0===c)throw new Error("Cannot compose operations: first operation is too long.")
if(h.isRetain()&&c.isRetain())r=e(h.attributes,c.attributes),h.chars>c.chars?(i.retain(c.chars,r),h.chars-=c.chars,c=s[u++]):h.chars===c.chars?(i.retain(h.chars,r),h=o[a++],c=s[u++]):(i.retain(h.chars,r),c.chars-=h.chars,h=o[a++])
else if(h.isInsert()&&c.isDelete())h.text.length>c.chars?(h.text=h.text.slice(c.chars),c=s[u++]):h.text.length===c.chars?(h=o[a++],c=s[u++]):(c.chars-=h.text.length,h=o[a++])
else if(h.isInsert()&&c.isRetain())r=e(h.attributes,c.attributes,!0),h.text.length>c.chars?(i.insert(h.text.slice(0,c.chars),r),h.text=h.text.slice(c.chars),c=s[u++]):h.text.length===c.chars?(i.insert(h.text,r),h=o[a++],c=s[u++]):(i.insert(h.text,r),c.chars-=h.text.length,h=o[a++])
else{if(!h.isRetain()||!c.isDelete())throw new Error("This shouldn't happen: op1: "+JSON.stringify(h)+", op2: "+JSON.stringify(c))
h.chars>c.chars?(i.delete(c.chars),h.chars-=c.chars,c=s[u++]):h.chars===c.chars?(i.delete(c.chars),h=o[a++],c=s[u++]):(i.delete(h.chars),c.chars-=h.chars,h=o[a++])}}return i},n.prototype.shouldBeComposedWith=function(t){if(this.isNoop()||t.isNoop())return!0
var e=s(this),n=s(t),r=i(this),o=i(t)
return!(!r||!o||(r.isInsert()&&o.isInsert()?e+r.text.length!==n:!r.isDelete()||!o.isDelete()||n+o.chars!==e&&e!==n))},n.prototype.shouldBeComposedWithInverted=function(t){if(this.isNoop()||t.isNoop())return!0
var e=s(this),n=s(t),r=i(this),o=i(t)
return!!(r&&o&&(r.isInsert()&&o.isInsert()?e+r.text.length===n||e===n:r.isDelete()&&o.isDelete()&&n+o.chars===e))},n.transformAttributes=function(t,n){var r,i={},o={},s={}
for(r in t)s[r]=!0
for(r in n)s[r]=!0
for(r in s){var a=t[r],u=n[r]
e.assert(null!=a||null!=u),null==a?o[r]=u:null==u?i[r]=a:a===u||(i[r]=a)}return[i,o]},n.transform=function(t,e){if(t.baseLength!==e.baseLength)throw new Error("Both operations have to have the same base length")
for(var r=new n,i=new n,o=t.clone().ops,s=e.clone().ops,a=0,u=0,h=o[a++],c=s[u++];void 0!==h||void 0!==c;)if(h&&h.isInsert())r.insert(h.text,h.attributes),i.retain(h.text.length),h=o[a++]
else if(c&&c.isInsert())r.retain(c.text.length),i.insert(c.text,c.attributes),c=s[u++]
else{if(void 0===h)throw new Error("Cannot transform operations: first operation is too short.")
if(void 0===c)throw new Error("Cannot transform operations: first operation is too long.")
var l
if(h.isRetain()&&c.isRetain()){var p=n.transformAttributes(h.attributes,c.attributes)
h.chars>c.chars?(l=c.chars,h.chars-=c.chars,c=s[u++]):h.chars===c.chars?(l=c.chars,h=o[a++],c=s[u++]):(l=h.chars,c.chars-=h.chars,h=o[a++]),r.retain(l,p[0]),i.retain(l,p[1])}else if(h.isDelete()&&c.isDelete())h.chars>c.chars?(h.chars-=c.chars,c=s[u++]):h.chars===c.chars?(h=o[a++],c=s[u++]):(c.chars-=h.chars,h=o[a++])
else if(h.isDelete()&&c.isRetain())h.chars>c.chars?(l=c.chars,h.chars-=c.chars,c=s[u++]):h.chars===c.chars?(l=c.chars,h=o[a++],c=s[u++]):(l=h.chars,c.chars-=h.chars,h=o[a++]),r.delete(l)
else{if(!h.isRetain()||!c.isDelete())throw new Error("The two operations aren't compatible")
h.chars>c.chars?(l=c.chars,h.chars-=c.chars,c=s[u++]):h.chars===c.chars?(l=h.chars,h=o[a++],c=s[u++]):(l=h.chars,c.chars-=h.chars,h=o[a++]),i.delete(l)}}return[r,i]},n.prototype.transform=function(t){return n.transform(this,t)},n}(),(r=r||{}).AnnotationList=function(){var t=r.Span
function e(t,e){if(!t)throw new Error("AnnotationList assertion failed"+(e?": "+e:""))}function n(t,e){this.pos=t,this.length=e.length,this.annotation=e.annotation,this.attachedObject_=e.attachedObject}function i(t,e){this.pos=t,this.length=e.length,this.annotation=e.annotation,this.node_=e}n.prototype.getAttachedObject=function(){return this.attachedObject_},i.prototype.attachObject=function(t){this.node_.attachedObject=t}
var o={equals:function(){return!1}}
function s(t){this.head_=new a(0,o),this.changeHandler_=t}function a(t,e){this.length=t,this.annotation=e,this.attachedObject=null,this.next=null}return s.prototype.insertAnnotatedSpan=function(n,r){this.wrapOperation_(new t(n.pos,0),(function(t,i){e(!i||null===i.next)
var s=new a(n.length,r)
if(i){e(n.pos>t&&n.pos<t+i.length)
var u=new a(0,o)
return u.next=new a(n.pos-t,i.annotation),u.next.next=s,s.next=new a(t+i.length-n.pos,i.annotation),u.next}return s}))},s.prototype.removeSpan=function(t){0!==t.length&&this.wrapOperation_(t,(function(n,r){e(null!==r)
var i=new a(0,o),s=i
for(t.pos>n&&(s.next=new a(t.pos-n,r.annotation),s=s.next);t.end()>n+r.length;)n+=r.length,r=r.next
var u=n+r.length-t.end()
return u>0&&(s.next=new a(u,r.annotation)),i.next}))},s.prototype.updateSpan=function(t,n){0!==t.length&&this.wrapOperation_(t,(function(r,i){e(null!==i)
var s=new a(0,o),u=s,h=r,c=t.pos-h
for(e(c<i.length),c>0&&(u.next=new a(c,i.annotation),h+=(u=u.next).length);null!==i&&t.end()>=r+i.length;){var l=r+i.length-h
u.next=new a(l,n(i.annotation,l)),u=u.next,r+=i.length,i=i.next,h=r}var p=t.end()-h
return p>0&&(e(p<i.length),u.next=new a(p,n(i.annotation,p)),h+=(u=u.next).length,u.next=new a(r+i.length-h,i.annotation)),s.next}))},s.prototype.wrapOperation_=function(t,e){if(t.pos<0)throw new Error("Span start cannot be negative.")
var r,o=[],s=[],u=this.getAffectedNodes_(t)
null!==u.start?(r=u.end.next,u.end.next=null):r=u.succ
var h=e(u.startPos,u.start),c=!1,l=!1
if(h){var p
for(this.mergeNodesWithSameAnnotations_(h),u.pred&&u.pred.annotation.equals(h.annotation)?(c=!0,h.length+=u.pred.length,u.beforePred.next=h,p=u.predPos):(u.beforeStart.next=h,p=u.startPos);h.next;)s.push(new i(p,h)),p+=h.length,h=h.next
u.succ&&u.succ.annotation.equals(h.annotation)?(h.length+=u.succ.length,l=!0,h.next=u.succ.next):h.next=r,s.push(new i(p,h))}else u.pred&&u.succ&&u.pred.annotation.equals(u.succ.annotation)?(c=!0,l=!0,h=new a(u.pred.length+u.succ.length,u.pred.annotation),u.beforePred.next=h,h.next=u.succ.next,s.push(new i(u.startPos-u.pred.length,h))):u.beforeStart.next=r
c&&o.push(new n(u.predPos,u.pred))
for(var d=u.startPos,f=u.start;null!==f;)o.push(new n(d,f)),d+=f.length,f=f.next
l&&o.push(new n(d,u.succ)),this.changeHandler_(o,s)},s.prototype.getAffectedNodes_=function(t){for(var e={},n=null,r=this.head_,i=r.next,o=0;null!==i&&t.pos>=o+i.length;)o+=i.length,n=r,r=i,i=i.next
if(null===i&&(0!==t.length||t.pos!==o))throw new Error("Span start exceeds the bounds of the AnnotationList.")
for(e.startPos=o,0===t.length&&t.pos===o?e.start=null:e.start=i,e.beforeStart=r,o===t.pos&&o>0?(e.pred=r,e.predPos=o-r.length,e.beforePred=n):e.pred=null;null!==i&&t.end()>o;)o+=i.length,r=i,i=i.next
if(t.end()>o)throw new Error("Span end exceeds the bounds of the AnnotationList.")
return 0===t.length&&t.end()===o?e.end=null:e.end=r,e.succ=o===t.end()?i:null,e},s.prototype.mergeNodesWithSameAnnotations_=function(t){if(t)for(var e=null,n=t;n;)e&&e.annotation.equals(n.annotation)?(e.length+=n.length,e.next=n.next):e=n,n=n.next},s.prototype.forEach=function(t){for(var e=this.head_.next;null!==e;)t(e.length,e.annotation,e.attachedObject),e=e.next},s.prototype.getAnnotatedSpansForPos=function(t){for(var e=0,r=this.head_.next,i=null;null!==r&&e+r.length<=t;)e+=r.length,i=r,r=r.next
if(null===r&&e!==t)throw new Error("pos exceeds the bounds of the AnnotationList")
var o=[]
return e===t&&i&&o.push(new n(e-i.length,i)),r&&o.push(new n(e,r)),o},s.prototype.getAnnotatedSpansForSpan=function(e){if(0===e.length)return[]
for(var n=[],r=this.getAffectedNodes_(e),i=r.startPos,o=r.start;null!==o&&i<e.end();){var s=Math.max(i,e.pos),a=Math.min(i+o.length,e.end()),u=new t(s,a-s)
u.annotation=o.annotation,n.push(u),i+=o.length,o=o.next}return n},s.prototype.count=function(){for(var t=0,n=this.head_.next,r=null;null!==n;)r&&e(!r.annotation.equals(n.annotation)),r=n,n=n.next,t++
return t},a.prototype.clone=function(){var t=new a(this.spanLength,this.annotation)
return t.next=this.next,t},s}(),(r=r||{}).Cursor=function(){"use strict"
function t(t,e){this.position=t,this.selectionEnd=e}return t.fromJSON=function(e){return new t(e.position,e.selectionEnd)},t.prototype.equals=function(t){return this.position===t.position&&this.selectionEnd===t.selectionEnd},t.prototype.compose=function(t){return t},t.prototype.transform=function(e){function n(t){for(var n=t,r=e.ops,i=0,o=e.ops.length;i<o&&(r[i].isRetain()?t-=r[i].chars:r[i].isInsert()?n+=r[i].text.length:(n-=Math.min(t,r[i].chars),t-=r[i].chars),!(t<0));i++);return n}var r=n(this.position)
return this.position===this.selectionEnd?new t(r,r):new t(r,n(this.selectionEnd))},t}(),(r=r||{}).FirebaseAdapter=function(t){"undefined"==typeof firebase&&"function"!=typeof Firebase&&(firebase=n(153),n(157))
var e=r.TextOperation,i=r.utils
function s(t,n,r){this.ref_=t,this.ready_=!1,this.firebaseCallbacks_=[],this.zombie_=!1,this.document_=new e,this.revision_=0,this.pendingReceivedRevisions_={}
var i=this
if(n){this.setUserId(n),this.setColor(r)
var o=t.root.child(".info/connected")
this.firebaseOn_(o,"value",(function(t){!0===t.val()&&i.initializeUserData_()}),this),this.on("ready",(function(){i.monitorCursors_()}))}else this.userId_=t.push().key
setTimeout((function(){i.monitorHistory_()}),0)}function a(t,e){if(!t)throw new Error(e||"assertion error")}i.makeEventEmitter(s,["ready","cursor","operation","ack","retry"]),s.prototype.dispose=function(){var t=this
this.removeFirebaseCallbacks_(),this.handleInitialRevisions_=function(){},this.ready_?(this.userRef_&&(this.userRef_.child("cursor").remove(),this.userRef_.child("color").remove()),this.ref_=null,this.document_=null,this.zombie_=!0):this.on("ready",(function(){t.dispose()}))},s.prototype.setUserId=function(t){this.userRef_&&(this.userRef_.child("cursor").remove(),this.userRef_.child("cursor").onDisconnect().cancel(),this.userRef_.child("color").remove(),this.userRef_.child("color").onDisconnect().cancel()),this.userId_=t,this.userRef_=this.ref_.child("users").child(t),this.initializeUserData_()},s.prototype.isHistoryEmpty=function(){return a(this.ready_,"Not ready yet."),0===this.revision_},s.prototype.sendOperation=function(t,e){var n=this
if(this.ready_){a(this.document_.targetLength===t.baseLength,"sendOperation() called with invalid operation.")
var r=h(this.revision_)
this.sent_={id:r,op:t},function t(r,o){n.ref_.child("history").child(r).transaction((function(t){if(null===t)return o}),(function(s,a,u){if(s){if("disconnect"!==s.message)throw i.log("Transaction failure!",s),s
n.sent_&&n.sent_.id===r?setTimeout((function(){t(r,o)}),0):e&&e(s,!1)}else e&&e(null,a)}),!1)}(r,{a:n.userId_,o:t.toJSON(),t:firebase.database.ServerValue.TIMESTAMP})}else this.on("ready",(function(){n.trigger("retry")}))},s.prototype.sendCursor=function(t){this.userRef_.child("cursor").set(t),this.cursor_=t},s.prototype.setColor=function(t){this.userRef_.child("color").set(t),this.color_=t},s.prototype.getDocument=function(){return this.document_},s.prototype.registerCallbacks=function(t){for(var e in t)this.on(e,t[e])},s.prototype.initializeUserData_=function(){this.userRef_.child("cursor").onDisconnect().remove(),this.userRef_.child("color").onDisconnect().remove(),this.sendCursor(this.cursor_||null),this.setColor(this.color_||null)},s.prototype.monitorCursors_=function(){var t=this.ref_.child("users"),e=this
function n(t){var n=t.key,r=t.val()
e.trigger("cursor",n,r.cursor,r.color)}this.firebaseOn_(t,"child_added",n),this.firebaseOn_(t,"child_changed",n),this.firebaseOn_(t,"child_removed",(function(t){var n=t.key
e.trigger("cursor",n,null)}))},s.prototype.monitorHistory_=function(){var t=this
this.ref_.child("checkpoint").once("value",(function(e){if(!t.zombie_){var n=e.child("id").val(),r=e.child("o").val(),i=e.child("a").val()
null!=r&&null!=n&&null!==i?(t.pendingReceivedRevisions_[n]={o:r,a:i},t.checkpointRevision_=function(t){a(t.length>0&&t[0]===u[t.length+8])
for(var e=0,n=1;n<t.length;n++)e*=u.length,e+=u.indexOf(t[n])
return e}(n),t.monitorHistoryStartingAt_(t.checkpointRevision_+1)):(t.checkpointRevision_=0,t.monitorHistoryStartingAt_(t.checkpointRevision_))}}))},s.prototype.monitorHistoryStartingAt_=function(t){var e=this.ref_.child("history").startAt(null,h(t)),n=this
setTimeout((function(){n.firebaseOn_(e,"child_added",(function(t){var e=t.key
n.pendingReceivedRevisions_[e]=t.val(),n.ready_&&n.handlePendingReceivedRevisions_()})),e.once("value",(function(){n.handleInitialRevisions_()}))}),0)},s.prototype.handleInitialRevisions_=function(){a(!this.ready_,"Should not be called multiple times."),this.revision_=this.checkpointRevision_
for(var t=h(this.revision_),e=this.pendingReceivedRevisions_;null!=e[t];){var n=this.parseRevision_(e[t])
n?this.document_=this.document_.compose(n.operation):i.log("Invalid operation.",this.ref_.toString(),t,e[t]),delete e[t],this.revision_++,t=h(this.revision_)}this.trigger("operation",this.document_),this.ready_=!0
var r=this
setTimeout((function(){r.trigger("ready")}),0)},s.prototype.handlePendingReceivedRevisions_=function(){for(var t=this.pendingReceivedRevisions_,e=h(this.revision_),n=!1;null!=t[e];){this.revision_++
var r=this.parseRevision_(t[e])
r?(this.document_=this.document_.compose(r.operation),this.sent_&&e===this.sent_.id?this.sent_.op.equals(r.operation)&&r.author===this.userId_?(this.revision_%100==0&&this.saveCheckpoint_(),this.sent_=null,this.trigger("ack")):(n=!0,this.trigger("operation",r.operation)):this.trigger("operation",r.operation)):i.log("Invalid operation.",this.ref_.toString(),e,t[e]),delete t[e],e=h(this.revision_)}n&&(this.sent_=null,this.trigger("retry"))},s.prototype.parseRevision_=function(t){if("object"!=o(t))return null
if("string"!=typeof t.a||"object"!=o(t.o))return null
var n=null
try{n=e.fromJSON(t.o)}catch(t){return null}return n.baseLength!==this.document_.targetLength?null:{author:t.a,operation:n}},s.prototype.saveCheckpoint_=function(){this.ref_.child("checkpoint").set({a:this.userId_,o:this.document_.toJSON(),id:h(this.revision_-1)})},s.prototype.firebaseOn_=function(t,e,n,r){return this.firebaseCallbacks_.push({ref:t,eventType:e,callback:n,context:r}),t.on(e,n,r),n},s.prototype.firebaseOff_=function(t,e,n,r){t.off(e,n,r)
for(var i=0;i<this.firebaseCallbacks_.length;i++){var o=this.firebaseCallbacks_[i]
if(o.ref===t&&o.eventType===e&&o.callback===n&&o.context===r){this.firebaseCallbacks_.splice(i,1)
break}}},s.prototype.removeFirebaseCallbacks_=function(){for(var t=0;t<this.firebaseCallbacks_.length;t++){var e=this.firebaseCallbacks_[t]
e.ref.off(e.eventType,e.callback,e.context)}this.firebaseCallbacks_=[]}
var u="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"
function h(t){if(0===t)return"A0"
for(var e="";t>0;){var n=t%u.length
e=u[n]+e,t-=n,t/=u.length}return u[e.length+9]+e}return s}(),(r=r||{}).RichTextToolbar=function(t){var e=r.utils
function n(t){this.imageInsertionUI=t,this.element_=this.makeElement_()}return e.makeEventEmitter(n,["bold","italic","underline","strike","font","font-size","color","left","center","right","unordered-list","ordered-list","todo-list","indent-increase","indent-decrease","undo","redo","insert-image"]),n.prototype.element=function(){return this.element_},n.prototype.makeButton_=function(t,n){var r=this
n=n||t
var i=e.elt("a",[e.elt("span","",{class:"firepad-tb-"+n})],{class:"firepad-btn"})
return e.on(i,"click",e.stopEventAnd((function(){r.trigger(t)}))),i},n.prototype.makeElement_=function(){var t=this.makeFontDropdown_(),n=this.makeFontSizeDropdown_(),r=this.makeColorDropdown_(),i=[e.elt("div",[t],{class:"firepad-btn-group"}),e.elt("div",[n],{class:"firepad-btn-group"}),e.elt("div",[r],{class:"firepad-btn-group"}),e.elt("div",[this.makeButton_("bold"),this.makeButton_("italic"),this.makeButton_("underline"),this.makeButton_("strike","strikethrough")],{class:"firepad-btn-group"}),e.elt("div",[this.makeButton_("unordered-list","list-2"),this.makeButton_("ordered-list","numbered-list"),this.makeButton_("todo-list","list")],{class:"firepad-btn-group"}),e.elt("div",[this.makeButton_("indent-decrease"),this.makeButton_("indent-increase")],{class:"firepad-btn-group"}),e.elt("div",[this.makeButton_("left","paragraph-left"),this.makeButton_("center","paragraph-center"),this.makeButton_("right","paragraph-right")],{class:"firepad-btn-group"}),e.elt("div",[this.makeButton_("undo"),this.makeButton_("redo")],{class:"firepad-btn-group"})]
this.imageInsertionUI&&i.push(e.elt("div",[this.makeButton_("insert-image")],{class:"firepad-btn-group"}))
var o=e.elt("div",i,{class:"firepad-toolbar-wrapper"}),s=e.elt("div",null,{class:"firepad-toolbar"})
return s.appendChild(o),s},n.prototype.makeFontDropdown_=function(){for(var t=["Arial","Comic Sans MS","Courier New","Impact","Times New Roman","Verdana"],n=[],r=0;r<t.length;r++){var i=e.elt("span",t[r])
i.setAttribute("style","font-family:"+t[r]),n.push({content:i,value:t[r]})}return this.makeDropdown_("Font","font",n)},n.prototype.makeFontSizeDropdown_=function(){for(var t=[9,10,12,14,18,24,32,42],n=[],r=0;r<t.length;r++){var i=e.elt("span",t[r].toString())
i.setAttribute("style","font-size:"+t[r]+"px; line-height:"+(t[r]-6)+"px;"),n.push({content:i,value:t[r]})}return this.makeDropdown_("Size","font-size",n,"px")},n.prototype.makeColorDropdown_=function(){for(var t=["black","red","green","blue","yellow","cyan","magenta","grey"],n=[],r=0;r<t.length;r++){var i=e.elt("div")
i.className="firepad-color-dropdown-item",i.setAttribute("style","background-color:"+t[r]),n.push({content:i,value:t[r]})}return this.makeDropdown_("Color","color",n)},n.prototype.makeDropdown_=function(t,n,r,i){i=i||""
var s=this,a=e.elt("a",t+" ▾",{class:"firepad-btn firepad-dropdown"}),u=e.elt("ul",[],{class:"firepad-dropdown-menu"})
a.appendChild(u)
var h=!1,c=!1
function l(){h&&(u.style.display="",e.off(document,"click",l,!0),h=!1),c=!0,setTimeout((function(){c=!1}),0)}function p(t,r){"object"!=o(t)&&(t=document.createTextNode(String(t)))
var a=e.elt("a",[t])
e.on(a,"click",e.stopEventAnd((function(){l(),s.trigger(n,r+i)}))),u.appendChild(a)}for(var d=0;d<r.length;d++)p(r[d].content,r[d].value)
return e.on(a,"click",e.stopEventAnd((function(){c||h||(u.style.display="block",e.on(document,"click",l,!0),h=!0)}))),a},n}(),(r=r||{}).WrappedOperation=function(t){"use strict"
function e(t,e){this.wrapped=t,this.meta=e}function n(t,e){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function r(t,e){return t&&"object"==o(t)&&"function"==typeof t.transform?t.transform(e):t}return e.prototype.apply=function(){return this.wrapped.apply.apply(this.wrapped,arguments)},e.prototype.invert=function(){var t=this.meta
return new e(this.wrapped.invert.apply(this.wrapped,arguments),t&&"object"==o(t)&&"function"==typeof t.invert?t.invert.apply(t,arguments):t)},e.prototype.compose=function(t){return new e(this.wrapped.compose(t.wrapped),function(t,e){if(t&&"object"==o(t)){if("function"==typeof t.compose)return t.compose(e)
var r={}
return n(t,r),n(e,r),r}return e}(this.meta,t.meta))},e.transform=function(t,n){var i=t.wrapped.transform(n.wrapped)
return[new e(i[0],r(t.meta,n.wrapped)),new e(i[1],r(n.meta,t.wrapped))]},e.prototype.transform=function(t){return e.transform(this,t)},e}(),(r=r||{}).UndoManager=function(){"use strict"
var t="normal"
function e(e){this.maxItems=e||50,this.state=t,this.dontCompose=!1,this.undoStack=[],this.redoStack=[]}function n(t,e){for(var n=[],r=e.constructor,i=t.length-1;i>=0;i--){var o=r.transform(t[i],e)
"function"==typeof o[0].isNoop&&o[0].isNoop()||n.push(o[0]),e=o[1]}return n.reverse()}return e.prototype.add=function(t,e){if("undoing"===this.state)this.redoStack.push(t),this.dontCompose=!0
else if("redoing"===this.state)this.undoStack.push(t),this.dontCompose=!0
else{var n=this.undoStack
!this.dontCompose&&e&&n.length>0?n.push(t.compose(n.pop())):(n.push(t),n.length>this.maxItems&&n.shift()),this.dontCompose=!1,this.redoStack=[]}},e.prototype.transform=function(t){this.undoStack=n(this.undoStack,t),this.redoStack=n(this.redoStack,t)},e.prototype.performUndo=function(e){if(this.state="undoing",0===this.undoStack.length)throw new Error("undo not possible")
e(this.undoStack.pop()),this.state=t},e.prototype.performRedo=function(e){if(this.state="redoing",0===this.redoStack.length)throw new Error("redo not possible")
e(this.redoStack.pop()),this.state=t},e.prototype.canUndo=function(){return 0!==this.undoStack.length},e.prototype.canRedo=function(){return 0!==this.redoStack.length},e.prototype.isUndoing=function(){return"undoing"===this.state},e.prototype.isRedoing=function(){return"redoing"===this.state},e}(),(r=r||{}).Client=function(){"use strict"
function t(){this.state=n}function e(){}t.prototype.setState=function(t){this.state=t},t.prototype.applyClient=function(t){this.setState(this.state.applyClient(this,t))},t.prototype.applyServer=function(t){this.setState(this.state.applyServer(this,t))},t.prototype.serverAck=function(){this.setState(this.state.serverAck(this))},t.prototype.serverRetry=function(){this.setState(this.state.serverRetry(this))},t.prototype.sendOperation=function(t){throw new Error("sendOperation must be defined in child class")},t.prototype.applyOperation=function(t){throw new Error("applyOperation must be defined in child class")},t.Synchronized=e,e.prototype.applyClient=function(t,e){return t.sendOperation(e),new r(e)},e.prototype.applyServer=function(t,e){return t.applyOperation(e),this},e.prototype.serverAck=function(t){throw new Error("There is no pending operation.")},e.prototype.serverRetry=function(t){throw new Error("There is no pending operation.")}
var n=new e
function r(t){this.outstanding=t}function i(t,e){this.outstanding=t,this.buffer=e}return t.AwaitingConfirm=r,r.prototype.applyClient=function(t,e){return new i(this.outstanding,e)},r.prototype.applyServer=function(t,e){var n=this.outstanding.transform(e)
return t.applyOperation(n[1]),new r(n[0])},r.prototype.serverAck=function(t){return n},r.prototype.serverRetry=function(t){return t.sendOperation(this.outstanding),this},t.AwaitingWithBuffer=i,i.prototype.applyClient=function(t,e){var n=this.buffer.compose(e)
return new i(this.outstanding,n)},i.prototype.applyServer=function(t,e){var n=this.outstanding.transform(e),r=this.buffer.transform(n[1])
return t.applyOperation(r[1]),new i(n[0],r[0])},i.prototype.serverRetry=function(t){var e=this.outstanding.compose(this.buffer)
return t.sendOperation(e),new r(e)},i.prototype.serverAck=function(t){return t.sendOperation(this.buffer),new r(this.buffer)},t}(),(r=r||{}).EditorClient=function(){"use strict"
var t=r.Client,e=r.Cursor,n=r.UndoManager,i=r.WrappedOperation
function o(t,e){this.cursorBefore=t,this.cursorAfter=e}function s(t,e){this.id=t,this.editorAdapter=e}function a(r,i){t.call(this),this.serverAdapter=r,this.editorAdapter=i,this.undoManager=new n,this.clients={}
var o=this
this.editorAdapter.registerCallbacks({change:function(t,e){o.onChange(t,e)},cursorActivity:function(){o.onCursorActivity()},blur:function(){o.onBlur()},focus:function(){o.onFocus()}}),this.editorAdapter.registerUndo((function(){o.undo()})),this.editorAdapter.registerRedo((function(){o.redo()})),this.serverAdapter.registerCallbacks({ack:function(){o.serverAck(),o.focused&&o.state instanceof t.Synchronized&&(o.updateCursor(),o.sendCursor(o.cursor)),o.emitStatus()},retry:function(){o.serverRetry()},operation:function(t){o.applyServer(t)},cursor:function(n,r,i){if(o.serverAdapter.userId_!==n&&o.state instanceof t.Synchronized){var s=o.getClientObject(n)
r?(i&&s.setColor(i),s.updateCursor(e.fromJSON(r))):s.removeCursor()}}})}return o.prototype.invert=function(){return new o(this.cursorAfter,this.cursorBefore)},o.prototype.compose=function(t){return new o(this.cursorBefore,t.cursorAfter)},o.prototype.transform=function(t){return new o(this.cursorBefore?this.cursorBefore.transform(t):null,this.cursorAfter?this.cursorAfter.transform(t):null)},s.prototype.setColor=function(t){this.color=t},s.prototype.updateCursor=function(t){this.removeCursor(),this.cursor=t,this.mark=this.editorAdapter.setOtherCursor(t,this.color,this.id)},s.prototype.removeCursor=function(){this.mark&&this.mark.clear()},function(t,e){function n(){}n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}(a,t),a.prototype.getClientObject=function(t){return this.clients[t]||(this.clients[t]=new s(t,this.editorAdapter))},a.prototype.applyUnredo=function(t){this.undoManager.add(this.editorAdapter.invertOperation(t)),this.editorAdapter.applyOperation(t.wrapped),this.cursor=t.meta.cursorAfter,this.cursor&&this.editorAdapter.setCursor(this.cursor),this.applyClient(t.wrapped)},a.prototype.undo=function(){var t=this
this.undoManager.canUndo()&&this.undoManager.performUndo((function(e){t.applyUnredo(e)}))},a.prototype.redo=function(){var t=this
this.undoManager.canRedo()&&this.undoManager.performRedo((function(e){t.applyUnredo(e)}))},a.prototype.onChange=function(t,e){var n=this.cursor
this.updateCursor()
var r,s=this.undoManager.undoStack.length>0&&e.shouldBeComposedWithInverted((r=this.undoManager.undoStack,r[r.length-1]).wrapped),a=new o(this.cursor,n)
this.undoManager.add(new i(e,a),s),this.applyClient(t)},a.prototype.updateCursor=function(){this.cursor=this.editorAdapter.getCursor()},a.prototype.onCursorActivity=function(){var t=this.cursor
this.updateCursor(),!this.focused||t&&this.cursor.equals(t)||this.sendCursor(this.cursor)},a.prototype.onBlur=function(){this.cursor=null,this.sendCursor(null),this.focused=!1},a.prototype.onFocus=function(){this.focused=!0,this.onCursorActivity()},a.prototype.sendCursor=function(e){this.state instanceof t.AwaitingWithBuffer||this.serverAdapter.sendCursor(e)},a.prototype.sendOperation=function(t){this.serverAdapter.sendOperation(t),this.emitStatus()},a.prototype.applyOperation=function(t){this.editorAdapter.applyOperation(t),this.updateCursor(),this.undoManager.transform(new i(t,null))},a.prototype.emitStatus=function(){var e=this
setTimeout((function(){e.trigger("synced",e.state instanceof t.Synchronized)}),0)},a}(),r.utils.makeEventEmitter(r.EditorClient,["synced"]),null!=r||(r={}),r.ACEAdapter=function(){var e=function(){function e(t){var r
!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.onChange=this.onChange.bind(this),this.onBlur=this.onBlur.bind(this),this.onFocus=this.onFocus.bind(this),this.onCursorActivity=this.onCursorActivity.bind(this),this.ace=t,this.aceSession=this.ace.getSession(),this.aceDoc=this.aceSession.getDocument(),this.aceDoc.setNewLineMode("unix"),this.grabDocumentState(),this.ace.on("change",this.onChange),this.ace.on("blur",this.onBlur),this.ace.on("focus",this.onFocus),this.aceSession.selection.on("changeCursor",this.onCursorActivity),null==this.aceRange&&(this.aceRange=(null!=(r=ace.require)?r:n(159))("ace/range").Range)}var i
return(i=[{key:"grabDocumentState",value:function(){return this.lastDocLines=this.aceDoc.getAllLines(),this.lastCursorRange=this.aceSession.selection.getRange()}},{key:"detach",value:function(){return this.ace.removeListener("change",this.onChange),this.ace.removeListener("blur",this.onBlur),this.ace.removeListener("focus",this.onFocus),this.aceSession.selection.removeListener("changeCursor",this.onCursorActivity)}},{key:"onChange",value:function(e){var n
if(!this.ignoreChanges)return n=this.operationFromACEChange(e),this.trigger.apply(this,["change"].concat(t(n))),this.grabDocumentState()}},{key:"onBlur",value:function(){if(this.ace.selection.isEmpty())return this.trigger("blur")}},{key:"onFocus",value:function(){return this.trigger("focus")}},{key:"onCursorActivity",value:function(){var t=this
return setTimeout((function(){return t.trigger("cursorActivity")}),0)}},{key:"operationFromACEChange",value:function(t){var e,n,i,o,s,a,u
return t.data?("insertLines"===(o=(n=t.data).action)||"removeLines"===o?(u=n.lines.join("\n")+"\n",n.action.replace("Lines","")):(u=n.text.replace(this.aceDoc.getNewLineCharacter(),"\n"),n.action.replace("Text","")),a=this.indexFromPos(n.range.start)):(u=t.lines.join("\n"),a=this.indexFromPos(t.start)),s=this.lastDocLines.join("\n").length-a,"remove"===t.action&&(s-=u.length),i=(new r.TextOperation).retain(a).insert(u).retain(s),e=(new r.TextOperation).retain(a).delete(u).retain(s),"remove"===t.action?[e,i]:[i,e]}},{key:"applyOperationToACE",value:function(t){var e,n,r,i,o,s,a,u
for(n=0,r=0,i=(a=t.ops).length;r<i;r++)(o=a[r]).isRetain()?n+=o.chars:o.isInsert()?(this.aceDoc.insert(this.posFromIndex(n),o.text),n+=o.text.length):o.isDelete()&&(e=this.posFromIndex(n),u=this.posFromIndex(n+o.chars),s=this.aceRange.fromPoints(e,u),this.aceDoc.remove(s))
return this.grabDocumentState()}},{key:"posFromIndex",value:function(t){var e,n,r,i,o
for(o=e=0,n=(i=this.aceDoc.$lines).length;e<n&&!(t<=(r=i[o]).length);o=++e)t-=r.length+1
return{row:o,column:t}}},{key:"indexFromPos",value:function(t,e){var n,r,i,o
for(null==e&&(e=this.lastDocLines),r=0,n=i=0,o=t.row;0<=o?i<o:i>o;n=0<=o?++i:--i)r+=this.lastDocLines[n].length+1
return r+t.column}},{key:"getValue",value:function(){return this.aceDoc.getValue()}},{key:"getCursor",value:function(){var t,e,n
try{n=this.indexFromPos(this.aceSession.selection.getRange().start,this.aceDoc.$lines),e=this.indexFromPos(this.aceSession.selection.getRange().end,this.aceDoc.$lines)}catch(i){try{n=this.indexFromPos(this.lastCursorRange.start),e=this.indexFromPos(this.lastCursorRange.end)}catch(i){t=i,console.log("Couldn't figure out the cursor range:",t,"-- setting it to 0:0."),n=0,e=0}}if(n>e){var i=[e,n]
n=i[0],e=i[1]}return new r.Cursor(n,e)}},{key:"setCursor",value:function(t){var e,n
if(n=this.posFromIndex(t.position),e=this.posFromIndex(t.selectionEnd),t.position>t.selectionEnd){var r=[e,n]
n=r[0],e=r[1]}return this.aceSession.selection.setSelectionRange(new this.aceRange(n.row,n.column,e.row,e.column))}},{key:"setOtherCursor",value:function(t,e,n){var r,i,o,s,a,u,h,c=this
if(null==this.otherCursors&&(this.otherCursors={}),(o=this.otherCursors[n])&&(o.start.detach(),o.end.detach(),this.aceSession.removeMarker(o.id)),h=this.posFromIndex(t.position),s=this.posFromIndex(t.selectionEnd),t.selectionEnd<t.position){var l=[s,h]
h=l[0],s=l[1]}return r="other-client-selection-".concat(e.replace("#","")),(a=t.position===t.selectionEnd)&&(r=r.replace("selection","cursor")),i=".".concat(r," {\n  position: absolute;\n  background-color: ").concat(a?"transparent":e,";\n  border-left: 2px solid ").concat(e,";\n}"),this.addStyleRule(i),this.otherCursors[n]=o=new this.aceRange(h.row,h.column,s.row,s.column),u=this,o.clipRows=function(){var t
return(t=u.aceRange.prototype.clipRows.apply(this,arguments)).isEmpty=function(){return!1},t},o.start=this.aceDoc.createAnchor(o.start),o.end=this.aceDoc.createAnchor(o.end),o.id=this.aceSession.addMarker(o,r,"text"),{clear:function(){return o.start.detach(),o.end.detach(),c.aceSession.removeMarker(o.id)}}}},{key:"addStyleRule",value:function(t){var e
if("undefined"!=typeof document&&null!==document&&(this.addedStyleRules||(this.addedStyleRules={},e=document.createElement("style"),document.documentElement.getElementsByTagName("head")[0].appendChild(e),this.addedStyleSheet=e.sheet),!this.addedStyleRules[t]))return this.addedStyleRules[t]=!0,this.addedStyleSheet.insertRule(t,0)}},{key:"registerCallbacks",value:function(t){this.callbacks=t}},{key:"trigger",value:function(t){for(var e,n,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o]
return null!=(e=this.callbacks)&&null!=(n=e[t])?n.apply(this,i):void 0}},{key:"applyOperation",value:function(t){return t.isNoop()||(this.ignoreChanges=!0),this.applyOperationToACE(t),this.ignoreChanges=!1}},{key:"registerUndo",value:function(t){return this.ace.undo=t}},{key:"registerRedo",value:function(t){return this.ace.redo=t}},{key:"invertOperation",value:function(t){return t.invert(this.getValue())}}])&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,i),e}()
return e.prototype.ignoreChanges=!1,e}.call(void 0)
var r,i=function(t,e,n){return"."+t+" {\n  position: relative;\nbackground-color: "+e+";\nborder-left: 2px solid "+n+";\n}"},s=function(t,e){if("undefined"==typeof document||null===document)return!1
if(-1===this.addedStyleRules.indexOf(t)){var n=document.createElement("style"),r=document.createTextNode(e)
n.appendChild(r),document.head.appendChild(n),this.addedStyleRules.push(t)}},a=function(){function t(t){if(!t||"function"!=typeof t.getModel)throw new Error("MonacoAdapter: Incorrect Parameter Recieved in constructor, expected valid Monaco Instance")
this.monaco=t,this.monacoModel=this.monaco.getModel(),this.lastDocLines=this.monacoModel.getLinesContent(),this.lastCursorRange=this.monaco.getSelection(),this.callbacks={},this.otherCursors=[],this.addedStyleRules=[],this.ignoreChanges=!1,this.onChange=this.onChange.bind(this),this.onBlur=this.onBlur.bind(this),this.onFocus=this.onFocus.bind(this),this.onCursorActivity=this.onCursorActivity.bind(this),this.changeHandler=this.monaco.onDidChangeModelContent(this.onChange),this.didBlurHandler=this.monaco.onDidBlurEditorWidget(this.onBlur),this.didFocusHandler=this.monaco.onDidFocusEditorWidget(this.onFocus),this.didChangeCursorPositionHandler=this.monaco.onDidChangeCursorPosition(this.onCursorActivity)}return t.prototype.detach=function(){this.changeHandler.dispose(),this.didBlurHandler.dispose(),this.didFocusHandler.dispose(),this.didChangeCursorPositionHandler.dispose()},t.prototype.getCursor=function(){var t=this.monaco.getSelection()
null!=t||(t=this.lastCursorRange)
var e=t.getStartPosition(),n=t.getEndPosition(),i=this.monacoModel.getOffsetAt(e),o=this.monacoModel.getOffsetAt(n)
if(i>o){var s=[o,i]
i=s[0],o=s[1]}return new r.Cursor(i,o)},t.prototype.setCursor=function(t){var e=t.position,n=t.selectionEnd,r=this.monacoModel.getPositionAt(e),i=this.monacoModel.getPositionAt(n)
if(e>n){var o=[i,r]
r=o[0],i=o[1]}this.monaco.setSelection(new monaco.Range(r.lineNumber,r.column,i.lineNumber,i.column))},t.prototype.setOtherCursor=function(t,e,n){if("object"!=o(t)||"number"!=typeof t.position||"number"!=typeof t.selectionEnd)return!1
if("string"!=typeof e||!e.match(/^#[a-fA-F0-9]{3,6}$/))return!1
var r=t.position,a=t.selectionEnd
if(r<0||a<0)return!1
var u=this.otherCursors.find((function(t){return t.clientID===n}))
u||(u={clientID:n,decoration:[]},this.otherCursors.push(u)),u.decoration=this.monaco.deltaDecorations(u.decoration,[])
var h,c,l="other-client-selection-"+e.replace("#","")
r===a?(l=l.replace("selection","cursor"),h=i(l,"transparent",e),c=s.call(this,l,h)):(h=i(l,e,e),c=s.call(this,l,h)),0==c&&console.log("Monaco Adapter: Failed to add some css style.\nPlease make sure you're running on supported environment.")
var p=this.monacoModel.getPositionAt(r),d=this.monacoModel.getPositionAt(a)
if(r>a){var f=[d,p]
p=f[0],d=f[1]}u.decoration=this.monaco.deltaDecorations(u.decoration,[{range:new monaco.Range(p.lineNumber,p.column,d.lineNumber,d.column),options:{className:l}}])
var y=this
return{clear:function(){u.decoration=y.monaco.deltaDecorations(u.decoration,[])}}},t.prototype.registerCallbacks=function(t){this.callbacks=Object.assign({},this.callbacks,t)},t.prototype.registerUndo=function(t){if("function"!=typeof t)throw new Error("MonacoAdapter: registerUndo method expects a callback function in parameter")
this.callbacks.undo=t},t.prototype.registerRedo=function(t){if("function"!=typeof t)throw new Error("MonacoAdapter: registerRedo method expects a callback function in parameter")
this.callbacks.redo=t},t.prototype.operationFromMonacoChanges=function(t,e,n){var i,o,s,a=t.text,u=t.rangeLength,h=t.rangeOffset+n,c=e.length+n-h
return 0===a.length&&u>0?(s=e.slice(h,h+u),i=(new r.TextOperation).retain(h).delete(u).retain(c-u),o=(new r.TextOperation).retain(h).insert(s).retain(c-u)):a.length>0&&u>0?(s=e.slice(h,h+u),i=(new r.TextOperation).retain(h).delete(u).insert(a).retain(c-u),o=(new r.TextOperation).retain(h).delete(a.length).insert(s).retain(c-u)):(i=(new r.TextOperation).retain(h).insert(a).retain(c),o=(new r.TextOperation).retain(h).delete(a).retain(c)),[i,o]},t.prototype.onChange=function(t){var e=this
if(!this.ignoreChanges){var n=this.lastDocLines.join(this.monacoModel.getEOL()),i=0
if(!t.changes){var o=(new r.TextOperation).retain(n.length)
this.trigger("change",o,o)}t.changes.reverse().forEach((function(t){var r=e.operationFromMonacoChanges(t,n,i)
i+=r[0].targetLength-r[0].baseLength,e.trigger.apply(e,["change"].concat(r))})),this.lastDocLines=this.monacoModel.getLinesContent()}},t.prototype.trigger=function(t){if(this.callbacks.hasOwnProperty(t)){var e=this.callbacks[t],n=[]
if(arguments.length>1)for(var r=1;r<arguments.length;r++)n.push(arguments[r])
e.apply(null,n)}},t.prototype.onBlur=function(){this.monaco.getSelection().isEmpty()&&this.trigger("blur")},t.prototype.onFocus=function(){this.trigger("focus")},t.prototype.onCursorActivity=function(){var t=this
setTimeout((function(){return t.trigger("cursorActivity")}),1)},t.prototype.applyOperation=function(t){t.isNoop()||(this.ignoreChanges=!0)
var e=0,n=this
t.ops.forEach((function(t){if(t.isRetain())e+=t.chars
else if(t.isInsert()){var r=n.monacoModel.getPositionAt(e)
n.monaco.executeEdits("my-source",[{range:new monaco.Range(r.lineNumber,r.column,r.lineNumber,r.column),text:t.text,forceMoveMarkers:!0}]),e+=t.text.length}else if(t.isDelete()){var i=n.monacoModel.getPositionAt(e),o=n.monacoModel.getPositionAt(e+t.chars)
n.monaco.executeEdits("my-source",[{range:new monaco.Range(i.lineNumber,i.column,o.lineNumber,o.column),text:"",forceMoveMarkers:!0}])}})),this.lastDocLines=this.monacoModel.getLinesContent(),this.ignoreChanges=!1},t.prototype.invertOperation=function(t){t.invert(this.getValue())},t}()
return r.MonacoAdapter=a,(r=r||{}).AttributeConstants={BOLD:"b",ITALIC:"i",UNDERLINE:"u",STRIKE:"s",FONT:"f",FONT_SIZE:"fs",COLOR:"c",BACKGROUND_COLOR:"bc",ENTITY_SENTINEL:"ent",LINE_SENTINEL:"l",LINE_INDENT:"li",LINE_ALIGN:"la",LIST_TYPE:"lt"},r.sentinelConstants={LINE_SENTINEL_CHARACTER:"",ENTITY_SENTINEL_CHARACTER:""},(r=r||{}).EntityManager=function(){var t=r.utils
function e(){this.entities_={}
var e=["src","alt","width","height","style","class"]
this.register("img",{render:function(e){t.assert(e.src,"image entity should have 'src'!")
for(var n=["src","alt","width","height","style","class"],r="<img ",i=0;i<n.length;i++){var o=n[i]
o in e&&(r+=" "+o+'="'+e[o]+'"')}return r+">"},fromElement:function(t){for(var n={},r=0;r<e.length;r++){var i=e[r]
t.hasAttribute(i)&&(n[i]=t.getAttribute(i))}return n}})}return e.prototype.register=function(t,e){r.utils.assert(e.render,"Entity options should include a 'render' function!"),r.utils.assert(e.fromElement,"Entity options should include a 'fromElement' function!"),this.entities_[t]=e},e.prototype.renderToElement=function(t,e){return this.tryRenderToElement_(t,"render",e)},e.prototype.exportToElement=function(t){var e=this.tryRenderToElement_(t,"export")||this.tryRenderToElement_(t,"getHtml")||this.tryRenderToElement_(t,"render")
return e.setAttribute("data-firepad-entity",t.type),e},e.prototype.updateElement=function(t,e){var n=t.type,r=t.info
this.entities_[n]&&void 0!==this.entities_[n].update&&this.entities_[n].update(r,e)},e.prototype.fromElement=function(t){var e=t.getAttribute("data-firepad-entity")
if(e||(e=t.nodeName.toLowerCase()),e&&this.entities_[e]){var n=this.entities_[e].fromElement(t)
return new r.Entity(e,n)}},e.prototype.tryRenderToElement_=function(t,e,n){var i=t.type,s=t.info
if(this.entities_[i]&&this.entities_[i][e]){var a=r.document||window&&window.document,u=this.entities_[i][e](s,n,a)
if(u){if("string"==typeof u){var h=(r.document||document).createElement("div")
return h.innerHTML=u,h.childNodes[0]}if("object"==o(u))return r.utils.assert(void 0!==u.nodeType,"Error rendering "+i+" entity.  render() function must return an html string or a DOM element."),u}}},e.prototype.entitySupportsUpdate=function(t){return this.entities_[t]&&this.entities_[t].update},e}(),(r=r||{}).Entity=function(){var t=r.AttributeConstants.ENTITY_SENTINEL,e=t+"_"
function n(t,e){if(!(this instanceof n))return new n(t,e)
this.type=t,this.info=e||{}}return n.prototype.toAttributes=function(){var n={}
for(var r in n[t]=this.type,this.info)n[e+r]=this.info[r]
return n},n.fromAttributes=function(r){var i=r[t],o={}
for(var s in r)0===s.indexOf(e)&&(o[s.substr(e.length)]=r[s])
return new n(i,o)},n}(),(r=r||{}).RichTextCodeMirror=function(){var t=r.AnnotationList,e=r.Span,n=r.utils,i=r.AttributeConstants,s={c:"color",bc:"background-color",fs:"font-size",li:function(t){return"padding-left: "+40*t+"px"}},a={}
function u(e,n,r){this.codeMirror=e,this.options_=r||{},this.entityManager_=n,this.currentAttributes_=null
var i=this
this.annotationList_=new t((function(t,e){i.onAnnotationsChanged_(t,e)})),this.initAnnotationList_(),f(this,"onCodeMirrorBeforeChange_"),f(this,"onCodeMirrorChange_"),f(this,"onCursorActivity_"),parseInt(CodeMirror.version)>=4?this.codeMirror.on("changes",this.onCodeMirrorChange_):this.codeMirror.on("change",this.onCodeMirrorChange_),this.codeMirror.on("beforeChange",this.onCodeMirrorBeforeChange_),this.codeMirror.on("cursorActivity",this.onCursorActivity_),this.changeId_=0,this.outstandingChanges_={},this.dirtyLines_=[]}n.makeEventEmitter(u,["change","attributesChange","newLine"])
var h=r.sentinelConstants.LINE_SENTINEL_CHARACTER,c=r.sentinelConstants.ENTITY_SENTINEL_CHARACTER
function l(t,e){return function(t,e){return t.line-e.line||t.ch-e.ch}(t,e)<=0}function p(t){if(0===t.length)return 0
for(var e=0,n=0;n<t.length;n++)e+=t[n].length
return e+t.length-1}function d(t){this.attributes=t||{}}function f(t,e){var n=t[e]
t[e]=function(){n.apply(t,arguments)}}return u.prototype.detach=function(){this.codeMirror.off("beforeChange",this.onCodeMirrorBeforeChange_),this.codeMirror.off("change",this.onCodeMirrorChange_),this.codeMirror.off("changes",this.onCodeMirrorChange_),this.codeMirror.off("cursorActivity",this.onCursorActivity_),this.clearAnnotations_()},u.prototype.toggleAttribute=function(t,e){var n=e||!0
if(this.emptySelection_()){var r=this.getCurrentAttributes_()
r[t]===n?delete r[t]:r[t]=n,this.currentAttributes_=r}else{var i=this.getCurrentAttributes_()[t]!==n&&n
this.setAttribute(t,i)}},u.prototype.setAttribute=function(t,e){var n=this.codeMirror
if(this.emptySelection_()){var r=this.getCurrentAttributes_()
!1===e?delete r[t]:r[t]=e,this.currentAttributes_=r}else this.updateTextAttributes(n.indexFromPos(n.getCursor("start")),n.indexFromPos(n.getCursor("end")),(function(n){!1===e?delete n[t]:n[t]=e})),this.updateCurrentAttributes_()},u.prototype.updateTextAttributes=function(t,n,r,o,s){var a=[],u=t,h=this
this.annotationList_.updateSpan(new e(t,n-t),(function(t,e){var n={}
for(var c in t.attributes)n[c]=t.attributes[c]
n[i.LINE_SENTINEL]&&!s||r(n)
var l={},p={}
return h.computeChangedAttributes_(t.attributes,n,l,p),function(t){for(var e in t)return!1
return!0}(l)||a.push({start:u,end:u+e,attributes:l,attributesInverse:p,origin:o}),u+=e,new d(n)})),a.length>0&&this.trigger("attributesChange",this,a)},u.prototype.computeChangedAttributes_=function(t,e,n,r){var i,o={}
for(i in t)o[i]=!0
for(i in e)o[i]=!0
for(i in o)i in e?i in t?t[i]!==e[i]&&(n[i]=e[i],r[i]=t[i]):(n[i]=e[i],r[i]=!1):(n[i]=!1,r[i]=t[i])},u.prototype.toggleLineAttribute=function(t,e){var n,r=this.getCurrentLineAttributes_()
n=!(t in r&&r[t]===e)&&e,this.setLineAttribute(t,n)},u.prototype.setLineAttribute=function(t,e){this.updateLineAttributesForSelection((function(n){!1===e?delete n[t]:n[t]=e}))},u.prototype.updateLineAttributesForSelection=function(t){var e=this.codeMirror,n=e.getCursor("start"),r=e.getCursor("end"),i=n.line,o=r.line,s=e.getLine(o),a=this.areLineSentinelCharacters_(s.substr(0,r.ch))
o>i&&a&&o--,this.updateLineAttributes(i,o,t)},u.prototype.updateLineAttributes=function(t,e,n){for(var r=t;r<=e;r++){var o=this.codeMirror.getLine(r),s=this.codeMirror.indexFromPos({line:r,ch:0})
if(o[0]!==h){var a={}
a[i.LINE_SENTINEL]=!0,n(a),this.insertText(s,h,a)}else this.updateTextAttributes(s,s+1,n,null,!0)}},u.prototype.replaceText=function(t,e,n,r,i){this.changeId_++
var o="cmrt-"+this.changeId_
this.outstandingChanges_[o]={origOrigin:i,attributes:r}
var s=this.codeMirror,a=s.posFromIndex(t),u="number"==typeof e?s.posFromIndex(e):null
s.replaceRange(n,a,u,o)},u.prototype.insertText=function(t,e,n,r){var i=this.codeMirror,o=i.getCursor(),s="RTCMADAPTER"==r&&!i.somethingSelected()&&t==i.indexFromPos(o)
this.replaceText(t,null,e,n,r),s&&i.setCursor(o)},u.prototype.removeText=function(t,e,n){var r=this.codeMirror
r.replaceRange("",r.posFromIndex(t),r.posFromIndex(e),n)},u.prototype.insertEntityAtCursor=function(t,e,n){var r=this.codeMirror,i=r.indexFromPos(r.getCursor("head"))
this.insertEntityAt(i,t,e,n)},u.prototype.insertEntityAt=function(t,e,n,i){this.codeMirror,this.insertEntity_(t,new r.Entity(e,n),i)},u.prototype.insertEntity_=function(t,e,n){this.replaceText(t,null,c,e.toAttributes(),n)},u.prototype.getAttributeSpans=function(t,n){for(var r=[],i=this.annotationList_.getAnnotatedSpansForSpan(new e(t,n-t)),o=0;o<i.length;o++)r.push({length:i[o].length,attributes:i[o].annotation.attributes})
return r},u.prototype.end=function(){var t=this.codeMirror.lineCount()-1
return this.codeMirror.indexFromPos({line:t,ch:this.codeMirror.getLine(t).length})},u.prototype.getRange=function(t,e){var n=this.codeMirror.posFromIndex(t),r=this.codeMirror.posFromIndex(e)
return this.codeMirror.getRange(n,r)},u.prototype.initAnnotationList_=function(){var t=this.end()
0!==t&&this.annotationList_.insertAnnotatedSpan(new e(0,t),new d)},u.prototype.onAnnotationsChanged_=function(t,e){var n,r={}
this.tryToUpdateEntitiesInPlace(t,e)
for(var o=0;o<t.length;o++){var s=t[o].annotation.attributes
i.LINE_SENTINEL in s&&(r[this.codeMirror.posFromIndex(t[o].pos).line]=!0),(n=t[o].getAttachedObject())&&n.clear()}for(o=0;o<e.length;o++){var a=e[o].annotation,u=i.LINE_SENTINEL in a.attributes,h=i.ENTITY_SENTINEL in a.attributes,c=this.codeMirror.posFromIndex(e[o].pos)
if(u)r[c.line]=!0
else if(h)this.markEntity_(e[o])
else{var l=this.getClassNameForAttributes_(a.attributes)
if(""!==l){var p=this.codeMirror.posFromIndex(e[o].pos+e[o].length)
n=this.codeMirror.markText(c,p,{className:l}),e[o].attachObject(n)}}}for(var d in r)this.dirtyLines_.push(this.codeMirror.getLineHandle(Number(d))),this.queueLineMarking_()},u.prototype.tryToUpdateEntitiesInPlace=function(t,e){for(var n=t.length;n--;)for(var r=t[n],i=e.length;i--;){var o=e[i]
if(r.pos==o.pos&&r.length==o.length&&r.annotation.attributes.ent&&r.annotation.attributes.ent==o.annotation.attributes.ent){var s=o.annotation.attributes.ent
if(this.entityManager_.entitySupportsUpdate(s)){t.splice(n,1),e.splice(i,1)
var a=r.getAttachedObject()
a.update(o.annotation.attributes),o.attachObject(a)}}}},u.prototype.queueLineMarking_=function(){if(null==this.lineMarkTimeout_){var t=this
this.lineMarkTimeout_=setTimeout((function(){t.lineMarkTimeout_=null
for(var e=[],n=0;n<t.dirtyLines_.length;n++){var r=t.codeMirror.getLineNumber(t.dirtyLines_[n])
e.push(Number(r))}t.dirtyLines_=[],e.sort((function(t,e){return t-e}))
var i=-1
for(n=0;n<e.length;n++){var o=e[n]
o>i&&(i=t.markLineSentinelCharactersForChangedLines_(o,o))}}),0)}},u.prototype.addStyleWithCSS_=function(t){var e=document.getElementsByTagName("head")[0],n=document.createElement("style")
n.type="text/css",n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t)),e.appendChild(n)},u.prototype.getClassNameForAttributes_=function(t){var e=""
for(var n in t){var o=t[n]
if(n===i.LINE_SENTINEL)r.utils.assert(!0===o,"LINE_SENTINEL attribute should be true if it exists.")
else{var u=(this.options_.cssPrefix||"cmrt-")+n
if(!0!==o){n===i.FONT_SIZE&&"string"!=typeof o&&(o+="px")
var h=o.toString().toLowerCase().replace(/[^a-z0-9-_]/g,"-")
if(u+="-"+h,s[n]&&(a[n]||(a[n]={}),!a[n][h])){a[n][h]=!0
var c=s[n],l="function"==typeof c?c(o):c+": "+o,p=n==i.LINE_INDENT?"pre."+u:"."+u
this.addStyleWithCSS_(p+" { "+l+" }"),n===i.LINE_INDENT&&(p="pre.CodeMirror-line."+u,this.addStyleWithCSS_(p+" { "+l+" }"))}}e=e+" "+u}}return e},u.prototype.markEntity_=function(t){for(var e=t.annotation.attributes,n=r.Entity.fromAttributes(e),i=this.codeMirror,o=this,s=[],a=0;a<t.length;a++){var u=i.posFromIndex(t.pos+a),h=i.posFromIndex(t.pos+a+1),c={collapsed:!0,atomic:!0,inclusiveLeft:!1,inclusiveRight:!1},l=this.createEntityHandle_(n,t.pos),p=this.entityManager_.renderToElement(n,l)
p&&(c.replacedWith=p)
var d=i.markText(u,h,c)
s.push(d),l.setMarker(d)}t.attachObject({clear:function(){for(var t=0;t<s.length;t++)s[t].clear()},update:function(t){for(var e=r.Entity.fromAttributes(t),n=0;n<s.length;n++)o.entityManager_.updateElement(e,s[n].replacedWith)}}),this.queueRefresh_()},u.prototype.queueRefresh_=function(){var t=this
this.refreshTimer_||(this.refreshTimer_=setTimeout((function(){t.codeMirror.refresh(),t.refreshTimer_=null}),0))},u.prototype.createEntityHandle_=function(t,e){var n=null,i=this
function o(){if(n){var t=n.find()
return t?i.codeMirror.indexFromPos(t.from):null}return e}return{find:o,remove:function(){var t=o()
null!=t&&(i.codeMirror.focus(),i.removeText(t,t+1))},replace:function(e){var n=r.AttributeConstants.ENTITY_SENTINEL,s=n+"_",a=o()
i.updateTextAttributes(a,a+1,(function(r){for(var i in r)delete r[i]
for(var o in r[n]=t.type,e)r[s+o]=e[o]}))},setMarker:function(t){n=t}}},u.prototype.lineClassRemover_=function(t){var e=this.codeMirror,n=e.getLineHandle(t)
return{clear:function(){e.removeLineClass(n,"text",".*")}}},u.prototype.emptySelection_=function(){var t=this.codeMirror.getCursor("start"),e=this.codeMirror.getCursor("end")
return t.line===e.line&&t.ch===e.ch},u.prototype.onCodeMirrorBeforeChange_=function(t,e){if("+input"===e.origin||"paste"===e.origin){for(var n=[],r=0;r<e.text.length;r++){var i=e.text[r]
i=i.replace(new RegExp("["+h+c+"]","g"),""),n.push(i)}e.update(e.from,e.to,n)}},u.prototype.onCodeMirrorChange_=function(t,n){if("object"==o(n.from)){for(var r=[];n;)r.push(n),n=n.next
n=r}for(var i=this.convertCoordinateSystemForChanges_(n),s=[],a=0;a<i.length;a++){var u,h=i[a],c=h.start,l=(h.end,h.text),p=h.removed,f=h.origin
if(p.length>0){for(var y=this.annotationList_.getAnnotatedSpansForSpan(new e(c,p.length)),g=0,_=0;_<y.length;_++){var v=y[_]
s.push({start:c,end:c+v.length,removedAttributes:v.annotation.attributes,removed:p.substr(g,v.length),attributes:{},text:"",origin:h.origin}),g+=v.length}this.annotationList_.removeSpan(new e(c,p.length))}l.length>0&&("+input"===h.origin||"paste"===h.origin?u=this.currentAttributes_||{}:f in this.outstandingChanges_?(u=this.outstandingChanges_[f].attributes,f=this.outstandingChanges_[f].origOrigin,delete this.outstandingChanges_[f]):u={},this.annotationList_.insertAnnotatedSpan(new e(c,l.length),new d(u)),s.push({start:c,end:c,removedAttributes:{},removed:"",text:l,attributes:u,origin:f}))}this.markLineSentinelCharactersForChanges_(n),s.length>0&&this.trigger("change",this,s)},u.prototype.convertCoordinateSystemForChanges_=function(t){var e=this,n=function(t){return e.codeMirror.indexFromPos(t)}
function r(t,e){return function(n){return l(n,e.from)?t(n):l(e.to,n)?t({line:n.line+e.text.length-1-(e.to.line-e.from.line),ch:e.to.line<n.line?n.ch:e.text.length<=1?n.ch-(e.to.ch-e.from.ch)+p(e.text):n.ch-e.to.ch+(r=e.text,r[r.length-1]).length})+p(e.removed)-p(e.text):e.from.line===n.line?t(e.from)+n.ch-e.from.ch:t(e.from)+p(e.removed.slice(0,n.line-e.from.line))+1+n.ch
var r}}for(var i=[],o=t.length-1;o>=0;o--){var s=t[o],a=(n=r(n,s))(s.from),u=s.removed.join("\n"),h=s.text.join("\n")
i.unshift({start:a,end:a+u.length,removed:u,text:h,origin:s.origin})}return i},u.prototype.markLineSentinelCharactersForChanges_=function(t){for(var e=Number.MAX_VALUE,n=-1,r=0;r<t.length;r++){var i=t[r],o=i.from.line
i.from.ch,(i.removed.length>1||i.removed[0].indexOf(h)>=0)&&(e=Math.min(e,o),n=Math.max(n,o)),i.text.length>1?(e=Math.min(e,o),n=Math.max(n,o+i.text.length-1)):i.text[0].indexOf(h)>=0&&(e=Math.min(e,o),n=Math.max(n,o))}n=Math.min(n,this.codeMirror.lineCount()-1),this.markLineSentinelCharactersForChangedLines_(e,n)},u.prototype.markLineSentinelCharactersForChangedLines_=function(t,e){if(t<Number.MAX_VALUE)for(;t>0&&this.lineIsListItemOrIndented_(t-1);)t--
if(e>-1)for(var n=this.codeMirror.lineCount();e+1<n&&this.lineIsListItemOrIndented_(e+1);)e++
for(var r=[],i=this.codeMirror,o=t;o<=e;o++){var s=i.getLine(o),a=i.getLineHandle(o)
if(i.removeLineClass(a,"text",".*"),s.length>0)for(var u=s.indexOf(h);u>=0;){for(var c=u;u<s.length&&s[u]===h;){for(var l=i.findMarksAt({line:o,ch:u}),p=0;p<l.length;p++)l[p].isForLineSentinel&&l[p].clear()
u++}this.markLineSentinelCharacters_(o,c,u,r),u=s.indexOf(h,u)}else r=[]}return e},u.prototype.markLineSentinelCharacters_=function(t,e,n,r){var o=this.codeMirror,s=null,a=null,u=function(){var t=a.find()
return t?t.from.line:null}
if(0===e){var h=this.getLineAttributes_(t),c=h[i.LIST_TYPE],l=h[i.LINE_INDENT]||0
for(c&&0===l&&(l=1);l>=r.length;)r.push(1)
"o"===c?(s=this.makeOrderedListElement_(r[l]),r[l]++):"u"===c?(s=this.makeUnorderedListElement_(),r[l]=1):"t"===c?(s=this.makeTodoListElement_(!1,u),r[l]=1):"tc"===c&&(s=this.makeTodoListElement_(!0,u),r[l]=1)
var p=this.getClassNameForAttributes_(h)
""!==p&&this.codeMirror.addLineClass(t,"text",p),r[l+1]=1}var d={inclusiveLeft:!0,collapsed:!0}
s&&(d.replacedWith=s),(a=o.markText({line:t,ch:e},{line:t,ch:n},d)).isForLineSentinel=!0},u.prototype.makeOrderedListElement_=function(t){return n.elt("div",t+".",{class:"firepad-list-left"})},u.prototype.makeUnorderedListElement_=function(){return n.elt("div","•",{class:"firepad-list-left"})},u.prototype.toggleTodo=function(t){var e,n=i.LIST_TYPE,r=this.getCurrentLineAttributes_()
!(n in r)||"t"!==r[n]&&"tc"!==r[n]?e="t":"t"===r[n]?e="tc":"tc"===r[n]&&(e=!!t&&"t"),this.setLineAttribute(n,e)},u.prototype.makeTodoListElement_=function(t,e){var r={type:"checkbox",class:"firepad-todo-left"}
t&&(r.checked=!0)
var i=n.elt("input",!1,r),o=this
return n.on(i,"click",n.stopEventAnd((function(t){o.codeMirror.setCursor({line:e(),ch:1}),o.toggleTodo(!0)}))),i},u.prototype.lineIsListItemOrIndented_=function(t){var e=this.getLineAttributes_(t)
return!1!==(e[i.LIST_TYPE]||!1)||0!==(e[i.LINE_INDENT]||0)},u.prototype.onCursorActivity_=function(){var t=this
setTimeout((function(){t.updateCurrentAttributes_()}),1)},u.prototype.getCurrentAttributes_=function(){return this.currentAttributes_||this.updateCurrentAttributes_(),this.currentAttributes_},u.prototype.updateCurrentAttributes_=function(){var t=this.codeMirror,e=t.indexFromPos(t.getCursor("anchor")),n=t.indexFromPos(t.getCursor("head")),o=n
if(e>n){for(;o<this.end();){var s=this.getRange(o,o+1)
if("\n"!==s&&s!==h)break
o++}o<this.end()&&o++}else for(;o>0&&("\n"===(s=this.getRange(o-1,o))||s===h);)o--
var a=this.annotationList_.getAnnotatedSpansForPos(o)
this.currentAttributes_={}
var u={}
for(var c in a.length>0&&!(i.LINE_SENTINEL in a[0].annotation.attributes)?u=a[0].annotation.attributes:a.length>1&&(r.utils.assert(!(i.LINE_SENTINEL in a[1].annotation.attributes),"Cursor can't be between two line sentinel characters."),u=a[1].annotation.attributes),u)"l"!==c&&"lt"!==c&&"li"!==c&&0!==c.indexOf(i.ENTITY_SENTINEL)&&(this.currentAttributes_[c]=u[c])},u.prototype.getCurrentLineAttributes_=function(){var t=this.codeMirror,e=t.getCursor("anchor"),n=t.getCursor("head"),r=n.line
return 0===n.ch&&e.line<n.line&&r--,this.getLineAttributes_(r)},u.prototype.getLineAttributes_=function(t){var n={},i=this.codeMirror.getLine(t)
if(i.length>0&&i[0]===h){var o=this.codeMirror.indexFromPos({line:t,ch:0}),s=this.annotationList_.getAnnotatedSpansForSpan(new e(o,1))
for(var a in r.utils.assert(1===s.length),s[0].annotation.attributes)n[a]=s[0].annotation.attributes[a]}return n},u.prototype.clearAnnotations_=function(){this.annotationList_.updateSpan(new e(0,this.end()),(function(t,e){return new d({})}))},u.prototype.newline=function(){var t=this.codeMirror,e=this
if(this.emptySelection_()){var n=t.getCursor("head").line,r=this.getLineAttributes_(n),o=r[i.LIST_TYPE]
o&&1===t.getLine(n).length?this.updateLineAttributes(n,n,(function(t){delete t[i.LIST_TYPE],delete t[i.LINE_INDENT]})):(t.replaceSelection("\n","end","+input"),this.updateLineAttributes(n+1,n+1,(function(t){for(var s in r)t[s]=r[s]
"tc"===o&&(t[i.LIST_TYPE]="t"),e.trigger("newLine",{line:n+1,attr:t})})))}else t.replaceSelection("\n","end","+input")},u.prototype.deleteLeft=function(){var t=this.codeMirror,e=t.getCursor("head"),n=this.getLineAttributes_(e.line),r=n[i.LIST_TYPE],o=n[i.LINE_INDENT],s=this.emptySelection_()&&1===e.ch
s&&r?this.updateLineAttributes(e.line,e.line,(function(t){delete t[i.LIST_TYPE],delete t[i.LINE_INDENT]})):s&&o&&o>0?this.unindent():t.deleteH(-1,"char")},u.prototype.deleteRight=function(){var t=this.codeMirror,e=t.getCursor("head"),n=t.getLine(e.line),r=this.areLineSentinelCharacters_(n),i=e.line+1<t.lineCount()?t.getLine(e.line+1):""
this.emptySelection_()&&r&&i[0]===h?(t.replaceRange("",{line:e.line,ch:0},{line:e.line+1,ch:0},"+input"),t.setCursor({line:e.line,ch:0})):t.deleteH(1,"char")},u.prototype.indent=function(){this.updateLineAttributesForSelection((function(t){var e=t[i.LINE_INDENT],n=t[i.LIST_TYPE]
e?t[i.LINE_INDENT]++:t[i.LINE_INDENT]=n?2:1}))},u.prototype.unindent=function(){this.updateLineAttributesForSelection((function(t){var e=t[i.LINE_INDENT]
e&&e>1?t[i.LINE_INDENT]=e-1:(delete t[i.LIST_TYPE],delete t[i.LINE_INDENT])}))},u.prototype.getText=function(){return this.codeMirror.getValue().replace(new RegExp(h,"g"),"")},u.prototype.areLineSentinelCharacters_=function(t){for(var e=0;e<t.length;e++)if(t[e]!==h)return!1
return!0},d.prototype.equals=function(t){if(!(t instanceof d))return!1
var e
for(e in this.attributes)if(t.attributes[e]!==this.attributes[e])return!1
for(e in t.attributes)if(t.attributes[e]!==this.attributes[e])return!1
return!0},u}(),(r=r||{}).RichTextCodeMirrorAdapter=function(){"use strict"
var t=r.TextOperation,e=r.WrappedOperation,n=r.Cursor
function i(t){this.rtcm=t,this.cm=t.codeMirror,u(this,"onChange"),u(this,"onAttributesChange"),u(this,"onCursorActivity"),u(this,"onFocus"),u(this,"onBlur"),this.rtcm.on("change",this.onChange),this.rtcm.on("attributesChange",this.onAttributesChange),this.cm.on("cursorActivity",this.onCursorActivity),this.cm.on("focus",this.onFocus),this.cm.on("blur",this.onBlur)}function s(t){var e=t.lineCount()-1
return t.indexFromPos({line:e,ch:t.getLine(e).length})}function a(t,e){if(!t)throw new Error(e||"assertion error")}function u(t,e){var n=t[e]
t[e]=function(){n.apply(t,arguments)}}function h(t){for(var e in t)return!1
return!0}function c(t,e){if("string"!=typeof t)throw new TypeError("Expected a string")
3===(t=t.replace(/^#/,"")).length&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2])
var n,r=parseInt(t,16),i=[r>>16,r>>8&255,255&r],o="rgb"
return null!==(n=e)&&void 0!==n&&(o="rgba",i.push(e)),o+"("+i.join(",")+")"}return i.prototype.detach=function(){this.rtcm.off("change",this.onChange),this.rtcm.off("attributesChange",this.onAttributesChange),this.cm.off("cursorActivity",this.onCursorActivity),this.cm.off("focus",this.onFocus),this.cm.off("blur",this.onBlur)},i.operationFromCodeMirrorChanges=function(e,n){for(var r=s(n),i=(new t).retain(r),o=(new t).retain(r),a=e.length-1;a>=0;a--){var u=e[a],h=u.start,c=r-h-u.text.length
i=(new t).retain(h).delete(u.removed.length).insert(u.text,u.attributes).retain(c).compose(i),o=o.compose((new t).retain(h).delete(u.text.length).insert(u.removed,u.removedAttributes).retain(c)),r+=u.removed.length-u.text.length}return[i,o]},i.operationFromAttributesChanges=function(e,n){for(var r=s(n),i=new t,o=new t,u=0,h=0;h<e.length;h++){var c=e[h],l=c.start-u
a(l>=0),i.retain(l),o.retain(l)
var p=c.end-c.start
i.retain(p,c.attributes),o.retain(p,c.attributesInverse),u=c.start+p}return i.retain(r-u),o.retain(r-u),[i,o]},i.prototype.registerCallbacks=function(t){this.callbacks=t},i.prototype.onChange=function(t,e){if("RTCMADAPTER"!==e[0].origin){var n=i.operationFromCodeMirrorChanges(e,this.cm)
this.trigger("change",n[0],n[1])}},i.prototype.onAttributesChange=function(t,e){if("RTCMADAPTER"!==e[0].origin){var n=i.operationFromAttributesChanges(e,this.cm)
this.trigger("change",n[0],n[1])}},i.prototype.onCursorActivity=function(){var t=this
setTimeout((function(){t.trigger("cursorActivity")}),1)},i.prototype.onFocus=function(){this.trigger("focus")},i.prototype.onBlur=function(){this.cm.somethingSelected()||this.trigger("blur")},i.prototype.getValue=function(){return this.cm.getValue()},i.prototype.getCursor=function(){var t,e=this.cm,r=e.getCursor(),i=e.indexFromPos(r)
if(e.somethingSelected()){var o=e.getCursor(!0),s=0===function(t,e){return t.line<e.line?-1:t.line>e.line?1:t.ch<e.ch?-1:t.ch>e.ch?1:0}(r,o)?e.getCursor(!1):o
t=e.indexFromPos(s)}else t=i
return new n(i,t)},i.prototype.setCursor=function(t){this.cm.setSelection(this.cm.posFromIndex(t.position),this.cm.posFromIndex(t.selectionEnd))},i.prototype.addStyleRule=function(t){if("undefined"!=typeof document&&null!==document){if(!this.addedStyleRules){this.addedStyleRules={}
var e=document.createElement("style")
document.documentElement.getElementsByTagName("head")[0].appendChild(e),this.addedStyleSheet=e.sheet}if(!this.addedStyleRules[t])return this.addedStyleRules[t]=!0,this.addedStyleSheet.insertRule(t,0)}},i.prototype.setOtherCursor=function(t,e,n){var r=this.cm.posFromIndex(t.position)
if("string"==typeof e&&e.match(/^#[a-fA-F0-9]{3,6}$/)){var i=this.rtcm.end()
if("object"==o(t)&&"number"==typeof t.position&&"number"==typeof t.selectionEnd&&!(t.position<0||t.position>i||t.selectionEnd<0||t.selectionEnd>i)){if(t.position===t.selectionEnd){var s=this.cm.cursorCoords(r),a=document.createElement("span")
return a.className="other-client",a.style.borderLeftWidth="2px",a.style.borderLeftStyle="solid",a.style.borderLeftColor=e,a.style.marginLeft=a.style.marginRight="-1px",a.style.height=.9*(s.bottom-s.top)+"px",a.setAttribute("data-clientid",n),a.style.zIndex=0,this.cm.setBookmark(r,{widget:a,insertLeft:!0})}var u,h,l="selection-"+e.replace("#",""),p="."+l+" { background: "+c(e)+";\n background: "+c(e,.4)+";}"
return this.addStyleRule(p),t.selectionEnd>t.position?(u=r,h=this.cm.posFromIndex(t.selectionEnd)):(u=this.cm.posFromIndex(t.selectionEnd),h=r),this.cm.markText(u,h,{className:l})}}},i.prototype.trigger=function(t){var e=Array.prototype.slice.call(arguments,1),n=this.callbacks&&this.callbacks[t]
n&&n.apply(this,e)},i.prototype.applyOperation=function(t){t.ops.length>10&&this.rtcm.codeMirror.getWrapperElement().setAttribute("style","display: none")
for(var e=t.ops,n=0,r=0,i=e.length;r<i;r++){var o=e[r]
o.isRetain()?(h(o.attributes)||this.rtcm.updateTextAttributes(n,n+o.chars,(function(t){for(var e in o.attributes)!1===o.attributes[e]?delete t[e]:t[e]=o.attributes[e]}),"RTCMADAPTER",!0),n+=o.chars):o.isInsert()?(this.rtcm.insertText(n,o.text,o.attributes,"RTCMADAPTER"),n+=o.text.length):o.isDelete()&&this.rtcm.removeText(n,n+o.chars,"RTCMADAPTER")}t.ops.length>10&&(this.rtcm.codeMirror.getWrapperElement().setAttribute("style",""),this.rtcm.codeMirror.refresh())},i.prototype.registerUndo=function(t){this.cm.undo=t},i.prototype.registerRedo=function(t){this.cm.redo=t},i.prototype.invertOperation=function(n){for(var r,i,o=0,s=this.rtcm.codeMirror,a=new t,u=0;u<n.wrapped.ops.length;u++){var c=n.wrapped.ops[u]
if(c.isRetain())if(h(c.attributes))a.retain(c.chars),o+=c.chars
else for(r=this.rtcm.getAttributeSpans(o,o+c.chars),i=0;i<r.length;i++){var l={}
for(var p in c.attributes){var d=c.attributes[p],f=r[i].attributes[p]
!1===d?f&&(l[p]=f):d!==f&&(l[p]=f||!1)}a.retain(r[i].length,l),o+=r[i].length}else if(c.isInsert())a.delete(c.text.length)
else if(c.isDelete()){var y=s.getRange(s.posFromIndex(o),s.posFromIndex(o+c.chars))
r=this.rtcm.getAttributeSpans(o,o+c.chars)
var g=0
for(i=0;i<r.length;i++)a.insert(y.substr(g,r[i].length),r[i].attributes),g+=r[i].length
o+=c.chars}}return new e(a,n.meta.invert())},i}(),(r=r||{}).Formatting=function(){var t=r.AttributeConstants
function e(t){if(!(this instanceof e))return new e(t)
this.attributes=t||{}}return e.prototype.cloneWithNewAttribute_=function(t,n){var r={}
for(var i in this.attributes)r[i]=this.attributes[i]
return!1===n?delete r[t]:r[t]=n,new e(r)},e.prototype.bold=function(e){return this.cloneWithNewAttribute_(t.BOLD,e)},e.prototype.italic=function(e){return this.cloneWithNewAttribute_(t.ITALIC,e)},e.prototype.underline=function(e){return this.cloneWithNewAttribute_(t.UNDERLINE,e)},e.prototype.strike=function(e){return this.cloneWithNewAttribute_(t.STRIKE,e)},e.prototype.font=function(e){return this.cloneWithNewAttribute_(t.FONT,e)},e.prototype.fontSize=function(e){return this.cloneWithNewAttribute_(t.FONT_SIZE,e)},e.prototype.color=function(e){return this.cloneWithNewAttribute_(t.COLOR,e)},e.prototype.backgroundColor=function(e){return this.cloneWithNewAttribute_(t.BACKGROUND_COLOR,e)},e}(),(r=r||{}).Text=function t(e,n){if(!(this instanceof t))return new t(e,n)
this.text=e,this.formatting=n||r.Formatting()},(r=r||{}).LineFormatting=function(){var t=r.AttributeConstants
function e(n){if(!(this instanceof e))return new e(n)
this.attributes=n||{},this.attributes[t.LINE_SENTINEL]=!0}return e.LIST_TYPE={NONE:!1,ORDERED:"o",UNORDERED:"u",TODO:"t",TODOCHECKED:"tc"},e.prototype.cloneWithNewAttribute_=function(t,n){var r={}
for(var i in this.attributes)r[i]=this.attributes[i]
return!1===n?delete r[t]:r[t]=n,new e(r)},e.prototype.indent=function(e){return this.cloneWithNewAttribute_(t.LINE_INDENT,e)},e.prototype.align=function(e){return this.cloneWithNewAttribute_(t.LINE_ALIGN,e)},e.prototype.listItem=function(e){return r.utils.assert(!1===e||"u"===e||"o"===e||"t"===e||"tc"===e),this.cloneWithNewAttribute_(t.LIST_TYPE,e)},e.prototype.getIndent=function(){return this.attributes[t.LINE_INDENT]||0},e.prototype.getAlign=function(){return this.attributes[t.LINE_ALIGN]||0},e.prototype.getListItem=function(){return this.attributes[t.LIST_TYPE]||!1},e}(),(r=r||{}).Line=function t(e,n){if(!(this instanceof t))return new t(e,n)
"[object Array]"!==Object.prototype.toString.call(e)&&(e=void 0===e?[]:[e]),this.textPieces=e,this.formatting=n||r.LineFormatting()},(r=r||{}).ParseHtml=function(){var t,e=r.LineFormatting.LIST_TYPE
function n(t,n,i){this.listType=t||e.UNORDERED,this.lineFormatting=n||r.LineFormatting(),this.textFormatting=i||r.Formatting()}function i(){this.lines=[],this.currentLine=[],this.currentLineListItemType=null}n.prototype.withTextFormatting=function(t){return new n(this.listType,this.lineFormatting,t)},n.prototype.withLineFormatting=function(t){return new n(this.listType,t,this.textFormatting)},n.prototype.withListType=function(t){return new n(t,this.lineFormatting,this.textFormatting)},n.prototype.withIncreasedIndent=function(){var t=this.lineFormatting.indent(this.lineFormatting.getIndent()+1)
return new n(this.listType,t,this.textFormatting)},n.prototype.withAlign=function(t){var e=this.lineFormatting.align(t)
return new n(this.listType,e,this.textFormatting)},i.prototype.newlineIfNonEmpty=function(t){this.cleanLine_(),this.currentLine.length>0&&this.newline(t)},i.prototype.newlineIfNonEmptyOrListItem=function(t){this.cleanLine_(),(this.currentLine.length>0||null!==this.currentLineListItemType)&&this.newline(t)},i.prototype.newline=function(t){this.cleanLine_()
var e=t.lineFormatting
null!==this.currentLineListItemType&&(e=e.listItem(this.currentLineListItemType),this.currentLineListItemType=null),this.lines.push(r.Line(this.currentLine,e)),this.currentLine=[]},i.prototype.makeListItem=function(t){this.currentLineListItemType=t},i.prototype.cleanLine_=function(){if(this.currentLine.length>0){var t=this.currentLine.length-1
this.currentLine[0].text=this.currentLine[0].text.replace(/^ +/,""),this.currentLine[t].text=this.currentLine[t].text.replace(/ +$/g,"")
for(var e=0;e<this.currentLine.length;e++)this.currentLine[e].text=this.currentLine[e].text.replace(/\u00a0/g," ")}1===this.currentLine.length&&""===this.currentLine[0].text&&(this.currentLine=[])}
var o=o||{ELEMENT_NODE:1,TEXT_NODE:3}
function s(n,i,s){if(n.nodeType===o.ELEMENT_NODE){var u=t.fromElement(n)
if(u)return void s.currentLine.push(new r.Text(r.sentinelConstants.ENTITY_SENTINEL_CHARACTER,new r.Formatting(u.toAttributes())))}switch(n.nodeType){case o.TEXT_NODE:var h=n.nodeValue.replace(/[ \n\t]+/g," ")
s.currentLine.push(r.Text(h,i.textFormatting))
break
case o.ELEMENT_NODE:switch(i=function(t,e){for(var n=t.textFormatting,i=t.lineFormatting,o=e.split(";"),s=0;s<o.length;s++){var a=o[s].split(":")
if(2===a.length){var u=r.utils.trim(a[0]).toLowerCase(),h=r.utils.trim(a[1]).toLowerCase()
switch(u){case"text-decoration":var c=h.indexOf("underline")>=0,l=h.indexOf("line-through")>=0
n=n.underline(c).strike(l)
break
case"font-weight":var p="bold"===h||parseInt(h)>=600
n=n.bold(p)
break
case"font-style":var d="italic"===h||"oblique"===h
n=n.italic(d)
break
case"color":n=n.color(h)
break
case"background-color":n=n.backgroundColor(h)
break
case"text-align":i=i.align(h)
break
case"font-size":var f=null
r.utils.stringEndsWith(h,["px","pt","%","em","xx-small","x-small","small","medium","large","x-large","xx-large","smaller","larger"])?f=h:parseInt(h)&&(f=parseInt(h)+"px"),f&&(n=n.fontSize(f))
break
case"font-family":var y=r.utils.trim(h.split(",")[0])
y=(y=y.replace(/['"]/g,"")).replace(/\w\S*/g,(function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})),n=n.font(y)}}}return t.withLineFormatting(i).withTextFormatting(n)}(i,n.getAttribute("style")||""),n.nodeName.toLowerCase()){case"div":case"h1":case"h2":case"h3":case"p":s.newlineIfNonEmpty(i),a(n,i,s),s.newlineIfNonEmpty(i)
break
case"center":i=i.withAlign("center"),s.newlineIfNonEmpty(i),a(n,i.withAlign("center"),s),s.newlineIfNonEmpty(i)
break
case"b":case"strong":a(n,i.withTextFormatting(i.textFormatting.bold(!0)),s)
break
case"u":a(n,i.withTextFormatting(i.textFormatting.underline(!0)),s)
break
case"i":case"em":a(n,i.withTextFormatting(i.textFormatting.italic(!0)),s)
break
case"s":a(n,i.withTextFormatting(i.textFormatting.strike(!0)),s)
break
case"font":var c=n.getAttribute("face"),l=n.getAttribute("color"),p=parseInt(n.getAttribute("size"))
c&&(i=i.withTextFormatting(i.textFormatting.font(c))),l&&(i=i.withTextFormatting(i.textFormatting.color(l))),p&&(i=i.withTextFormatting(i.textFormatting.fontSize(p))),a(n,i,s)
break
case"br":s.newline(i)
break
case"ul":s.newlineIfNonEmptyOrListItem(i)
var d="firepad-todo"===n.getAttribute("class")?e.TODO:e.UNORDERED
a(n,i.withListType(d).withIncreasedIndent(),s),s.newlineIfNonEmpty(i)
break
case"ol":s.newlineIfNonEmptyOrListItem(i),a(n,i.withListType(e.ORDERED).withIncreasedIndent(),s),s.newlineIfNonEmpty(i)
break
case"li":!function(t,n,r){r.newlineIfNonEmptyOrListItem(n)
var i="firepad-checked"===t.getAttribute("class")?e.TODOCHECKED:n.listType
r.makeListItem(i)
var o=r.currentLine
a(t,n,r),(o===r.currentLine||r.currentLine.length>0)&&r.newline(n)}(n,i,s)
break
case"style":break
default:a(n,i,s)}}}function a(t,e,n){if(t.hasChildNodes())for(var r=0;r<t.childNodes.length;r++)s(t.childNodes[r],e,n)}return function(e,o){var a=(r.document||document).createElement("div")
a.innerHTML=e,t=o
var u=new i
return s(a,new n,u),u.lines}}(),(r=r||{}).SerializeHtml=function(){var t=r.utils,e=r.AttributeConstants,n=r.LineFormatting.LIST_TYPE
function i(t){return t===n.ORDERED?"<ol>":t===n.UNORDERED?"<ul>":'<ul class="firepad-todo">'}function o(t){return t===n.ORDERED?"</ol>":"</ul>"}function s(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00a0/g,"&nbsp;")}return function(a,u){for(var h,c,l="",p=!0,d=[],f=!1,y=!0,g=!0,_=0,v=a.ops[_],m=!1;v;){t.assert(v.isInsert())
var b=v.attributes
if(p){p=!1
var C=0,E=null,w="left"
e.LINE_SENTINEL in b&&(C=b[e.LINE_INDENT]||0,E=b[e.LIST_TYPE]||null,w=b[e.LINE_ALIGN]||"left"),E&&(C=C||1),f?(l+="</li>",f=!1):y||(g&&(l+="<br/>"),l+="</div>"),y=!1,t.assert(C>=0,"Indent must not be negative.")
for(;d.length>C||C===d.length&&null!==E&&!((h=E)===(c=d[d.length-1])||h===n.TODO&&c===n.TODOCHECKED||h===n.TODOCHECKED&&c===n.TODO);)l+=o(d.pop())
for(;d.length<C;){var T=E||n.UNORDERED
m=E==n.TODO||E==n.TODOCHECKED||m,l+=i(T),d.push(T)}var S="left"!==w?' style="text-align:'+w+'"':""
if(E){var I=""
switch(E){case n.TODOCHECKED:I=' class="firepad-checked"'
break
case n.TODO:I=' class="firepad-unchecked"'}l+="<li"+I+S+">",f=!0}else l+="<div"+S+">"
g=!0}if(e.LINE_SENTINEL in b)v=a.ops[++_]
else if(e.ENTITY_SENTINEL in b){for(var N=0;N<v.text.length;N++){var x=r.Entity.fromAttributes(b)
l+=u.exportToElement(x).outerHTML}v=a.ops[++_]}else{var A="",R=""
for(var L in b){var O,D,k=b[L]
L===e.BOLD||L===e.ITALIC||L===e.UNDERLINE||L===e.STRIKE?(t.assert(!0===k),O=D=L):L===e.FONT_SIZE?(O='span style="font-size: '+k,O+="string"!=typeof k||-1===k.indexOf("px",k.length-2)?'px"':'"',D="span"):L===e.FONT?(O='span style="font-family: '+k+'"',D="span"):L===e.COLOR?(O='span style="color: '+k+'"',D="span"):L===e.BACKGROUND_COLOR?(O='span style="background-color: '+k+'"',D="span"):t.log(!1,"Encountered unknown attribute while rendering html: "+L),O&&(A+="<"+O+">"),D&&(R="</"+D+">"+R)}var P=v.text,F=P.indexOf("\n")
F>=0?(p=!0,v=F<P.length-1?new r.TextOp("insert",P.substr(F+1),b):a.ops[++_],P=P.substr(0,F)):v=a.ops[++_],(P=P.replace(/  +/g,(function(t){return new Array(t.length+1).join(" ")})).replace(/^ /," ").replace(/ $/," ")).length>0&&(g=!1),l+=A+s(P)+R}}for(f?l+="</li>":y||(g&&(l+="&nbsp;"),l+="</div>");d.length>0;)l+=o(d.pop())
return m&&(l='<style>ul.firepad-todo { list-style: none; margin-left: 0; padding-left: 0; } ul.firepad-todo > li { padding-left: 1em; text-indent: -1em; } ul.firepad-todo > li:before { content: "\\2610"; padding-right: 5px; } ul.firepad-todo > li.firepad-checked:before { content: "\\2611"; padding-right: 5px; }</style>\n'+l),l}}(),(r=r||{}).textPiecesToInserts=function(t,e){var n=[]
function i(e,i){e instanceof r.Text&&(i=e.formatting.attributes,e=e.text),n.push({string:e,attributes:i}),t="\n"===e[e.length-1]}function o(e,n){t&&i(r.sentinelConstants.LINE_SENTINEL_CHARACTER,e.formatting.attributes)
for(var o=0;o<e.textPieces.length;o++)i(e.textPieces[o])
n&&i("\n")}for(var s=0;s<e.length;s++)e[s]instanceof r.Line?o(e[s],s<e.length-1):i(e[s])
return n},(r=r||{}).Headless=function(){var t=r.TextOperation,e=r.FirebaseAdapter,i=r.EntityManager,s=r.ParseHtml
function a(t){if(!(this instanceof a))return new a(t)
var r,s
"string"==typeof t?(void 0===window.firebase&&"object"!=o(r)?(console.log("REQUIRING"),r=n(153),n(157)):r=window.firebase,s=r.database().refFromURL(t)):s=t,this.entityManager_=new i,this.firebaseAdapter_=new e(s),this.ready_=!1,this.zombie_=!1}return a.prototype.getDocument=function(t){var e=this
if(e.ready_)return t(e.firebaseAdapter_.getDocument())
e.firebaseAdapter_.on("ready",(function(){e.ready_=!0,t(e.firebaseAdapter_.getDocument())}))},a.prototype.getText=function(t){if(this.zombie_)throw new Error("You can't use a firepad.Headless after calling dispose()!")
this.getDocument((function(e){var n=e.apply("")
for(var i in r.sentinelConstants)n=n.replace(new RegExp(r.sentinelConstants[i],"g"),"")
t(n)}))},a.prototype.setText=function(e,n){if(this.zombie_)throw new Error("You can't use a firepad.Headless after calling dispose()!")
var r=t().insert(e)
this.sendOperationWithRetry(r,n)},a.prototype.initializeFakeDom=function(t){if("object"==("undefined"==typeof document?"undefined":o(document))||"object"==o(r.document))t()
else{var e=new(0,n(160).JSDOM)("<head></head><body></body>").window
if(r.document)return e.close(),t()
r.document=e.document,t()}},a.prototype.getHtml=function(t){var e=this
if(this.zombie_)throw new Error("You can't use a firepad.Headless after calling dispose()!")
e.initializeFakeDom((function(){e.getDocument((function(n){t(r.SerializeHtml(n,e.entityManager_))}))}))},a.prototype.setHtml=function(e,n){var i=this
if(this.zombie_)throw new Error("You can't use a firepad.Headless after calling dispose()!")
i.initializeFakeDom((function(){for(var o=s(e,i.entityManager_),a=r.textPiecesToInserts(!0,o),u=new t,h=0;h<a.length;h++)u.insert(a[h].string,a[h].attributes)
i.sendOperationWithRetry(u,n)}))},a.prototype.sendOperationWithRetry=function(t,e){var n=this
n.getDocument((function(r){var i=t.clone().delete(r.targetLength)
n.firebaseAdapter_.sendOperation(i,(function(r,i){i?void 0!==e&&e(null,i):n.sendOperationWithRetry(t,e)}))}))},a.prototype.dispose=function(){this.zombie_=!0,this.firebaseAdapter_.dispose()},a}(),(r=r||{}).Firepad=function(t){if(!r.RichTextCodeMirrorAdapter)throw new Error("Oops! It looks like you're trying to include lib/firepad.js directly.  This is actually one of many source files that make up firepad.  You want dist/firepad.js instead.")
var e=r.RichTextCodeMirrorAdapter,n=r.RichTextCodeMirror,i=r.RichTextToolbar,o=r.ACEAdapter,s=r.MonacoAdapter,a=r.FirebaseAdapter,u=r.EditorClient,h=r.EntityManager,c=r.AttributeConstants,l=r.utils,p=(r.LineFormatting.LIST_TYPE,t.CodeMirror),d=t.ace
function f(r,i,c){if(!(this instanceof f))return new f(r,i,c)
if(!p&&!d&&!t.monaco)throw new Error("Couldn't find CodeMirror, ACE or Monaco.  Did you forget to include codemirror.js/ace.js or import monaco?")
if(this.zombie_=!1,p&&i instanceof p){this.codeMirror_=this.editor_=i
var y=this.codeMirror_.getValue()
if(""!==y)throw new Error("Can't initialize Firepad with a CodeMirror instance that already contains text.")}else if(d&&i&&i.session instanceof d.EditSession){if(this.ace_=this.editor_=i,""!==(y=this.ace_.getValue()))throw new Error("Can't initialize Firepad with an ACE instance that already contains text.")}else if(t.monaco&&i&&i instanceof t.monaco.constructor){if(t.monaco,this.monaco_=this.editor_=i,""!==(y=this.monaco_.getValue()))throw new Error("Can't initialize Firepad with a Monaco instance that already contains text.")}else this.codeMirror_=this.editor_=new p(i)
var g
g=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_?this.ace_.container:this.monaco_.getDomNode(),this.firepadWrapper_=l.elt("div",null,{class:"firepad"}),g.parentNode.replaceChild(this.firepadWrapper_,g),this.firepadWrapper_.appendChild(g),l.on(g,"dragstart",l.stopEvent),this.editor_.firepad=this,this.options_=c||{},this.getOption("richTextShortcuts",!1)&&(p.keyMap.richtext||this.initializeKeyMap_(),this.codeMirror_.setOption("keyMap","richtext"),this.firepadWrapper_.className+=" firepad-richtext"),this.imageInsertionUI=this.getOption("imageInsertionUI",!0),this.getOption("richTextToolbar",!1)&&(this.addToolbar_(),this.firepadWrapper_.className+=" firepad-richtext firepad-with-toolbar"),this.addPoweredByLogo_(),this.codeMirror_&&this.codeMirror_.refresh()
var _=this.getOption("userId",r.push().key),v=this.getOption("userColor",function(t){for(var e=1,n=0;n<t.length;n++)e=17*(e+t.charCodeAt(n))%360
return function(t,e,n){var r=function(t){return t<0&&(t+=1),t>1&&(t-=1),6*t<1?.5+3*t:2*t<1?1:3*t<2?.5+3*(2/3-t):.5}
return function(t,e,n){function r(t){var e=Math.round(255*t).toString(16)
return 1===e.length?"0"+e:e}return"#"+r(t)+r(e)+r(n)}(r(t+1/3),r(t),r(t-1/3))}(e/360)}(_))
this.entityManager_=new h,this.firebaseAdapter_=new a(r,_,v),this.codeMirror_?(this.richTextCodeMirror_=new n(this.codeMirror_,this.entityManager_,{cssPrefix:"firepad-"}),this.editorAdapter_=new e(this.richTextCodeMirror_)):this.ace_?this.editorAdapter_=new o(this.ace_):this.editorAdapter_=new s(this.monaco_),this.client_=new u(this.firebaseAdapter_,this.editorAdapter_)
var m=this
this.firebaseAdapter_.on("cursor",(function(){m.trigger.apply(m,["cursor"].concat([].slice.call(arguments)))})),this.codeMirror_&&this.richTextCodeMirror_.on("newLine",(function(){m.trigger.apply(m,["newLine"].concat([].slice.call(arguments)))})),this.firebaseAdapter_.on("ready",(function(){m.ready_=!0,this.ace_&&this.editorAdapter_.grabDocumentState(),this.monaco_&&this.editorAdapter_.grabDocumentState()
var t=m.getOption("defaultText",null)
t&&m.isHistoryEmpty()&&m.setText(t),m.trigger("ready")})),this.client_.on("synced",(function(t){m.trigger("synced",t)})),"Microsoft Internet Explorer"==navigator.appName&&navigator.userAgent.match(/MSIE 8\./)&&(window.onload=function(){var t=document.getElementsByTagName("head")[0],e=document.createElement("style")
e.type="text/css",e.styleSheet.cssText=":before,:after{content:none !important;}",t.appendChild(e),setTimeout((function(){t.removeChild(e)}),0)})}return t.monaco,l.makeEventEmitter(f),f.fromCodeMirror=f,f.fromACE=f,f.fromMonaco=f,f.prototype.dispose=function(){this.zombie_=!0,this.codeMirror_?editorWrapper=this.codeMirror_.getWrapperElement():this.ace_?editorWrapper=this.ace_.container:editorWrapper=this.monaco_.getDomNode(),this.firepadWrapper_.removeChild(editorWrapper),this.firepadWrapper_.parentNode.replaceChild(editorWrapper,this.firepadWrapper_),this.editor_.firepad=null,this.codeMirror_&&"richtext"===this.codeMirror_.getOption("keyMap")&&this.codeMirror_.setOption("keyMap","default"),this.firebaseAdapter_.dispose(),this.editorAdapter_.detach(),this.richTextCodeMirror_&&this.richTextCodeMirror_.detach()},f.prototype.setUserId=function(t){this.firebaseAdapter_.setUserId(t)},f.prototype.setUserColor=function(t){this.firebaseAdapter_.setColor(t)},f.prototype.getText=function(){return this.assertReady_("getText"),this.codeMirror_?this.richTextCodeMirror_.getText():this.ace_?this.ace_.getSession().getDocument().getValue():this.monaco_.getModel().getValue()},f.prototype.setText=function(t){return this.assertReady_("setText"),this.monaco_?this.monaco_.getModel().setValue(t):this.ace_?this.ace_.getSession().getDocument().setValue(t):(this.codeMirror_.getWrapperElement().setAttribute("style","display: none"),this.codeMirror_.setValue(""),this.insertText(0,t),this.codeMirror_.getWrapperElement().setAttribute("style",""),this.codeMirror_.refresh(),void this.editorAdapter_.setCursor({position:0,selectionEnd:0}))},f.prototype.insertTextAtCursor=function(t){this.insertText(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),t)},f.prototype.insertText=function(t,e){l.assert(!this.ace_,"Not supported for ace yet."),l.assert(!this.monaco_,"Not supported for monaco yet."),this.assertReady_("insertText"),"[object Array]"!==Object.prototype.toString.call(e)&&(e=[e])
var n=this
n.codeMirror_.operation((function(){for(var i=0===t,o=r.textPiecesToInserts(i,e),s=0;s<o.length;s++){var a=o[s].string,u=o[s].attributes
n.richTextCodeMirror_.insertText(t,a,u),t+=a.length}}))},f.prototype.getOperationForSpan=function(t,e){for(var n=this.richTextCodeMirror_.getRange(t,e),i=this.richTextCodeMirror_.getAttributeSpans(t,e),o=0,s=new r.TextOperation,a=0;a<i.length;a++)s.insert(n.substr(o,i[a].length),i[a].attributes),o+=i[a].length
return s},f.prototype.getHtml=function(){return this.getHtmlFromRange(null,null)},f.prototype.getHtmlFromSelection=function(){var t=this.codeMirror_.getCursor("start"),e=this.codeMirror_.getCursor("end"),n=this.codeMirror_.indexFromPos(t),r=this.codeMirror_.indexFromPos(e)
return this.getHtmlFromRange(n,r)},f.prototype.getHtmlFromRange=function(t,e){this.assertReady_("getHtmlFromRange")
var n=null!=t&&null!=e?this.getOperationForSpan(t,e):this.getOperationForSpan(0,this.codeMirror_.getValue().length)
return r.SerializeHtml(n,this.entityManager_)},f.prototype.insertHtml=function(t,e){var n=r.ParseHtml(e,this.entityManager_)
this.insertText(t,n)},f.prototype.insertHtmlAtCursor=function(t){this.insertHtml(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),t)},f.prototype.setHtml=function(t){var e=r.ParseHtml(t,this.entityManager_)
this.setText(e)},f.prototype.isHistoryEmpty=function(){return this.assertReady_("isHistoryEmpty"),this.firebaseAdapter_.isHistoryEmpty()},f.prototype.bold=function(){this.richTextCodeMirror_.toggleAttribute(c.BOLD),this.codeMirror_.focus()},f.prototype.italic=function(){this.richTextCodeMirror_.toggleAttribute(c.ITALIC),this.codeMirror_.focus()},f.prototype.underline=function(){this.richTextCodeMirror_.toggleAttribute(c.UNDERLINE),this.codeMirror_.focus()},f.prototype.strike=function(){this.richTextCodeMirror_.toggleAttribute(c.STRIKE),this.codeMirror_.focus()},f.prototype.fontSize=function(t){this.richTextCodeMirror_.setAttribute(c.FONT_SIZE,t),this.codeMirror_.focus()},f.prototype.font=function(t){this.richTextCodeMirror_.setAttribute(c.FONT,t),this.codeMirror_.focus()},f.prototype.color=function(t){this.richTextCodeMirror_.setAttribute(c.COLOR,t),this.codeMirror_.focus()},f.prototype.highlight=function(){this.richTextCodeMirror_.toggleAttribute(c.BACKGROUND_COLOR,"rgba(255,255,0,.65)"),this.codeMirror_.focus()},f.prototype.align=function(t){if("left"!==t&&"center"!==t&&"right"!==t)throw new Error('align() must be passed "left", "center", or "right".')
this.richTextCodeMirror_.setLineAttribute(c.LINE_ALIGN,t),this.codeMirror_.focus()},f.prototype.orderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(c.LIST_TYPE,"o"),this.codeMirror_.focus()},f.prototype.unorderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(c.LIST_TYPE,"u"),this.codeMirror_.focus()},f.prototype.todo=function(){this.richTextCodeMirror_.toggleTodo(),this.codeMirror_.focus()},f.prototype.newline=function(){this.richTextCodeMirror_.newline()},f.prototype.deleteLeft=function(){this.richTextCodeMirror_.deleteLeft()},f.prototype.deleteRight=function(){this.richTextCodeMirror_.deleteRight()},f.prototype.indent=function(){this.richTextCodeMirror_.indent(),this.codeMirror_.focus()},f.prototype.unindent=function(){this.richTextCodeMirror_.unindent(),this.codeMirror_.focus()},f.prototype.undo=function(){this.codeMirror_.undo()},f.prototype.redo=function(){this.codeMirror_.redo()},f.prototype.insertEntity=function(t,e,n){this.richTextCodeMirror_.insertEntityAtCursor(t,e,n)},f.prototype.insertEntityAt=function(t,e,n,r){this.richTextCodeMirror_.insertEntityAt(t,e,n,r)},f.prototype.registerEntity=function(t,e){this.entityManager_.register(t,e)},f.prototype.getOption=function(t,e){return t in this.options_?this.options_[t]:e},f.prototype.assertReady_=function(t){if(!this.ready_)throw new Error('You must wait for the "ready" event before calling '+t+".")
if(this.zombie_)throw new Error("You can't use a Firepad after calling dispose()!  [called "+t+"]")},f.prototype.makeImageDialog_=function(){this.makeDialog_("img","Insert image url")},f.prototype.makeDialog_=function(t,e){var n=this,r=l.elt("input",null,{class:"firepad-dialog-input",id:t,type:"text",placeholder:e,autofocus:"autofocus"}),i=l.elt("a","Submit",{class:"firepad-btn",id:"submitbtn"})
l.on(i,"click",l.stopEventAnd((function(){var e=document.getElementById("overlay")
e.style.visibility="hidden"
var r=document.getElementById(t).value
null!==r&&n.insertEntity(t,{src:r}),n.firepadWrapper_.removeChild(e)})))
var o=l.elt("a","Cancel",{class:"firepad-btn"})
l.on(o,"click",l.stopEventAnd((function(){var t=document.getElementById("overlay")
t.style.visibility="hidden",n.firepadWrapper_.removeChild(t)})))
var s=l.elt("div",[i,o],{class:"firepad-btn-group"}),a=l.elt("div",[r,s],{class:"firepad-dialog-div"}),u=l.elt("div",[a],{class:"firepad-dialog",id:"overlay"})
this.firepadWrapper_.appendChild(u)},f.prototype.addToolbar_=function(){this.toolbar=new i(this.imageInsertionUI),this.toolbar.on("undo",this.undo,this),this.toolbar.on("redo",this.redo,this),this.toolbar.on("bold",this.bold,this),this.toolbar.on("italic",this.italic,this),this.toolbar.on("underline",this.underline,this),this.toolbar.on("strike",this.strike,this),this.toolbar.on("font-size",this.fontSize,this),this.toolbar.on("font",this.font,this),this.toolbar.on("color",this.color,this),this.toolbar.on("left",(function(){this.align("left")}),this),this.toolbar.on("center",(function(){this.align("center")}),this),this.toolbar.on("right",(function(){this.align("right")}),this),this.toolbar.on("ordered-list",this.orderedList,this),this.toolbar.on("unordered-list",this.unorderedList,this),this.toolbar.on("todo-list",this.todo,this),this.toolbar.on("indent-increase",this.indent,this),this.toolbar.on("indent-decrease",this.unindent,this),this.toolbar.on("insert-image",this.makeImageDialog_,this),this.firepadWrapper_.insertBefore(this.toolbar.element(),this.firepadWrapper_.firstChild)},f.prototype.addPoweredByLogo_=function(){var t=l.elt("a",null,{class:"powered-by-firepad"})
t.setAttribute("href","http://www.firepad.io/"),t.setAttribute("target","_blank"),this.firepadWrapper_.appendChild(t)},f.prototype.initializeKeyMap_=function(){function t(t){return function(e){setTimeout((function(){t.call(e.firepad)}),0)}}p.keyMap.richtext={"Ctrl-B":t(this.bold),"Cmd-B":t(this.bold),"Ctrl-I":t(this.italic),"Cmd-I":t(this.italic),"Ctrl-U":t(this.underline),"Cmd-U":t(this.underline),"Ctrl-H":t(this.highlight),"Cmd-H":t(this.highlight),Enter:t(this.newline),Delete:t(this.deleteRight),Backspace:t(this.deleteLeft),Tab:t(this.indent),"Shift-Tab":t(this.unindent),fallthrough:["default"]}},f}(this),r.Firepad.Formatting=r.Formatting,r.Firepad.Text=r.Text,r.Firepad.Entity=r.Entity,r.Firepad.LineFormatting=r.LineFormatting,r.Firepad.Line=r.Line,r.Firepad.TextOperation=r.TextOperation,r.Firepad.Headless=r.Headless,r.Firepad.RichTextCodeMirrorAdapter=r.RichTextCodeMirrorAdapter,r.Firepad.ACEAdapter=r.ACEAdapter,r.Firepad.MonacoAdapter=r.MonacoAdapter,r.Firepad}),this)},151:function(t,e,n){"use strict"
function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */n.r(e),n.d(e,"__extends",(function(){return o})),n.d(e,"__assign",(function(){return s})),n.d(e,"__rest",(function(){return a})),n.d(e,"__decorate",(function(){return u})),n.d(e,"__param",(function(){return h})),n.d(e,"__metadata",(function(){return c})),n.d(e,"__awaiter",(function(){return l})),n.d(e,"__generator",(function(){return p})),n.d(e,"__createBinding",(function(){return d})),n.d(e,"__exportStar",(function(){return f})),n.d(e,"__values",(function(){return y})),n.d(e,"__read",(function(){return g})),n.d(e,"__spread",(function(){return _})),n.d(e,"__spreadArrays",(function(){return v})),n.d(e,"__await",(function(){return m})),n.d(e,"__asyncGenerator",(function(){return b})),n.d(e,"__asyncDelegator",(function(){return C})),n.d(e,"__asyncValues",(function(){return E})),n.d(e,"__makeTemplateObject",(function(){return w})),n.d(e,"__importStar",(function(){return T})),n.d(e,"__importDefault",(function(){return S})),n.d(e,"__classPrivateFieldGet",(function(){return I})),n.d(e,"__classPrivateFieldSet",(function(){return N}))
var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)}
function o(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var s=function(){return(s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])
return t}).apply(this,arguments)}
function a(t,e){var n={}
for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r])
if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0
for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}function u(t,e,n,i){var o,s=arguments.length,a=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i
if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i)
else for(var u=t.length-1;u>=0;u--)(o=t[u])&&(a=(s<3?o(a):s>3?o(e,n,a):o(e,n))||a)
return s>3&&a&&Object.defineProperty(e,n,a),a}function h(t,e){return function(n,r){e(n,r,t)}}function c(t,e){if("object"===("undefined"==typeof Reflect?"undefined":r(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function l(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e
t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))}function p(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1]
return i[1]},trys:[],ops:[]}
return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o
function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.")
for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i
switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o
break
case 4:return s.label++,{value:o[1],done:!1}
case 5:s.label++,r=o[1],o=[0]
continue
case 7:o=s.ops.pop(),s.trys.pop()
continue
default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0
continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1]
break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o
break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o)
break}i[2]&&s.ops.pop(),s.trys.pop()
continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1]
return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function d(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}function f(t,e){for(var n in t)"default"===n||e.hasOwnProperty(n)||(e[n]=t[n])}function y(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0
if(n)return n.call(t)
if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}
throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function g(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator]
if(!n)return t
var r,i,o=n.call(t),s=[]
try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function _(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(g(arguments[e]))
return t}function v(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length
var r=Array(t),i=0
for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s]
return r}function m(t){return this instanceof m?(this.v=t,this):new m(t)}function b(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.")
var r,i=n.apply(t,e||[]),o=[]
return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r
function s(t){i[t]&&(r[t]=function(e){return new Promise((function(n,r){o.push([t,e,n,r])>1||a(t,e)}))})}function a(t,e){try{(n=i[t](e)).value instanceof m?Promise.resolve(n.value.v).then(u,h):c(o[0][2],n)}catch(t){c(o[0][3],t)}var n}function u(t){a("next",t)}function h(t){a("throw",t)}function c(t,e){t(e),o.shift(),o.length&&a(o[0][0],o[0][1])}}function C(t){var e,n
return e={},r("next"),r("throw",(function(t){throw t})),r("return"),e[Symbol.iterator]=function(){return this},e
function r(r,i){e[r]=t[r]?function(e){return(n=!n)?{value:m(t[r](e)),done:"return"===r}:i?i(e):e}:i}}function E(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.")
var e,n=t[Symbol.asyncIterator]
return n?n.call(t):(t=y(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e)
function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,i){(function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)})(r,i,(e=t[n](e)).done,e.value)}))}}}function w(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function T(t){if(t&&t.__esModule)return t
var e={}
if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n])
return e.default=t,e}function S(t){return t&&t.__esModule?t:{default:t}}function I(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance")
return e.get(t)}function N(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance")
return e.set(t,n),n}},152:function(t,e,n){"use strict"
function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0})
var i=n(151),o={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},s=function(t,e){if(!t)throw a(e)},a=function(t){return new Error("Firebase Database ("+o.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},u=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r)
i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},h={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter")
this.init_()
for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],s=i+1<t.length,a=s?t[i+1]:0,u=i+2<t.length,h=u?t[i+2]:0,c=o>>2,l=(3&o)<<4|a>>4,p=(15&a)<<2|h>>6,d=63&h
u||(d=64,s||(p=64)),r.push(n[c],n[l],n[p],n[d])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(u(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++]
if(i<128)e[r++]=String.fromCharCode(i)
else if(i>191&&i<224){var o=t[n++]
e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var s=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(a=t[n++]))<<6|63&t[n++])-65536
e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{o=t[n++]
var a=t[n++]
e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_()
for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0,a=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64
if(++i,null==o||null==s||null==a||null==u)throw Error()
var h=o<<2|s>>4
if(r.push(h),64!==a){var c=s<<4&240|a>>2
if(r.push(c),64!==u){var l=a<<6&192|u
r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={}
for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},c=function(t){try{return h.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}

;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l(t,e){if(!(e instanceof Object))return e
switch(e.constructor){case Date:return new Date(e.getTime())
case Object:void 0===t&&(t={})
break
case Array:t=[]
break
default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=l(t[n],e[n]))
return t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var p=function(){function t(){var t=this
this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return t.prototype.wrapCallback=function(t){var e=this
return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch((function(){})),1===t.length?t(n):t(n,r))}},t}()

;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function f(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var y=function(t){function e(n,r){var i=t.call(this,r)||this
return i.code=n,i.name="FirebaseError",Object.setPrototypeOf(i,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,g.prototype.create),i}return i.__extends(e,t),e}(Error),g=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n]
for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],s=o?_(o,r):"Error",a=this.serviceName+": "+s+" ("+i+").",u=new y(i,a),h=0,c=Object.keys(r);h<c.length;h++){var l=c[h]
"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l])}return u},t}()
function _(t,e){return t.replace(v,(function(t,n){var r=e[n]
return null!=r?String(r):"<"+n+"?>"}))}var v=/\{\$([^}]+)}/g

;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m(t){return JSON.parse(t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var b=function(t){var e={},n={},r={},i=""
try{var o=t.split(".")
e=m(c(o[0])||""),n=m(c(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}},C=function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128
for(var t=1;t<this.blockSize;++t)this.pad_[t]=0
this.reset()}return t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0)
var n=this.W_
if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4
else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4
for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16]
n[r]=4294967295&(i<<1|i>>>31)}var o,s,a=this.chain_[0],u=this.chain_[1],h=this.chain_[2],c=this.chain_[3],l=this.chain_[4]
for(r=0;r<80;r++)r<40?r<20?(o=c^u&(h^c),s=1518500249):(o=u^h^c,s=1859775393):r<60?(o=u&h|c&(u|h),s=2400959708):(o=u^h^c,s=3395469782),i=(a<<5|a>>>27)+o+l+s+n[r]&4294967295,l=c,c=h,h=4294967295&(u<<30|u>>>2),u=a,a=i
this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+h&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length)
for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize
if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0
break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0
break}}this.inbuf_=o,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_
this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56))
for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256
this.compress_(this.buf_)
var r=0
for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)t[r]=this.chain_[n]>>i&255,++r
return t},t}(),E=function(){function t(t,e){var n=this
this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((function(){t(n)})).catch((function(t){n.error(t)}))}return t.prototype.next=function(t){this.forEachObserver((function(e){e.next(t)}))},t.prototype.error=function(t){this.forEachObserver((function(e){e.error(t)})),this.close(t)},t.prototype.complete=function(){this.forEachObserver((function(t){t.complete()})),this.close()},t.prototype.subscribe=function(t,e,n){var i,o=this
if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.")
void 0===(i=function(t,e){if("object"!==r(t)||null===t)return!1
for(var n=0,i=["next","error","complete"];n<i.length;n++){var o=i[n]
if(o in t&&"function"==typeof t[o])return!0}return!1}(t)?t:{next:t,error:e,complete:n}).next&&(i.next=w),void 0===i.error&&(i.error=w),void 0===i.complete&&(i.complete=w)
var s=this.unsubscribeOne.bind(this,this.observers.length)
return this.finalized&&this.task.then((function(){try{o.finalError?i.error(o.finalError):i.complete()}catch(t){}})),this.observers.push(i),s},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this
this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))},t.prototype.close=function(t){var e=this
this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((function(){e.observers=void 0,e.onNoObservers=void 0})))},t}()

;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w(){}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T(t,e,n){var r=""
switch(e){case 1:r=n?"first":"First"
break
case 2:r=n?"second":"Second"
break
case 3:r=n?"third":"Third"
break
case 4:r=n?"fourth":"Fourth"
break
default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}return t+" failed: "+(r+" argument ")}e.CONSTANTS=o,e.Deferred=p,e.ErrorFactory=g,e.FirebaseError=y,e.MAX_VALUE_MILLIS=144e5,e.RANDOM_FACTOR=.5,e.Sha1=C,e.areCookiesEnabled=function(){return!(!navigator||!navigator.cookieEnabled)},e.assert=s,e.assertionError=a,e.async=function(t,e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r]
Promise.resolve(!0).then((function(){t.apply(void 0,n)})).catch((function(t){e&&e(t)}))}},e.base64=h,e.base64Decode=c,e.base64Encode=function(t){var e=u(t)
return h.encodeByteArray(e,!0)},e.calculateBackoffMillis=function(t,e,n){void 0===e&&(e=1e3),void 0===n&&(n=2)
var r=e*Math.pow(n,t),i=Math.round(.5*r*(Math.random()-.5)*2)
return Math.min(144e5,r+i)},e.contains=
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.createSubscribe=function(t,e){var n=new E(t,e)
return n.subscribe.bind(n)},e.decode=b,e.deepCopy=
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){return l(void 0,t)},e.deepExtend=l,e.errorPrefix=T,e.getUA=d,e.isAdmin=function(t){var e=b(t).claims
return"object"===r(e)&&!0===e.admin},e.isBrowser=function(){return"object"===("undefined"==typeof self?"undefined":r(self))&&self.self===self},e.isBrowserExtension=function(){var t="object"===("undefined"==typeof chrome?"undefined":r(chrome))?chrome.runtime:"object"===("undefined"==typeof browser?"undefined":r(browser))?browser.runtime:void 0
return"object"===r(t)&&void 0!==t.id},e.isElectron=function(){return d().indexOf("Electron/")>=0},e.isEmpty=function(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1
return!0},e.isIE=function(){var t=d()
return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0},e.isIndexedDBAvailable=function(){return"indexedDB"in self&&null!=indexedDB},e.isMobileCordova=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())},e.isNode=f,e.isNodeSdk=function(){return!0===o.NODE_CLIENT||!0===o.NODE_ADMIN},e.isReactNative=function(){return"object"===("undefined"==typeof navigator?"undefined":r(navigator))&&"ReactNative"===navigator.product},e.isSafari=function(){return!f()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")},e.isUWP=function(){return d().indexOf("MSAppHost/")>=0},e.isValidFormat=function(t){var e=b(t).claims
return!!e&&"object"===r(e)&&e.hasOwnProperty("iat")},e.isValidTimestamp=function(t){var e=b(t).claims,n=Math.floor((new Date).getTime()/1e3),i=0,o=0
return"object"===r(e)&&(e.hasOwnProperty("nbf")?i=e.nbf:e.hasOwnProperty("iat")&&(i=e.iat),o=e.hasOwnProperty("exp")?e.exp:i+86400),!!n&&!!i&&!!o&&n>=i&&n<=o},e.issuedAtTime=function(t){var e=b(t).claims
return"object"===r(e)&&e.hasOwnProperty("iat")?e.iat:null},e.jsonEval=m,e.map=function(t,e,n){var r={}
for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t))
return r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */,e.querystring=function(t){for(var e=[],n=function(t,n){Array.isArray(n)?n.forEach((function(n){e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))})):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r]
n(o[0],o[1])}return e.length?"&"+e.join("&"):""},e.querystringDecode=function(t){var e={}
return t.replace(/^\?/,"").split("&").forEach((function(t){if(t){var n=t.split("=")
e[n[0]]=n[1]}})),e},e.safeGet=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0},e.stringLength=function(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n)
r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e},e.stringToByteArray=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r)
if(i>=55296&&i<=56319){var o=i-55296
r++,s(r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},e.stringify=function(t){return JSON.stringify(t)},e.validateArgCount=function(t,e,n,r){var i
if(r<e?i="at least "+e:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")},e.validateCallback=function(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(T(t,e,r)+"must be a valid function.")},e.validateContextObject=function(t,e,n,i){if((!i||n)&&("object"!==r(n)||null===n))throw new Error(T(t,e,i)+"must be a valid context object.")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */,e.validateIndexedDBOpenable=function(){return new Promise((function(t,e){try{var n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=window.indexedDB.open(r)
i.onsuccess=function(){i.result.close(),n||window.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=function(){n=!1},i.onerror=function(){var t
e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))},e.validateNamespace=function(t,e,n,r){if((!r||n)&&"string"!=typeof n)throw new Error(T(t,e,r)+"must be a valid firebase namespace.")}},153:function(t,e,n){"use strict"
function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var i=function(t){return t&&"object"===r(t)&&"default"in t?t:{default:t}}(n(154))

;/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */i.default.registerVersion("firebase","7.20.0","app"),t.exports=i.default},154:function(t,e,n){"use strict"
function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0})
var i,o,s=n(151),a=n(152),u=n(155),h=n(156),c=((i={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",i["bad-app-name"]="Illegal App name: '{$appName}",i["duplicate-app"]="Firebase App named '{$appName}' already exists",i["app-deleted"]="Firebase App named '{$appName}' already deleted",i["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",i["invalid-log-argument"]="First argument to `onLog` must be null or a function.",i),l=new a.ErrorFactory("app","Firebase",c),p=((o={})["@firebase/app"]="fire-core",o["@firebase/analytics"]="fire-analytics",o["@firebase/auth"]="fire-auth",o["@firebase/database"]="fire-rtdb",o["@firebase/functions"]="fire-fn",o["@firebase/installations"]="fire-iid",o["@firebase/messaging"]="fire-fcm",o["@firebase/performance"]="fire-perf",o["@firebase/remote-config"]="fire-rc",o["@firebase/storage"]="fire-gcs",o["@firebase/firestore"]="fire-fst",o["fire-js"]="fire-js",o["firebase-wrapper"]="fire-js-all",o),d=new h.Logger("@firebase/app"),f=function(){function t(t,e,n){var r,i,o=this
this.firebase_=n,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=a.deepCopy(t),this.container=new u.ComponentContainer(e.name),this._addComponent(new u.Component("app",(function(){return o}),"PUBLIC"))
try{for(var h=s.__values(this.firebase_.INTERNAL.components.values()),c=h.next();!c.done;c=h.next()){var l=c.value
this._addComponent(l)}}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),t.prototype.delete=function(){var t=this
return new Promise((function(e){t.checkDestroyed_(),e()})).then((function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map((function(t){return t.delete()})))})).then((function(){t.isDeleted_=!0}))},t.prototype._getService=function(t,e){return void 0===e&&(e="[DEFAULT]"),this.checkDestroyed_(),this.container.getProvider(t).getImmediate({identifier:e})},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e="[DEFAULT]"),this.container.getProvider(t).clearInstance(e)},t.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(e){d.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,e)}},t.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw l.create("app-deleted",{appName:this.name_})},t}()
f.prototype.name&&f.prototype.options||f.prototype.delete||console.log("dc")
var y=
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function t(){var e=
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){var e={},n=new Map,i={__esModule:!0,initializeApp:function(n,o){void 0===o&&(o={}),"object"===r(o)&&null!==o||(o={name:o})
var s=o
void 0===s.name&&(s.name="[DEFAULT]")
var u=s.name
if("string"!=typeof u||!u)throw l.create("bad-app-name",{appName:String(u)})
if(a.contains(e,u))throw l.create("duplicate-app",{appName:u})
var h=new t(n,s,i)
return e[u]=h,h},app:o,registerVersion:function(t,e,n){var r,i=null!==(r=p[t])&&void 0!==r?r:t
n&&(i+="-"+n)
var o=i.match(/\s|\//),s=e.match(/\s|\//)
if(o||s){var a=['Unable to register library "'+i+'" with version "'+e+'":']
return o&&a.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),o&&s&&a.push("and"),s&&a.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void d.warn(a.join(" "))}c(new u.Component(i+"-version",(function(){return{library:i,version:e}}),"VERSION"))},setLogLevel:h.setLogLevel,onLog:function(t,e){if(null!==t&&"function"!=typeof t)throw l.create("invalid-log-argument",{appName:name})
h.setUserLogHandler(t,e)},apps:null,SDK_VERSION:"7.20.0",INTERNAL:{registerComponent:c,removeApp:function(t){delete e[t]},components:n,useAsService:function(t,e){return"serverAuth"===e?null:e}}}
function o(t){if(t=t||"[DEFAULT]",!a.contains(e,t))throw l.create("no-app",{appName:t})
return e[t]}function c(r){var u,h,c=r.name
if(n.has(c))return d.debug("There were multiple attempts to register component "+c+"."),"PUBLIC"===r.type?i[c]:null
if(n.set(c,r),"PUBLIC"===r.type){var p=function(t){if(void 0===t&&(t=o()),"function"!=typeof t[c])throw l.create("invalid-app-argument",{appName:c})
return t[c]()}
void 0!==r.serviceProps&&a.deepExtend(p,r.serviceProps),i[c]=p,t.prototype[c]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]
var n=this._getService.bind(this,c)
return n.apply(this,r.multipleInstances?t:[])}}try{for(var f=s.__values(Object.keys(e)),y=f.next();!y.done;y=f.next()){var g=y.value
e[g]._addComponent(r)}}catch(t){u={error:t}}finally{try{y&&!y.done&&(h=f.return)&&h.call(f)}finally{if(u)throw u.error}}return"PUBLIC"===r.type?i[c]:null}return i.default=i,Object.defineProperty(i,"apps",{get:function(){return Object.keys(e).map((function(t){return e[t]}))}}),o.App=t,i}(f)
return e.INTERNAL=s.__assign(s.__assign({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){a.deepExtend(e,t)},createSubscribe:a.createSubscribe,ErrorFactory:a.ErrorFactory,deepExtend:a.deepExtend}),e}(),g=function(){function t(t){this.container=t}return t.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(t){if(function(t){var e=t.getComponent()
return"VERSION"===(null==e?void 0:e.type)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t)){var e=t.getImmediate()
return e.library+"/"+e.version}return null})).filter((function(t){return t})).join(" ")},t}()

;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */if(a.isBrowser()&&void 0!==self.firebase){d.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ")
var _=self.firebase.SDK_VERSION
_&&_.indexOf("LITE")>=0&&d.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var v=y.initializeApp
y.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]
return a.isNode()&&d.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),v.apply(void 0,t)}
var m=y
!function(t,e){t.INTERNAL.registerComponent(new u.Component("platform-logger",(function(t){return new g(t)}),"PRIVATE")),t.registerVersion("@firebase/app","0.6.11",void 0),t.registerVersion("fire-js","")}(m),e.default=m,e.firebase=m},155:function(t,e,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0})
var r=n(151),i=n(152),o=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}(),s=function(){function t(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}return t.prototype.get=function(t){void 0===t&&(t="[DEFAULT]")
var e=this.normalizeInstanceIdentifier(t)
if(!this.instancesDeferred.has(e)){var n=new i.Deferred
this.instancesDeferred.set(e,n)
try{var r=this.getOrInitializeService(e)
r&&n.resolve(r)}catch(t){}}return this.instancesDeferred.get(e).promise},t.prototype.getImmediate=function(t){var e=r.__assign({identifier:"[DEFAULT]",optional:!1},t),n=e.identifier,i=e.optional,o=this.normalizeInstanceIdentifier(n)
try{var s=this.getOrInitializeService(o)
if(!s){if(i)return null
throw Error("Service "+this.name+" is not available")}return s}catch(t){if(i)return null
throw t}},t.prototype.getComponent=function(){return this.component},t.prototype.setComponent=function(t){var e,n
if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".")
if(this.component)throw Error("Component for "+this.name+" has already been provided")
if(this.component=t,function(t){return"EAGER"===t.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t))try{this.getOrInitializeService("[DEFAULT]")}catch(t){}try{for(var i=r.__values(this.instancesDeferred.entries()),o=i.next();!o.done;o=i.next()){var s=r.__read(o.value,2),a=s[0],u=s[1],h=this.normalizeInstanceIdentifier(a)
try{var c=this.getOrInitializeService(h)
u.resolve(c)}catch(t){}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}},t.prototype.clearInstance=function(t){void 0===t&&(t="[DEFAULT]"),this.instancesDeferred.delete(t),this.instances.delete(t)},t.prototype.delete=function(){return r.__awaiter(this,void 0,void 0,(function(){var t
return r.__generator(this,(function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(r.__spread(t.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})),t.filter((function(t){return"_delete"in t})).map((function(t){return t._delete()}))))]
case 1:return e.sent(),[2]}}))}))},t.prototype.isComponentSet=function(){return null!=this.component},t.prototype.getOrInitializeService=function(t){var e=this.instances.get(t)
return!e&&this.component&&(e=this.component.instanceFactory(this.container,function(t){return"[DEFAULT]"===t?void 0:t}(t)),this.instances.set(t,e)),e||null},t.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:"[DEFAULT]":t},t}(),a=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name)
if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name)
e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t)
var e=new s(t,this)
return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}()
e.Component=o,e.ComponentContainer=a,e.Provider=s},156:function(t,e,n){"use strict"

;/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function r(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length
var r=Array(t),i=0
for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s]
return r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var i
n.r(e),n.d(e,"LogLevel",(function(){return o})),n.d(e,"Logger",(function(){return l})),n.d(e,"setLogLevel",(function(){return p})),n.d(e,"setUserLogHandler",(function(){return d}))
var o,s=[]
!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(o||(o={}))
var a={debug:o.DEBUG,verbose:o.VERBOSE,info:o.INFO,warn:o.WARN,error:o.ERROR,silent:o.SILENT},u=o.INFO,h=((i={})[o.DEBUG]="log",i[o.VERBOSE]="log",i[o.INFO]="info",i[o.WARN]="warn",i[o.ERROR]="error",i),c=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i]
if(!(e<t.logLevel)){var o=(new Date).toISOString(),s=h[e]
if(!s)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")
console[s].apply(console,r(["["+o+"]  "+t.name+":"],n))}},l=function(){function t(t){this.name=t,this._logLevel=u,this._logHandler=c,this._userLogHandler=null,s.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in o))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`')
this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?a[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function")
this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]
this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.DEBUG],t)),this._logHandler.apply(this,r([this,o.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]
this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.VERBOSE],t)),this._logHandler.apply(this,r([this,o.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]
this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.INFO],t)),this._logHandler.apply(this,r([this,o.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]
this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.WARN],t)),this._logHandler.apply(this,r([this,o.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]
this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.ERROR],t)),this._logHandler.apply(this,r([this,o.ERROR],t))},t}()
function p(t){s.forEach((function(e){e.setLogLevel(t)}))}function d(t,e){for(var n=function(n){var r=null
e&&e.level&&(r=a[e.level]),n.userLogHandler=null===t?null:function(e,n){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s]
var a=i.map((function(t){if(null==t)return null
if("string"==typeof t)return t
if("number"==typeof t||"boolean"==typeof t)return t.toString()
if(t instanceof Error)return t.message
try{return JSON.stringify(t)}catch(t){return null}})).filter((function(t){return t})).join(" ")
n>=(null!=r?r:e.logLevel)&&t({level:o[n].toLowerCase(),message:a,args:i,type:e.name})}},r=0,i=s;r<i.length;r++)n(i[r])}},157:function(t,e,n){"use strict"
n.r(e),n(158)},158:function(t,e,n){"use strict"
function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0})
var i=n(154),o=n(151),s=n(152),a=n(156),u=n(155)
var h,c=function(t){return t&&"object"===r(t)&&"default"in t?t:{default:t}}(i),l=function(){function t(t){this.domStorage_=t,this.prefix_="firebase:"}return t.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),s.stringify(e))},t.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t))
return null==e?null:s.jsonEval(e)},t.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},t.prototype.prefixedName_=function(t){return this.prefix_+t},t.prototype.toString=function(){return this.domStorage_.toString()},t}(),p=function(){function t(){this.cache_={},this.isInMemoryStorage=!0}return t.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},t.prototype.get=function(t){return s.contains(this.cache_,t)?this.cache_[t]:null},t.prototype.remove=function(t){delete this.cache_[t]},t}(),d=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t]
return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new l(e)}}catch(t){}return new p},f=d("localStorage"),y=d("sessionStorage"),g=new a.Logger("@firebase/database"),_=(h=1,function(){return h++}),v=function(t){var e=s.stringToByteArray(t),n=new s.Sha1
n.update(e)
var r=n.digest()
return s.base64.encodeByteArray(r)},m=function t(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n]
for(var i="",o=0;o<e.length;o++){var a=e[o]
Array.isArray(a)||a&&"object"===r(a)&&"number"==typeof a.length?i+=t.apply(null,a):"object"===r(a)?i+=s.stringify(a):i+=a,i+=" "}return i},b=null,C=!0,E=function(t,e){s.assert(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(g.logLevel=a.LogLevel.VERBOSE,b=g.log.bind(g),e&&y.set("logging_enabled",!0)):"function"==typeof t?b=t:(b=null,y.remove("logging_enabled"))},w=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]
if(!0===C&&(C=!1,null===b&&!0===y.get("logging_enabled")&&E(!0)),b){var n=m.apply(null,t)
b(n)}},T=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n]
w.apply(void 0,o.__spread([t],e))}},S=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]
var n="FIREBASE INTERNAL ERROR: "+m.apply(void 0,o.__spread(t))
g.error(n)},I=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]
var n="FIREBASE FATAL ERROR: "+m.apply(void 0,o.__spread(t))
throw g.error(n),new Error(n)},N=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]
var n="FIREBASE WARNING: "+m.apply(void 0,o.__spread(t))
g.warn(n)},x=function(t){return"number"==typeof t&&(t!=t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},A="[MIN_NAME]",R="[MAX_NAME]",L=function(t,e){if(t===e)return 0
if(t===A||e===R)return-1
if(e===A||t===R)return 1
var n=G(t),r=G(e)
return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},O=function(t,e){return t===e?0:t<e?-1:1},D=function(t,e){if(e&&t in e)return e[t]
throw new Error("Missing required key ("+t+") in object: "+s.stringify(e))},k=function t(e){if("object"!==r(e)||null===e)return s.stringify(e)
var n=[]
for(var i in e)n.push(i)
n.sort()
for(var o="{",a=0;a<n.length;a++)0!==a&&(o+=","),o+=s.stringify(n[a]),o+=":",o+=t(e[n[a]])
return o+"}"},P=function(t,e){var n=t.length
if(n<=e)return[t]
for(var r=[],i=0;i<n;i+=e)i+e>n?r.push(t.substring(i,n)):r.push(t.substring(i,i+e))
return r}

;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}var M,W,U,H,j,B,q,V,Q,z,Y=function(t){var e,n,r,i,o
s.assert(!x(t),"Invalid JSON number"),0===t?(n=0,r=0,e=1/t==-1/0?1:0):(e=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,r=Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(t/Math.pow(2,-1074))))
var a=[]
for(o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2)
for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2)
a.push(e?1:0),a.reverse()
var u=a.join(""),h=""
for(o=0;o<64;o+=8){var c=parseInt(u.substr(o,8),2).toString(16)
1===c.length&&(c="0"+c),h+=c}return h.toLowerCase()},K=new RegExp("^-?(0*)\\d{1,10}$"),G=function(t){if(K.test(t)){var e=Number(t)
if(e>=-2147483648&&e<=2147483647)return e}return null},X=function(t){try{t()}catch(t){setTimeout((function(){var e=t.stack||""
throw N("Exception was thrown by user callback.",e),t}),Math.floor(0))}},$=function(t,e){var n=setTimeout(t,e)
return"object"===r(n)&&n.unref&&n.unref(),n},J=function(){function t(t,e){if(void 0===e){this.pieces_=t.split("/")
for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++)
this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}return Object.defineProperty(t,"Empty",{get:function(){return new t("")},enumerable:!1,configurable:!0}),t.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},t.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},t.prototype.popFront=function(){var e=this.pieceNum_
return e<this.pieces_.length&&e++,new t(this.pieces_,e)},t.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},t.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e])
return t||"/"},t.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])))
return t||"/"},t.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},t.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null
for(var e=[],n=this.pieceNum_;n<this.pieces_.length-1;n++)e.push(this.pieces_[n])
return new t(e,0)},t.prototype.child=function(e){for(var n=[],r=this.pieceNum_;r<this.pieces_.length;r++)n.push(this.pieces_[r])
if(e instanceof t)for(r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r])
else{var i=e.split("/")
for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new t(n,0)},t.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},t.relativePath=function(e,n){var r=e.getFront(),i=n.getFront()
if(null===r)return n
if(r===i)return t.relativePath(e.popFront(),n.popFront())
throw new Error("INTERNAL ERROR: innerPath ("+n+") is not within outerPath ("+e+")")},t.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=L(n[i],r[i])
if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},t.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1
for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1
return!0},t.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_
if(this.getLength()>t.getLength())return!1
for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},t}(),Z=function(){function t(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length)
for(var n=0;n<this.parts_.length;n++)this.byteLength_+=s.stringLength(this.parts_[n])
this.checkValid_()}return Object.defineProperty(t,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!1,configurable:!0}),Object.defineProperty(t,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!1,configurable:!0}),t.prototype.push=function(t){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=s.stringLength(t),this.checkValid_()},t.prototype.pop=function(){var t=this.parts_.pop()
this.byteLength_-=s.stringLength(t),this.parts_.length>0&&(this.byteLength_-=1)},t.prototype.checkValid_=function(){if(this.byteLength_>t.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+t.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").")
if(this.parts_.length>t.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+t.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},t.prototype.toErrorString=function(){return 0===this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},t}(),tt=function(){function t(t,e,n,r,i,o){void 0===i&&(i=""),void 0===o&&(o=!1),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.includeNamespaceInQueryParams=o,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=f.get("host:"+t)||this.host}return t.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},t.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},t.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},t.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},t.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&f.set("host:"+this.host,this.internalHost))},t.prototype.connectionURL=function(t,e){var n
if(s.assert("string"==typeof t,"typeof type must == string"),s.assert("object"===r(e),"typeof params must == object"),"websocket"===t)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?"
else{if("long_polling"!==t)throw new Error("Unknown connection type: "+t)
n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace)
var i=[]
return F(e,(function(t,e){i.push(t+"="+e)})),n+i.join("&")},t.prototype.toString=function(){var t=this.toURLString()
return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},t.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},t}(),et=function(t){var e=nt(t),n=e.namespace
"firebase.com"===e.domain&&I(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===e.domain||I("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&N("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")
var r="ws"===e.scheme||"wss"===e.scheme
return{repoInfo:new tt(e.host,e.secure,n,r,"",n!==e.subdomain),path:new J(e.pathString)}},nt=function(t){var e="",n="",r="",i="",s="",a=!0,u="https",h=443
if("string"==typeof t){var c=t.indexOf("//")
c>=0&&(u=t.substring(0,c-1),t=t.substring(c+2))
var l=t.indexOf("/");-1===l&&(l=t.length)
var p=t.indexOf("?");-1===p&&(p=t.length),e=t.substring(0,Math.min(l,p)),l<p&&(i=
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r]
try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(l,p)))
var d=function(t){var e,n,r={}
"?"===t.charAt(0)&&(t=t.substring(1))
try{for(var i=o.__values(t.split("&")),s=i.next();!s.done;s=i.next()){var a=s.value
if(0!==a.length){var u=a.split("=")
2===u.length?r[decodeURIComponent(u[0])]=decodeURIComponent(u[1]):N("Invalid query segment '"+a+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,p)));(c=e.indexOf(":"))>=0?(a="https"===u||"wss"===u,h=parseInt(e.substring(c+1),10)):c=e.length
var f=e.slice(0,c)
if("localhost"===f.toLowerCase())n="localhost"
else if(f.split(".").length<=2)n=f
else{var y=e.indexOf(".")
r=e.substring(0,y).toLowerCase(),n=e.substring(y+1),s=r}"ns"in d&&(s=d.ns)}return{host:e,port:h,domain:n,subdomain:r,secure:a,scheme:u,pathString:i,namespace:s}},rt=/[\[\].#$\/\u0000-\u001F\u007F]/,it=/[\[\].#$\u0000-\u001F\u007F]/,ot=function(t){return"string"==typeof t&&0!==t.length&&!rt.test(t)},st=function(t){return"string"==typeof t&&0!==t.length&&!it.test(t)},at=function(t){return null===t||"string"==typeof t||"number"==typeof t&&!x(t)||t&&"object"===r(t)&&s.contains(t,".sv")},ut=function(t,e,n,r,i){i&&void 0===n||ht(s.errorPrefix(t,e,i),n,r)},ht=function t(e,n,i){var o=i instanceof J?new Z(i,e):i
if(void 0===n)throw new Error(e+"contains undefined "+o.toErrorString())
if("function"==typeof n)throw new Error(e+"contains a function "+o.toErrorString()+" with contents = "+n.toString())
if(x(n))throw new Error(e+"contains "+n.toString()+" "+o.toErrorString())
if("string"==typeof n&&n.length>10485760/3&&s.stringLength(n)>10485760)throw new Error(e+"contains a string greater than 10485760 utf8 bytes "+o.toErrorString()+" ('"+n.substring(0,50)+"...')")
if(n&&"object"===r(n)){var a=!1,u=!1
if(F(n,(function(n,r){if(".value"===n)a=!0
else if(".priority"!==n&&".sv"!==n&&(u=!0,!ot(n)))throw new Error(e+" contains an invalid key ("+n+") "+o.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')
o.push(n),t(e,r,o),o.pop()})),a&&u)throw new Error(e+' contains ".value" child '+o.toErrorString()+" in addition to actual children.")}},ct=function(t,e,n,i,o){if(!o||void 0!==n){var a=s.errorPrefix(t,e,o)
if(!n||"object"!==r(n)||Array.isArray(n))throw new Error(a+" must be an object containing the children to replace.")
var u=[]
F(n,(function(t,e){var n=new J(t)
if(ht(a,e,i.child(n)),".priority"===n.getBack()&&!at(e))throw new Error(a+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).")
u.push(n)})),function(t,e){var n,r
for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!ot(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')
e.sort(J.comparePaths)
var s=null
for(n=0;n<e.length;n++){if(r=e[n],null!==s&&s.contains(r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString())
s=r}}(a,u)}},lt=function(t,e,n,r){if(!r||void 0!==n){if(x(n))throw new Error(s.errorPrefix(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).")
if(!at(n))throw new Error(s.errorPrefix(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},pt=function(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break
default:throw new Error(s.errorPrefix(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},dt=function(t,e,n,r){if(!(r&&void 0===n||ot(n)))throw new Error(s.errorPrefix(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},ft=function(t,e,n,r){if(!(r&&void 0===n||st(n)))throw new Error(s.errorPrefix(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},yt=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),ft(t,e,n,r)},gt=function(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")},_t=function(t,e,n){var r=n.path.toString()
if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!ot(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),st(t)}(r))throw new Error(s.errorPrefix(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},vt=function(t,e,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(s.errorPrefix(t,e,r)+"must be a boolean.")},mt=function(){function t(t,e){this.repo_=t,this.path_=e}return t.prototype.cancel=function(t){s.validateArgCount("OnDisconnect.cancel",0,1,arguments.length),s.validateCallback("OnDisconnect.cancel",1,t,!0)
var e=new s.Deferred
return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},t.prototype.remove=function(t){s.validateArgCount("OnDisconnect.remove",0,1,arguments.length),gt("OnDisconnect.remove",this.path_),s.validateCallback("OnDisconnect.remove",1,t,!0)
var e=new s.Deferred
return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},t.prototype.set=function(t,e){s.validateArgCount("OnDisconnect.set",1,2,arguments.length),gt("OnDisconnect.set",this.path_),ut("OnDisconnect.set",1,t,this.path_,!1),s.validateCallback("OnDisconnect.set",2,e,!0)
var n=new s.Deferred
return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},t.prototype.setWithPriority=function(t,e,n){s.validateArgCount("OnDisconnect.setWithPriority",2,3,arguments.length),gt("OnDisconnect.setWithPriority",this.path_),ut("OnDisconnect.setWithPriority",1,t,this.path_,!1),lt("OnDisconnect.setWithPriority",2,e,!1),s.validateCallback("OnDisconnect.setWithPriority",3,n,!0)
var r=new s.Deferred
return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},t.prototype.update=function(t,e){if(s.validateArgCount("OnDisconnect.update",1,2,arguments.length),gt("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r]
t=n,N("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ct("OnDisconnect.update",1,t,this.path_,!1),s.validateCallback("OnDisconnect.update",2,e,!0)
var i=new s.Deferred
return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},t}(),bt=function(){function t(t,e){this.committed=t,this.snapshot=e}return t.prototype.toJSON=function(){return s.validateArgCount("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},t}(),Ct=(M="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",W=0,U=[],function(t){var e,n=t===W
W=t
var r=new Array(8)
for(e=7;e>=0;e--)r[e]=M.charAt(t%64),t=Math.floor(t/64)
s.assert(0===t,"Cannot push at time == 0")
var i=r.join("")
if(n){for(e=11;e>=0&&63===U[e];e--)U[e]=0
U[e]++}else for(e=0;e<12;e++)U[e]=Math.floor(64*Math.random())
for(e=0;e<12;e++)i+=M.charAt(U[e])
return s.assert(20===i.length,"nextPushId: Length should be 20."),i}),Et=function(){function t(t,e){this.name=t,this.node=e}return t.Wrap=function(e,n){return new t(e,n)},t}(),wt=function(){function t(){}return t.prototype.getCompare=function(){return this.compare.bind(this)},t.prototype.indexedValueChanged=function(t,e){var n=new Et(A,t),r=new Et(A,e)
return 0!==this.compare(n,r)},t.prototype.minPost=function(){return Et.MIN},t}(),Tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return H},set:function(t){H=t},enumerable:!1,configurable:!0}),e.prototype.compare=function(t,e){return L(t.name,e.name)},e.prototype.isDefinedOn=function(t){throw s.assertionError("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(t,e){return!1},e.prototype.minPost=function(){return Et.MIN},e.prototype.maxPost=function(){return new Et(R,H)},e.prototype.makePost=function(t,e){return s.assert("string"==typeof t,"KeyIndex indexValue must always be a string."),new Et(t,H)},e.prototype.toString=function(){return".key"},e}(wt),St=new Tt,It=function(t){return"number"==typeof t?"number:"+Y(t):"string:"+t},Nt=function(t){if(t.isLeafNode()){var e=t.val()
s.assert("string"==typeof e||"number"==typeof e||"object"===r(e)&&s.contains(e,".sv"),"Priority must be a string or number.")}else s.assert(t===j||t.isEmpty(),"priority of unexpected type.")
s.assert(t===j||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},xt=function(){function t(e,n){void 0===n&&(n=t.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=n,this.lazyHash_=null,s.assert(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Nt(this.priorityNode_)}return Object.defineProperty(t,"__childrenNodeConstructor",{get:function(){return B},set:function(t){B=t},enumerable:!1,configurable:!0}),t.prototype.isLeafNode=function(){return!0},t.prototype.getPriority=function(){return this.priorityNode_},t.prototype.updatePriority=function(e){return new t(this.value_,e)},t.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.getChild=function(e){return e.isEmpty()?this:".priority"===e.getFront()?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.hasChild=function(){return!1},t.prototype.getPredecessorChildName=function(t,e){return null},t.prototype.updateImmediateChild=function(e,n){return".priority"===e?this.updatePriority(n):n.isEmpty()&&".priority"!==e?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)},t.prototype.updateChild=function(e,n){var r=e.getFront()
return null===r?n:n.isEmpty()&&".priority"!==r?this:(s.assert(".priority"!==r||1===e.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(r,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(e.popFront(),n)))},t.prototype.isEmpty=function(){return!1},t.prototype.numChildren=function(){return 0},t.prototype.forEachChild=function(t,e){return!1},t.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},t.prototype.hash=function(){if(null===this.lazyHash_){var t=""
this.priorityNode_.isEmpty()||(t+="priority:"+It(this.priorityNode_.val())+":")
var e=r(this.value_)
t+=e+":",t+="number"===e?Y(this.value_):this.value_,this.lazyHash_=v(t)}return this.lazyHash_},t.prototype.getValue=function(){return this.value_},t.prototype.compareTo=function(e){return e===t.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof t.__childrenNodeConstructor?-1:(s.assert(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},t.prototype.compareToLeafNode_=function(e){var n=r(e.value_),i=r(this.value_),o=t.VALUE_TYPE_ORDER.indexOf(n),a=t.VALUE_TYPE_ORDER.indexOf(i)
return s.assert(o>=0,"Unknown leaf type: "+n),s.assert(a>=0,"Unknown leaf type: "+i),o===a?"object"===i?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:a-o},t.prototype.withIndex=function(){return this},t.prototype.isIndexed=function(){return!0},t.prototype.equals=function(t){if(t===this)return!0
if(t.isLeafNode()){var e=t
return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},t.VALUE_TYPE_ORDER=["object","boolean","number","string"],t}(),At=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r)
return 0===i?L(t.name,e.name):i},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},e.prototype.minPost=function(){return Et.MIN},e.prototype.maxPost=function(){return new Et(R,new xt("[PRIORITY-POST]",V))},e.prototype.makePost=function(t,e){var n=q(t)
return new Et(e,new xt("[PRIORITY-POST]",n))},e.prototype.toString=function(){return".priority"},e}(wt)),Rt=function(){function t(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[]
for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right
else{if(0===o){this.nodeStack_.push(t)
break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return t.prototype.getNext=function(){if(0===this.nodeStack_.length)return null
var t,e=this.nodeStack_.pop()
if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right
else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left
return t},t.prototype.hasNext=function(){return this.nodeStack_.length>0},t.prototype.peek=function(){if(0===this.nodeStack_.length)return null
var t=this.nodeStack_[this.nodeStack_.length-1]
return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},t}(),Lt=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:Dt.EMPTY_NODE,this.right=null!=o?o:Dt.EMPTY_NODE}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.count=function(){return this.left.count()+1+this.right.count()},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},t.prototype.minKey=function(){return this.min_().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key)
return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp_()},t.prototype.removeMin_=function(){if(this.left.isEmpty())return Dt.EMPTY_NODE
var t=this
return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},t.prototype.remove=function(t,e){var n,r
if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null)
else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return Dt.EMPTY_NODE
r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},t.prototype.isRed_=function(){return this.color},t.prototype.fixUp_=function(){var t=this
return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},t.prototype.moveRedLeft_=function(){var t=this.colorFlip_()
return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},t.prototype.moveRedRight_=function(){var t=this.colorFlip_()
return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},t.prototype.rotateLeft_=function(){var e=this.copy(null,null,t.RED,null,this.right.left)
return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight_=function(){var e=this.copy(null,null,t.RED,this.left.right,null)
return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null)
return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth_=function(){var t=this.check_()
return Math.pow(2,t)<=this.count()+1},t.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")")
if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red")
var t=this.left.check_()
if(t!==this.right.check_())throw new Error("Black depths differ")
return t+(this.isRed_()?0:1)},t.RED=!0,t.BLACK=!1,t}(),Ot=function(){function t(){}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Lt(t,e,null)},t.prototype.remove=function(t,e){return this},t.prototype.count=function(){return 0},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.check_=function(){return 0},t.prototype.isRed_=function(){return!1},t}(),Dt=function(){function t(e,n){void 0===n&&(n=t.EMPTY_NODE),this.comparator_=e,this.root_=n}return t.prototype.insert=function(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,Lt.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Lt.BLACK,null,null))},t.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value
e<0?n=n.left:e>0&&(n=n.right)}return null},t.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null
for(n=n.left;!n.right.isEmpty();)n=n.right
return n.key}e<0?n=n.left:e>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},t.prototype.isEmpty=function(){return this.root_.isEmpty()},t.prototype.count=function(){return this.root_.count()},t.prototype.minKey=function(){return this.root_.minKey()},t.prototype.maxKey=function(){return this.root_.maxKey()},t.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},t.prototype.getIterator=function(t){return new Rt(this.root_,null,this.comparator_,!1,t)},t.prototype.getIteratorFrom=function(t,e){return new Rt(this.root_,t,this.comparator_,!1,e)},t.prototype.getReverseIteratorFrom=function(t,e){return new Rt(this.root_,t,this.comparator_,!0,e)},t.prototype.getReverseIterator=function(t){return new Rt(this.root_,null,this.comparator_,!0,t)},t.EMPTY_NODE=new Ot,t}(),kt=Math.log(2),Pt=function(){function t(t){var e
this.count=(e=t+1,parseInt(Math.log(e)/kt,10)),this.current_=this.count-1
var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2))
this.bits_=t+1&r}return t.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_)
return this.current_--,t},t}(),Ft=function(t,e,n,r){t.sort(e)
var i=function(e){for(var r=null,i=null,o=t.length,s=function(e,r){var i=o-e,s=o
o-=e
var u=function e(r,i){var o,s,a=i-r
if(0===a)return null
if(1===a)return o=t[r],s=n?n(o):o,new Lt(s,o.node,Lt.BLACK,null,null)
var u=parseInt(a/2,10)+r,h=e(r,u),c=e(u+1,i)
return o=t[u],s=n?n(o):o,new Lt(s,o.node,Lt.BLACK,h,c)}(i+1,s),h=t[i],c=n?n(h):h
a(new Lt(c,h.node,r,null,u))},a=function(t){r?(r.left=t,r=t):(i=t,r=t)},u=0;u<e.count;++u){var h=e.nextBitIsOne(),c=Math.pow(2,e.count-(u+1))
h?s(c,Lt.BLACK):(s(c,Lt.BLACK),s(c,Lt.RED))}return i}(new Pt(t.length))
return new Dt(r||e,i)},Mt={},Wt=function(){function t(t,e){this.indexes_=t,this.indexSet_=e}return Object.defineProperty(t,"Default",{get:function(){return s.assert(Mt&&At,"ChildrenNode.ts has not been loaded"),Q=Q||new t({".priority":Mt},{".priority":At})},enumerable:!1,configurable:!0}),t.prototype.get=function(t){var e=s.safeGet(this.indexes_,t)
if(!e)throw new Error("No index defined for "+t)
return e instanceof Dt?e:null},t.prototype.hasIndex=function(t){return s.contains(this.indexSet_,t.toString())},t.prototype.addIndex=function(e,n){s.assert(e!==St,"KeyIndex always exists and isn't meant to be added to the IndexMap.")
for(var r,i=[],a=!1,u=n.getIterator(Et.Wrap),h=u.getNext();h;)a=a||e.isDefinedOn(h.node),i.push(h),h=u.getNext()
r=a?Ft(i,e.getCompare()):Mt
var c=e.toString(),l=o.__assign({},this.indexSet_)
l[c]=e
var p=o.__assign({},this.indexes_)
return p[c]=r,new t(p,l)},t.prototype.addToIndexes=function(e,n){var r=this
return new t(s.map(this.indexes_,(function(t,i){var o=s.safeGet(r.indexSet_,i)
if(s.assert(o,"Missing index implementation for "+i),t===Mt){if(o.isDefinedOn(e.node)){for(var a=[],u=n.getIterator(Et.Wrap),h=u.getNext();h;)h.name!==e.name&&a.push(h),h=u.getNext()
return a.push(e),Ft(a,o.getCompare())}return Mt}var c=n.get(e.name),l=t
return c&&(l=l.remove(new Et(e.name,c))),l.insert(e,e.node)})),this.indexSet_)},t.prototype.removeFromIndexes=function(e,n){return new t(s.map(this.indexes_,(function(t){if(t===Mt)return t
var r=n.get(e.name)
return r?t.remove(new Et(e.name,r)):t})),this.indexSet_)},t}()

;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Ut(t,e){return L(t.name,e.name)}function Ht(t,e){return L(t,e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var jt=function(){function t(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Nt(this.priorityNode_),this.children_.isEmpty()&&s.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(t,"EMPTY_NODE",{get:function(){return z||(z=new t(new Dt(Ht),null,Wt.Default))},enumerable:!1,configurable:!0}),t.prototype.isLeafNode=function(){return!1},t.prototype.getPriority=function(){return this.priorityNode_||z},t.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new t(this.children_,e,this.indexMap_)},t.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority()
var e=this.children_.get(t)
return null===e?z:e},t.prototype.getChild=function(t){var e=t.getFront()
return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},t.prototype.hasChild=function(t){return null!==this.children_.get(t)},t.prototype.updateImmediateChild=function(e,n){if(s.assert(n,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(n)
var r=new Et(e,n),i=void 0,o=void 0
n.isEmpty()?(i=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,n),o=this.indexMap_.addToIndexes(r,this.children_))
var a=i.isEmpty()?z:this.priorityNode_
return new t(i,a,o)},t.prototype.updateChild=function(t,e){var n=t.getFront()
if(null===n)return e
s.assert(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path")
var r=this.getImmediateChild(n).updateChild(t.popFront(),e)
return this.updateImmediateChild(n,r)},t.prototype.isEmpty=function(){return this.children_.isEmpty()},t.prototype.numChildren=function(){return this.children_.count()},t.prototype.val=function(e){if(this.isEmpty())return null
var n={},r=0,i=0,o=!0
if(this.forEachChild(At,(function(s,a){n[s]=a.val(e),r++,o&&t.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):o=!1})),!e&&o&&i<2*r){var s=[]
for(var a in n)s[a]=n[a]
return s}return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},t.prototype.hash=function(){if(null===this.lazyHash_){var t=""
this.getPriority().isEmpty()||(t+="priority:"+It(this.getPriority().val())+":"),this.forEachChild(At,(function(e,n){var r=n.hash()
""!==r&&(t+=":"+e+":"+r)})),this.lazyHash_=""===t?"":v(t)}return this.lazyHash_},t.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n)
if(r){var i=r.getPredecessorKey(new Et(t,e))
return i?i.name:null}return this.children_.getPredecessorKey(t)},t.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t)
if(e){var n=e.minKey()
return n&&n.name}return this.children_.minKey()},t.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t)
return e?new Et(e,this.children_.get(e)):null},t.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t)
if(e){var n=e.maxKey()
return n&&n.name}return this.children_.maxKey()},t.prototype.getLastChild=function(t){var e=this.getLastChildName(t)
return e?new Et(e,this.children_.get(e)):null},t.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t)
return n?n.inorderTraversal((function(t){return e(t.name,t.node)})):this.children_.inorderTraversal(e)},t.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},t.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e)
if(n)return n.getIteratorFrom(t,(function(t){return t}))
for(var r=this.children_.getIteratorFrom(t.name,Et.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek()
return r},t.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},t.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e)
if(n)return n.getReverseIteratorFrom(t,(function(t){return t}))
for(var r=this.children_.getReverseIteratorFrom(t.name,Et.Wrap),i=r.peek();null!=i&&e.compare(i,t)>0;)r.getNext(),i=r.peek()
return r},t.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Bt?-1:0},t.prototype.withIndex=function(e){if(e===St||this.indexMap_.hasIndex(e))return this
var n=this.indexMap_.addIndex(e,this.children_)
return new t(this.children_,this.priorityNode_,n)},t.prototype.isIndexed=function(t){return t===St||this.indexMap_.hasIndex(t)},t.prototype.equals=function(t){if(t===this)return!0
if(t.isLeafNode())return!1
var e=t
if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){for(var n=this.getIterator(At),r=e.getIterator(At),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1
i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1}return!1},t.prototype.resolveIndex_=function(t){return t===St?null:this.indexMap_.get(t.toString())},t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t}(),Bt=new(function(t){function e(){return t.call(this,new Dt(Ht),jt.EMPTY_NODE,Wt.Default)||this}return o.__extends(e,t),e.prototype.compareTo=function(t){return t===this?0:1},e.prototype.equals=function(t){return t===this},e.prototype.getPriority=function(){return this},e.prototype.getImmediateChild=function(t){return jt.EMPTY_NODE},e.prototype.isEmpty=function(){return!1},e}(jt))
function qt(t,e){if(void 0===e&&(e=null),null===t)return jt.EMPTY_NODE
if("object"===r(t)&&".priority"in t&&(e=t[".priority"]),s.assert(null===e||"string"==typeof e||"number"==typeof e||"object"===r(e)&&".sv"in e,"Invalid priority type found: "+r(e)),"object"===r(t)&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!==r(t)||".sv"in t)return new xt(t,qt(e))
if(t instanceof Array){var n=jt.EMPTY_NODE
return F(t,(function(e,r){if(s.contains(t,e)&&"."!==e.substring(0,1)){var i=qt(r)
!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(e,i))}})),n.updatePriority(qt(e))}var i=[],o=!1
if(F(t,(function(t,e){if("."!==t.substring(0,1)){var n=qt(e)
n.isEmpty()||(o=o||!n.getPriority().isEmpty(),i.push(new Et(t,n)))}})),0===i.length)return jt.EMPTY_NODE
var a=Ft(i,Ut,(function(t){return t.name}),Ht)
if(o){var u=Ft(i,At.getCompare())
return new jt(a,qt(e),new Wt({".priority":u},{".priority":At}))}return new jt(a,qt(e),Wt.Default)}Object.defineProperties(Et,{MIN:{value:new Et(A,jt.EMPTY_NODE)},MAX:{value:new Et(R,Bt)}}),Tt.__EMPTY_NODE=jt.EMPTY_NODE,xt.__childrenNodeConstructor=jt,j=Bt,function(t){V=t}(Bt),function(t){q=t}(qt)

;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Vt,Qt=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e.prototype.compare=function(t,e){var n=t.node.compareTo(e.node)
return 0===n?L(t.name,e.name):n},e.prototype.isDefinedOn=function(t){return!0},e.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},e.prototype.minPost=function(){return Et.MIN},e.prototype.maxPost=function(){return Et.MAX},e.prototype.makePost=function(t,e){var n=qt(t)
return new Et(e,n)},e.prototype.toString=function(){return".value"},e}(wt)),zt=function(t){function e(e){var n=t.call(this)||this
return n.indexPath_=e,s.assert(!e.isEmpty()&&".priority"!==e.getFront(),"Can't create PathIndex with empty path or .priority key"),n}return o.__extends(e,t),e.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},e.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},e.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r)
return 0===i?L(t.name,e.name):i},e.prototype.makePost=function(t,e){var n=qt(t),r=jt.EMPTY_NODE.updateChild(this.indexPath_,n)
return new Et(e,r)},e.prototype.maxPost=function(){var t=jt.EMPTY_NODE.updateChild(this.indexPath_,Bt)
return new Et(R,t)},e.prototype.toString=function(){return this.indexPath_.slice().join("/")},e}(wt),Yt=function(){function t(t,e,n){this.node_=t,this.ref_=e,this.index_=n}return t.prototype.val=function(){return s.validateArgCount("DataSnapshot.val",0,0,arguments.length),this.node_.val()},t.prototype.exportVal=function(){return s.validateArgCount("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},t.prototype.toJSON=function(){return s.validateArgCount("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},t.prototype.exists=function(){return s.validateArgCount("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},t.prototype.child=function(e){s.validateArgCount("DataSnapshot.child",0,1,arguments.length),e=String(e),ft("DataSnapshot.child",1,e,!1)
var n=new J(e),r=this.ref_.child(n)
return new t(this.node_.getChild(n),r,At)},t.prototype.hasChild=function(t){s.validateArgCount("DataSnapshot.hasChild",1,1,arguments.length),ft("DataSnapshot.hasChild",1,t,!1)
var e=new J(t)
return!this.node_.getChild(e).isEmpty()},t.prototype.getPriority=function(){return s.validateArgCount("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},t.prototype.forEach=function(e){var n=this
if(s.validateArgCount("DataSnapshot.forEach",1,1,arguments.length),s.validateCallback("DataSnapshot.forEach",1,e,!1),this.node_.isLeafNode())return!1
var r=this.node_
return!!r.forEachChild(this.index_,(function(r,i){return e(new t(i,n.ref_.child(r),At))}))},t.prototype.hasChildren=function(){return s.validateArgCount("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(t.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!1,configurable:!0}),t.prototype.numChildren=function(){return s.validateArgCount("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},t.prototype.getRef=function(){return s.validateArgCount("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),t}(),Kt=function(){function t(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}return t.prototype.getPath=function(){var t=this.snapshot.getRef()
return"value"===this.eventType?t.path:t.getParent().path},t.prototype.getEventType=function(){return this.eventType},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+s.stringify(this.snapshot.exportVal())},t}(),Gt=function(){function t(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}return t.prototype.getPath=function(){return this.path},t.prototype.getEventType=function(){return"cancel"},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.path.toString()+":cancel"},t}(),Xt=function(){function t(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){return"value"===t},t.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex()
return new Kt("value",this,new Yt(t.snapshotNode,e.getRef(),n))},t.prototype.getEventRunner=function(t){var e=this.context_
if("cancel"===t.getEventType()){s.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback")
var n=this.cancelCallback_
return function(){n.call(e,t.error)}}var r=this.callback_
return function(){r.call(e,t.snapshot)}},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Gt(this,t,e):null},t.prototype.matches=function(e){return e instanceof t&&(!e.callback_||!this.callback_||e.callback_===this.callback_&&e.context_===this.context_)},t.prototype.hasAnyCallback=function(){return null!==this.callback_},t}(),$t=function(){function t(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t
return e="children_removed"===e?"child_removed":e,s.contains(this.callbacks_,e)},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Gt(this,t,e):null},t.prototype.createEvent=function(t,e){s.assert(null!=t.childName,"Child events should have a childName.")
var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex()
return new Kt(t.type,this,new Yt(t.snapshotNode,n,r),t.prevName)},t.prototype.getEventRunner=function(t){var e=this.context_
if("cancel"===t.getEventType()){s.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback")
var n=this.cancelCallback_
return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType]
return function(){r.call(e,t.snapshot,t.prevName)}},t.prototype.matches=function(e){var n=this
if(e instanceof t){if(!this.callbacks_||!e.callbacks_)return!0
if(this.context_===e.context_){var r=Object.keys(e.callbacks_),i=Object.keys(this.callbacks_),o=r.length
if(o===i.length){if(1===o){var s=r[0],a=i[0]
return!(a!==s||e.callbacks_[s]&&this.callbacks_[a]&&e.callbacks_[s]!==this.callbacks_[a])}return i.every((function(t){return e.callbacks_[t]===n.callbacks_[t]}))}}}return!1},t.prototype.hasAnyCallback=function(){return null!==this.callbacks_},t}(),Jt=function(){function t(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return s.assert(Vt,"Reference.ts has not been loaded"),Vt},set:function(t){Vt=t},enumerable:!1,configurable:!0}),t.validateQueryEndpoints_=function(t){var e=null,n=null
if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===St){var i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",o="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string."
if(t.hasStart()){if(t.getIndexStartName()!==A)throw new Error(i)
if("string"!=typeof e)throw new Error(o)}if(t.hasEnd()){if(t.getIndexEndName()!==R)throw new Error(i)
if("string"!=typeof n)throw new Error(o)}}else if(t.getIndex()===At){if(null!=e&&!at(e)||null!=n&&!at(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(s.assert(t.getIndex()instanceof zt||t.getIndex()===Qt,"unknown index type."),null!=e&&"object"===r(e)||null!=n&&"object"===r(n))throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},t.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},t.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},t.prototype.getQueryParams=function(){return this.queryParams_},t.prototype.getRef=function(){return s.validateArgCount("Query.ref",0,0,arguments.length),new t.__referenceConstructor(this.repo,this.path)},t.prototype.on=function(e,n,r,i){s.validateArgCount("Query.on",2,4,arguments.length),pt("Query.on",1,e,!1),s.validateCallback("Query.on",2,n,!1)
var o=t.getCancelAndContextArgs_("Query.on",r,i)
if("value"===e)this.onValueEvent(n,o.cancel,o.context)
else{var a={}
a[e]=n,this.onChildEvent(a,o.cancel,o.context)}return n},t.prototype.onValueEvent=function(t,e,n){var r=new Xt(t,e||null,n||null)
this.repo.addEventCallbackForQuery(this,r)},t.prototype.onChildEvent=function(t,e,n){var r=new $t(t,e,n)
this.repo.addEventCallbackForQuery(this,r)},t.prototype.off=function(t,e,n){s.validateArgCount("Query.off",0,3,arguments.length),pt("Query.off",1,t,!0),s.validateCallback("Query.off",2,e,!0),s.validateContextObject("Query.off",3,n,!0)
var r=null,i=null
if("value"===t){var o=e||null
r=new Xt(o,null,n||null)}else t&&(e&&((i={})[t]=e),r=new $t(i,null,n||null))
this.repo.removeEventCallbackForQuery(this,r)},t.prototype.once=function(e,n,r,i){var o=this
s.validateArgCount("Query.once",1,4,arguments.length),pt("Query.once",1,e,!1),s.validateCallback("Query.once",2,n,!0)
var a=t.getCancelAndContextArgs_("Query.once",r,i),u=!0,h=new s.Deferred
h.promise.catch((function(){}))
var c=function t(r){u&&(u=!1,o.off(e,t),n&&n.bind(a.context)(r),h.resolve(r))}
return this.on(e,c,(function(t){o.off(e,c),a.cancel&&a.cancel.bind(a.context)(t),h.reject(t)})),h.promise},t.prototype.limitToFirst=function(e){if(s.validateArgCount("Query.limitToFirst",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.")
if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).")
return new t(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_)},t.prototype.limitToLast=function(e){if(s.validateArgCount("Query.limitToLast",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.")
if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).")
return new t(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_)},t.prototype.orderByChild=function(e){if(s.validateArgCount("Query.orderByChild",1,1,arguments.length),"$key"===e)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.')
if("$priority"===e)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.')
if("$value"===e)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.')
ft("Query.orderByChild",1,e,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild")
var n=new J(e)
if(n.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.")
var r=new zt(n),i=this.queryParams_.orderBy(r)
return t.validateQueryEndpoints_(i),new t(this.repo,this.path,i,!0)},t.prototype.orderByKey=function(){s.validateArgCount("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey")
var e=this.queryParams_.orderBy(St)
return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByPriority=function(){s.validateArgCount("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority")
var e=this.queryParams_.orderBy(At)
return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByValue=function(){s.validateArgCount("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue")
var e=this.queryParams_.orderBy(Qt)
return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.startAt=function(e,n){void 0===e&&(e=null),s.validateArgCount("Query.startAt",0,2,arguments.length),ut("Query.startAt",1,e,this.path,!0),dt("Query.startAt",2,n,!0)
var r=this.queryParams_.startAt(e,n)
if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).")
return void 0===e&&(e=null,n=null),new t(this.repo,this.path,r,this.orderByCalled_)},t.prototype.endAt=function(e,n){void 0===e&&(e=null),s.validateArgCount("Query.endAt",0,2,arguments.length),ut("Query.endAt",1,e,this.path,!0),dt("Query.endAt",2,n,!0)
var r=this.queryParams_.endAt(e,n)
if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).")
return new t(this.repo,this.path,r,this.orderByCalled_)},t.prototype.equalTo=function(t,e){if(s.validateArgCount("Query.equalTo",1,2,arguments.length),ut("Query.equalTo",1,t,this.path,!1),dt("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).")
if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).")
return this.startAt(t,e).endAt(t,e)},t.prototype.toString=function(){return s.validateArgCount("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},t.prototype.toJSON=function(){return s.validateArgCount("Query.toJSON",0,1,arguments.length),this.toString()},t.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},t.prototype.queryIdentifier=function(){var t=this.queryObject(),e=k(t)
return"{}"===e?"default":e},t.prototype.isEqual=function(e){if(s.validateArgCount("Query.isEqual",1,1,arguments.length),!(e instanceof t)){var n="Query.isEqual failed: First argument must be an instance of firebase.database.Query."
throw new Error(n)}var r=this.repo===e.repo,i=this.path.equals(e.path),o=this.queryIdentifier()===e.queryIdentifier()
return r&&i&&o},t.getCancelAndContextArgs_=function(t,e,n){var i={cancel:null,context:null}
if(e&&n)i.cancel=e,s.validateCallback(t,3,i.cancel,!0),i.context=n,s.validateContextObject(t,4,i.context,!0)
else if(e)if("object"===r(e)&&null!==e)i.context=e
else{if("function"!=typeof e)throw new Error(s.errorPrefix(t,3,!0)+" must either be a cancel callback or a context object.")
i.cancel=e}return i},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),t}(),Zt=function(){function t(t){this.node_=t}return t.prototype.getImmediateChild=function(e){return new t(this.node_.getImmediateChild(e))},t.prototype.node=function(){return this.node_},t}(),te=function(){function t(t,e){this.syncTree_=t,this.path_=e}return t.prototype.getImmediateChild=function(e){var n=this.path_.child(e)
return new t(this.syncTree_,n)},t.prototype.node=function(){return this.syncTree_.calcCompleteEventCache(this.path_)},t}(),ee=function(t,e,n){return t&&"object"===r(t)?(s.assert(".sv"in t,"Unexpected leaf node or priority contents"),"string"==typeof t[".sv"]?ne(t[".sv"],e,n):"object"===r(t[".sv"])?re(t[".sv"],e):void s.assert(!1,"Unexpected server value: "+JSON.stringify(t,null,2))):t},ne=function(t,e,n){switch(t){case"timestamp":return n.timestamp
default:s.assert(!1,"Unexpected server value: "+t)}},re=function(t,e,n){t.hasOwnProperty("increment")||s.assert(!1,"Unexpected server value: "+JSON.stringify(t,null,2))
var r=t.increment
"number"!=typeof r&&s.assert(!1,"Unexpected increment value: "+r)
var i=e.node()
if(s.assert(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r
var o=i.getValue()
return"number"!=typeof o?r:o+r},ie=function(t,e,n,r){return se(e,new te(n,t),r)},oe=function(t,e,n){return se(t,new Zt(e),n)}
function se(t,e,n){var r,i=t.getPriority().val(),o=ee(i,e.getImmediateChild(".priority"),n)
if(t.isLeafNode()){var s=t,a=ee(s.getValue(),e,n)
return a!==s.getValue()||o!==s.getPriority().val()?new xt(a,qt(o)):t}var u=t
return r=u,o!==u.getPriority().val()&&(r=r.updatePriority(new xt(o))),u.forEachChild(At,(function(t,i){var o=se(i,e.getImmediateChild(t),n)
o!==i&&(r=r.updateImmediateChild(t,o))})),r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ae,ue=function(){function t(){this.value=null,this.children=new Map}return t.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t)
if(!t.isEmpty()&&this.children.size>0){var e=t.getFront()
return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},t.prototype.remember=function(e,n){if(e.isEmpty())this.value=n,this.children.clear()
else if(null!==this.value)this.value=this.value.updateChild(e,n)
else{var r=e.getFront()
this.children.has(r)||this.children.set(r,new t)
var i=this.children.get(r)
e=e.popFront(),i.remember(e,n)}},t.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0
if(null!==this.value){if(this.value.isLeafNode())return!1
var e=this.value
this.value=null
var n=this
return e.forEachChild(At,(function(t,e){n.remember(new J(t),e)})),this.forget(t)}if(this.children.size>0){var r=t.getFront()
return t=t.popFront(),this.children.has(r)&&this.children.get(r).forget(t)&&this.children.delete(r),0===this.children.size}return!0},t.prototype.forEachTree=function(t,e){null!==this.value?e(t,this.value):this.forEachChild((function(n,r){var i=new J(t.toString()+"/"+n)
r.forEachTree(i,e)}))},t.prototype.forEachChild=function(t){this.children.forEach((function(e,n){t(n,e)}))},t}()

;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(ae||(ae={}))
var he,ce,le=function(){function t(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,s.assert(!r||e,"Tagged queries must be from server.")}return t.User=new t(!0,!1,null,!1),t.Server=new t(!1,!0,null,!1),t.forServerTaggedQuery=function(e){return new t(!1,!0,e,!0)},t}(),pe=function(){function t(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=ae.ACK_USER_WRITE,this.source=le.User}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return s.assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this
var n=this.affectedTree.subtree(new J(e))
return new t(J.Empty,n,this.revert)}return s.assert(this.path.getFront()===e,"operationForChild called for unrelated child."),new t(this.path.popFront(),this.affectedTree,this.revert)},t}(),de=function(){function t(t,e){void 0===e&&(he||(he=new Dt(O)),e=he),this.value=t,this.children=e}return t.fromObject=function(e){var n=t.Empty
return F(e,(function(t,e){n=n.set(new J(t),e)})),n},t.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},t.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:J.Empty,value:this.value}
if(t.isEmpty())return null
var n=t.getFront(),r=this.children.get(n)
if(null!==r){var i=r.findRootMostMatchingPathAndValue(t.popFront(),e)
return null!=i?{path:new J(n).child(i.path),value:i.value}:null}return null},t.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,(function(){return!0}))},t.prototype.subtree=function(e){if(e.isEmpty())return this
var n=e.getFront(),r=this.children.get(n)
return null!==r?r.subtree(e.popFront()):t.Empty},t.prototype.set=function(e,n){if(e.isEmpty())return new t(n,this.children)
var r=e.getFront(),i=(this.children.get(r)||t.Empty).set(e.popFront(),n),o=this.children.insert(r,i)
return new t(this.value,o)},t.prototype.remove=function(e){if(e.isEmpty())return this.children.isEmpty()?t.Empty:new t(null,this.children)
var n=e.getFront(),r=this.children.get(n)
if(r){var i=r.remove(e.popFront()),o=void 0
return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?t.Empty:new t(this.value,o)}return this},t.prototype.get=function(t){if(t.isEmpty())return this.value
var e=t.getFront(),n=this.children.get(e)
return n?n.get(t.popFront()):null},t.prototype.setTree=function(e,n){if(e.isEmpty())return n
var r,i=e.getFront(),o=(this.children.get(i)||t.Empty).setTree(e.popFront(),n)
return r=o.isEmpty()?this.children.remove(i):this.children.insert(i,o),new t(this.value,r)},t.prototype.fold=function(t){return this.fold_(J.Empty,t)},t.prototype.fold_=function(t,e){var n={}
return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(t.child(r),e)})),e(t,this.value,n)},t.prototype.findOnPath=function(t,e){return this.findOnPath_(t,J.Empty,e)},t.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value)
if(r)return r
if(t.isEmpty())return null
var i=t.getFront(),o=this.children.get(i)
return o?o.findOnPath_(t.popFront(),e.child(i),n):null},t.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,J.Empty,e)},t.prototype.foreachOnPath_=function(e,n,r){if(e.isEmpty())return this
this.value&&r(n,this.value)
var i=e.getFront(),o=this.children.get(i)
return o?o.foreachOnPath_(e.popFront(),n.child(i),r):t.Empty},t.prototype.foreach=function(t){this.foreach_(J.Empty,t)},t.prototype.foreach_=function(t,e){this.children.inorderTraversal((function(n,r){r.foreach_(t.child(n),e)})),this.value&&e(t,this.value)},t.prototype.foreachChild=function(t){this.children.inorderTraversal((function(e,n){n.value&&t(e,n.value)}))},t.Empty=new t(null),t}(),fe=function(){function t(t,e){this.source=t,this.path=e,this.type=ae.LISTEN_COMPLETE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,J.Empty):new t(this.source,this.path.popFront())},t}(),ye=function(){function t(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=ae.OVERWRITE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,J.Empty,this.snap.getImmediateChild(e)):new t(this.source,this.path.popFront(),this.snap)},t}(),ge=function(){function t(t,e,n){this.source=t,this.path=e,this.children=n,this.type=ae.MERGE}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){var n=this.children.subtree(new J(e))
return n.isEmpty()?null:n.value?new ye(this.source,J.Empty,n.value):new t(this.source,J.Empty,n)}return s.assert(this.path.getFront()===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,this.path.popFront(),this.children)},t.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},t}(),_e=function(){function t(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}return t.prototype.isFullyInitialized=function(){return this.fullyInitialized_},t.prototype.isFiltered=function(){return this.filtered_},t.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_
var e=t.getFront()
return this.isCompleteForChild(e)},t.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},t.prototype.getNode=function(){return this.node_},t}(),ve=function(){function t(t,e){this.eventCache_=t,this.serverCache_=e}return t.prototype.updateEventSnap=function(e,n,r){return new t(new _e(e,n,r),this.serverCache_)},t.prototype.updateServerSnap=function(e,n,r){return new t(this.eventCache_,new _e(e,n,r))},t.prototype.getEventCache=function(){return this.eventCache_},t.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},t.prototype.getServerCache=function(){return this.serverCache_},t.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},t.Empty=new t(new _e(jt.EMPTY_NODE,!1,!1),new _e(jt.EMPTY_NODE,!1,!1)),t}(),me=function(){function t(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}return t.valueChange=function(e){return new t(t.VALUE,e)},t.childAddedChange=function(e,n){return new t(t.CHILD_ADDED,n,e)},t.childRemovedChange=function(e,n){return new t(t.CHILD_REMOVED,n,e)},t.childChangedChange=function(e,n,r){return new t(t.CHILD_CHANGED,n,e,r)},t.childMovedChange=function(e,n){return new t(t.CHILD_MOVED,n,e)},t.CHILD_ADDED="child_added",t.CHILD_REMOVED="child_removed",t.CHILD_CHANGED="child_changed",t.CHILD_MOVED="child_moved",t.VALUE="value",t}(),be=function(){function t(t){this.index_=t}return t.prototype.updateChild=function(t,e,n,r,i,o){s.assert(t.isIndexed(this.index_),"A node must be indexed if only a child is updated")
var a=t.getImmediateChild(e)
return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(me.childRemovedChange(e,a)):s.assert(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(me.childAddedChange(e,n)):o.trackChildChange(me.childChangedChange(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},t.prototype.updateFullNode=function(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(At,(function(t,r){e.hasChild(t)||n.trackChildChange(me.childRemovedChange(t,r))})),e.isLeafNode()||e.forEachChild(At,(function(e,r){if(t.hasChild(e)){var i=t.getImmediateChild(e)
i.equals(r)||n.trackChildChange(me.childChangedChange(e,r,i))}else n.trackChildChange(me.childAddedChange(e,r))}))),e.withIndex(this.index_)},t.prototype.updatePriority=function(t,e){return t.isEmpty()?jt.EMPTY_NODE:t.updatePriority(e)},t.prototype.filtersNodes=function(){return!1},t.prototype.getIndexedFilter=function(){return this},t.prototype.getIndex=function(){return this.index_},t}(),Ce=function(){function t(){this.changeMap=new Map}return t.prototype.trackChildChange=function(t){var e=t.type,n=t.childName
s.assert(e===me.CHILD_ADDED||e===me.CHILD_CHANGED||e===me.CHILD_REMOVED,"Only child changes supported for tracking"),s.assert(".priority"!==n,"Only non-priority child changes can be tracked.")
var r=this.changeMap.get(n)
if(r){var i=r.type
if(e===me.CHILD_ADDED&&i===me.CHILD_REMOVED)this.changeMap.set(n,me.childChangedChange(n,t.snapshotNode,r.snapshotNode))
else if(e===me.CHILD_REMOVED&&i===me.CHILD_ADDED)this.changeMap.delete(n)
else if(e===me.CHILD_REMOVED&&i===me.CHILD_CHANGED)this.changeMap.set(n,me.childRemovedChange(n,r.oldSnap))
else if(e===me.CHILD_CHANGED&&i===me.CHILD_ADDED)this.changeMap.set(n,me.childAddedChange(n,t.snapshotNode))
else{if(e!==me.CHILD_CHANGED||i!==me.CHILD_CHANGED)throw s.assertionError("Illegal combination of changes: "+t+" occurred after "+r)
this.changeMap.set(n,me.childChangedChange(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},t.prototype.getChanges=function(){return Array.from(this.changeMap.values())},t}(),Ee=new(function(){function t(){}return t.prototype.getCompleteChild=function(t){return null},t.prototype.getChildAfterChild=function(t,e,n){return null},t}()),we=function(){function t(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}return t.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache()
if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t)
var n=null!=this.optCompleteServerCache_?new _e(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache()
return this.writes_.calcCompleteChild(t,n)},t.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t)
return 0===i.length?null:i[0]},t}(),Te=function(t,e){this.viewCache=t,this.changes=e},Se=function(){function t(t){this.filter_=t}return t.prototype.assertIndexed=function(t){s.assert(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),s.assert(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},t.prototype.applyOperation=function(e,n,r,i){var o,a,u=new Ce
if(n.type===ae.OVERWRITE){var h=n
h.source.fromUser?o=this.applyUserOverwrite_(e,h.path,h.snap,r,i,u):(s.assert(h.source.fromServer,"Unknown source."),a=h.source.tagged||e.getServerCache().isFiltered()&&!h.path.isEmpty(),o=this.applyServerOverwrite_(e,h.path,h.snap,r,i,a,u))}else if(n.type===ae.MERGE){var c=n
c.source.fromUser?o=this.applyUserMerge_(e,c.path,c.children,r,i,u):(s.assert(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.getServerCache().isFiltered(),o=this.applyServerMerge_(e,c.path,c.children,r,i,a,u))}else if(n.type===ae.ACK_USER_WRITE){var l=n
o=l.revert?this.revertUserWrite_(e,l.path,r,i,u):this.ackUserWrite_(e,l.path,l.affectedTree,r,i,u)}else{if(n.type!==ae.LISTEN_COMPLETE)throw s.assertionError("Unknown operation type: "+n.type)
o=this.listenComplete_(e,n.path,r,u)}var p=u.getChanges()
return t.maybeAddValueEvent_(e,o,p),new Te(o,p)},t.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache()
if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(n.length>0||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(me.valueChange(e.getCompleteEventSnap()))}},t.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache()
if(null!=n.shadowingWrite(e))return t
var a=void 0,u=void 0
if(e.isEmpty())if(s.assert(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var h=t.getCompleteServerSnap(),c=h instanceof jt?h:jt.EMPTY_NODE,l=n.calcCompleteEventChildren(c)
a=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var p=n.calcCompleteEventCache(t.getCompleteServerSnap())
a=this.filter_.updateFullNode(t.getEventCache().getNode(),p,i)}else{var d=e.getFront()
if(".priority"===d){s.assert(1===e.getLength(),"Can't have a priority with additional path components")
var f=o.getNode()
u=t.getServerCache().getNode()
var y=n.calcEventCacheAfterServerOverwrite(e,f,u)
a=null!=y?this.filter_.updatePriority(f,y):o.getNode()}else{var g=e.popFront(),_=void 0
if(o.isCompleteForChild(d)){u=t.getServerCache().getNode()
var v=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),u)
_=null!=v?o.getNode().getImmediateChild(d).updateChild(g,v):o.getNode().getImmediateChild(d)}else _=n.calcCompleteChild(d,t.getServerCache())
a=null!=_?this.filter_.updateChild(o.getNode(),d,_,g,r,i):o.getNode()}}return t.updateEventSnap(a,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},t.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,s){var a,u=t.getServerCache(),h=o?this.filter_:this.filter_.getIndexedFilter()
if(e.isEmpty())a=h.updateFullNode(u.getNode(),n,null)
else if(h.filtersNodes()&&!u.isFiltered()){var c=u.getNode().updateChild(e,n)
a=h.updateFullNode(u.getNode(),c,null)}else{var l=e.getFront()
if(!u.isCompleteForPath(e)&&e.getLength()>1)return t
var p=e.popFront(),d=u.getNode().getImmediateChild(l).updateChild(p,n)
a=".priority"===l?h.updatePriority(u.getNode(),d):h.updateChild(u.getNode(),l,d,p,Ee,null)}var f=t.updateServerSnap(a,u.isFullyInitialized()||e.isEmpty(),h.filtersNodes()),y=new we(r,f,i)
return this.generateEventCacheAfterServerEvent_(f,e,r,y,s)},t.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var s,a,u=t.getEventCache(),h=new we(r,t,i)
if(e.isEmpty())a=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),s=t.updateEventSnap(a,!0,this.filter_.filtersNodes())
else{var c=e.getFront()
if(".priority"===c)a=this.filter_.updatePriority(t.getEventCache().getNode(),n),s=t.updateEventSnap(a,u.isFullyInitialized(),u.isFiltered())
else{var l=e.popFront(),p=u.getNode().getImmediateChild(c),d=void 0
if(l.isEmpty())d=n
else{var f=h.getCompleteChild(c)
d=null!=f?".priority"===l.getBack()&&f.getChild(l.parent()).isEmpty()?f:f.updateChild(l,n):jt.EMPTY_NODE}if(p.equals(d))s=t
else{var y=this.filter_.updateChild(u.getNode(),c,d,l,h,o)
s=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return s},t.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},t.prototype.applyUserMerge_=function(e,n,r,i,o,s){var a=this,u=e
return r.foreach((function(r,h){var c=n.child(r)
t.cacheHasChild_(e,c.getFront())&&(u=a.applyUserOverwrite_(u,c,h,i,o,s))})),r.foreach((function(r,h){var c=n.child(r)
t.cacheHasChild_(e,c.getFront())||(u=a.applyUserOverwrite_(u,c,h,i,o,s))})),u},t.prototype.applyMerge_=function(t,e){return e.foreach((function(e,n){t=t.updateChild(e,n)})),t},t.prototype.applyServerMerge_=function(t,e,n,r,i,o,s){var a=this
if(t.getServerCache().getNode().isEmpty()&&!t.getServerCache().isFullyInitialized())return t
var u,h=t
u=e.isEmpty()?n:de.Empty.setTree(e,n)
var c=t.getServerCache().getNode()
return u.children.inorderTraversal((function(e,n){if(c.hasChild(e)){var u=t.getServerCache().getNode().getImmediateChild(e),l=a.applyMerge_(u,n)
h=a.applyServerOverwrite_(h,new J(e),l,r,i,o,s)}})),u.children.inorderTraversal((function(e,n){var u=!t.getServerCache().isCompleteForChild(e)&&null==n.value
if(!c.hasChild(e)&&!u){var l=t.getServerCache().getNode().getImmediateChild(e),p=a.applyMerge_(l,n)
h=a.applyServerOverwrite_(h,new J(e),p,r,i,o,s)}})),h},t.prototype.ackUserWrite_=function(t,e,n,r,i,o){if(null!=r.shadowingWrite(e))return t
var s=t.getServerCache().isFiltered(),a=t.getServerCache()
if(null!=n.value){if(e.isEmpty()&&a.isFullyInitialized()||a.isCompleteForPath(e))return this.applyServerOverwrite_(t,e,a.getNode().getChild(e),r,i,s,o)
if(e.isEmpty()){var u=de.Empty
return a.getNode().forEachChild(St,(function(t,e){u=u.set(new J(t),e)})),this.applyServerMerge_(t,e,u,r,i,s,o)}return t}var h=de.Empty
return n.foreach((function(t,n){var r=e.child(t)
a.isCompleteForPath(r)&&(h=h.set(t,a.getNode().getChild(r)))})),this.applyServerMerge_(t,e,h,r,i,s,o)},t.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered())
return this.generateEventCacheAfterServerEvent_(o,e,n,Ee,r)},t.prototype.revertUserWrite_=function(t,e,n,r,i){var o
if(null!=n.shadowingWrite(e))return t
var a=new we(n,t,r),u=t.getEventCache().getNode(),h=void 0
if(e.isEmpty()||".priority"===e.getFront()){var c=void 0
if(t.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(t.getCompleteServerSnap())
else{var l=t.getServerCache().getNode()
s.assert(l instanceof jt,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(l)}c=c,h=this.filter_.updateFullNode(u,c,i)}else{var p=e.getFront(),d=n.calcCompleteChild(p,t.getServerCache())
null==d&&t.getServerCache().isCompleteForChild(p)&&(d=u.getImmediateChild(p)),(h=null!=d?this.filter_.updateChild(u,p,d,e.popFront(),a,i):t.getEventCache().getNode().hasChild(p)?this.filter_.updateChild(u,p,jt.EMPTY_NODE,e.popFront(),a,i):u).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(h=this.filter_.updateFullNode(h,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(J.Empty),t.updateEventSnap(h,o,this.filter_.filtersNodes())},t}(),Ie=function(){function t(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}return t.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[]
return t.forEach((function(t){t.type===me.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(me.childMovedChange(t.childName,t.snapshotNode))})),this.generateEventsForType_(i,me.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,me.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,me.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,me.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,me.VALUE,t,n,e),i},t.prototype.generateEventsForType_=function(t,e,n,r,i){var o=this,s=n.filter((function(t){return t.type===e}))
s.sort(this.compareChanges_.bind(this)),s.forEach((function(e){var n=o.materializeSingleChange_(e,i)
r.forEach((function(r){r.respondsTo(e.type)&&t.push(r.createEvent(n,o.query_))}))}))},t.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},t.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw s.assertionError("Should only compare child_ events.")
var n=new Et(t.childName,t.snapshotNode),r=new Et(e.childName,e.snapshotNode)
return this.index_.compare(n,r)},t}(),Ne=function(){function t(t,e){this.query_=t,this.eventRegistrations_=[]
var n=this.query_.getQueryParams(),r=new be(n.getIndex()),i=n.getNodeFilter()
this.processor_=new Se(i)
var o=e.getServerCache(),s=e.getEventCache(),a=r.updateFullNode(jt.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(jt.EMPTY_NODE,s.getNode(),null),h=new _e(a,o.isFullyInitialized(),r.filtersNodes()),c=new _e(u,s.isFullyInitialized(),i.filtersNodes())
this.viewCache_=new ve(c,h),this.eventGenerator_=new Ie(this.query_)}return t.prototype.getQuery=function(){return this.query_},t.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},t.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap()
return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},t.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},t.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},t.prototype.removeEventRegistration=function(t,e){var n=[]
if(e){s.assert(null==t,"A cancel should cancel all event registrations.")
var r=this.query_.path
this.eventRegistrations_.forEach((function(t){e=e
var i=t.createCancelEvent(e,r)
i&&n.push(i)}))}if(t){for(var i=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o]
if(a.matches(t)){if(t.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1))
break}}else i.push(a)}this.eventRegistrations_=i}else this.eventRegistrations_=[]
return n},t.prototype.applyOperation=function(t,e,n){t.type===ae.MERGE&&null!==t.source.queryId&&(s.assert(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),s.assert(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"))
var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n)
return this.processor_.assertIndexed(i.viewCache),s.assert(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},t.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[]
return e.getNode().isLeafNode()||e.getNode().forEachChild(At,(function(t,e){n.push(me.childAddedChange(t,e))})),e.isFullyInitialized()&&n.push(me.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},t.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_
return this.eventGenerator_.generateEventsForChanges(t,e,r)},t}(),xe=function(){function t(){this.views=new Map}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return s.assert(ce,"Reference.ts has not been loaded"),ce},set:function(t){s.assert(!ce,"__referenceConstructor has already been defined"),ce=t},enumerable:!1,configurable:!0}),t.prototype.isEmpty=function(){return 0===this.views.size},t.prototype.applyOperation=function(t,e,n){var r,i,a=t.source.queryId
if(null!==a){var u=this.views.get(a)
return s.assert(null!=u,"SyncTree gave us an op for an invalid query."),u.applyOperation(t,e,n)}var h=[]
try{for(var c=o.__values(this.views.values()),l=c.next();!l.done;l=c.next())u=l.value,h=h.concat(u.applyOperation(t,e,n))}catch(t){r={error:t}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}return h},t.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),s=this.views.get(o)
if(!s){var a=n.calcCompleteEventCache(i?r:null),u=!1
a?u=!0:r instanceof jt?(a=n.calcCompleteEventChildren(r),u=!1):(a=jt.EMPTY_NODE,u=!1)
var h=new ve(new _e(a,u,!1),new _e(r,i,!1))
s=new Ne(t,h),this.views.set(o,s)}return s.addEventRegistration(e),s.getInitialEvents(e)},t.prototype.removeEventRegistration=function(e,n,r){var i,s,a=e.queryIdentifier(),u=[],h=[],c=this.hasCompleteView()
if("default"===a)try{for(var l=o.__values(this.views.entries()),p=l.next();!p.done;p=l.next()){var d=o.__read(p.value,2),f=d[0],y=d[1]
h=h.concat(y.removeEventRegistration(n,r)),y.isEmpty()&&(this.views.delete(f),y.getQuery().getQueryParams().loadsAllData()||u.push(y.getQuery()))}}catch(t){i={error:t}}finally{try{p&&!p.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}else(y=this.views.get(a))&&(h=h.concat(y.removeEventRegistration(n,r)),y.isEmpty()&&(this.views.delete(a),y.getQuery().getQueryParams().loadsAllData()||u.push(y.getQuery())))
return c&&!this.hasCompleteView()&&u.push(new t.__referenceConstructor(e.repo,e.path)),{removed:u,events:h}},t.prototype.getQueryViews=function(){var t,e,n=[]
try{for(var r=o.__values(this.views.values()),i=r.next();!i.done;i=r.next()){var s=i.value
s.getQuery().getQueryParams().loadsAllData()||n.push(s)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},t.prototype.getCompleteServerCache=function(t){var e,n,r=null
try{for(var i=o.__values(this.views.values()),s=i.next();!s.done;s=i.next()){var a=s.value
r=r||a.getCompleteServerCache(t)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},t.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView()
var e=t.queryIdentifier()
return this.views.get(e)},t.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},t.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},t.prototype.getCompleteView=function(){var t,e
try{for(var n=o.__values(this.views.values()),r=n.next();!r.done;r=n.next()){var i=r.value
if(i.getQuery().getQueryParams().loadsAllData())return i}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return null},t}(),Ae=function(){function t(t){this.writeTree_=t}return t.prototype.addWrite=function(e,n){if(e.isEmpty())return new t(new de(n))
var r=this.writeTree_.findRootMostValueAndPath(e)
if(null!=r){var i=r.path,o=r.value,s=J.relativePath(i,e)
return o=o.updateChild(s,n),new t(this.writeTree_.set(i,o))}var a=new de(n)
return new t(this.writeTree_.setTree(e,a))},t.prototype.addWrites=function(t,e){var n=this
return F(e,(function(e,r){n=n.addWrite(t.child(e),r)})),n},t.prototype.removeWrite=function(e){return e.isEmpty()?t.Empty:new t(this.writeTree_.setTree(e,de.Empty))},t.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},t.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t)
return null!=e?this.writeTree_.get(e.path).getChild(J.relativePath(e.path,t)):null},t.prototype.getCompleteChildren=function(){var t=[],e=this.writeTree_.value
return null!=e?e.isLeafNode()||e.forEachChild(At,(function(e,n){t.push(new Et(e,n))})):this.writeTree_.children.inorderTraversal((function(e,n){null!=n.value&&t.push(new Et(e,n.value))})),t},t.prototype.childCompoundWrite=function(e){if(e.isEmpty())return this
var n=this.getCompleteNode(e)
return new t(null!=n?new de(n):this.writeTree_.subtree(e))},t.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},t.prototype.apply=function(t){return function t(e,n,r){if(null!=n.value)return r.updateChild(e,n.value)
var i=null
return n.children.inorderTraversal((function(n,o){".priority"===n?(s.assert(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):r=t(e.child(n),o,r)})),r.getChild(e).isEmpty()||null===i||(r=r.updateChild(e.child(".priority"),i)),r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(J.Empty,this.writeTree_,t)},t.Empty=new t(new de(null)),t}(),Re=function(){function t(){this.visibleWrites_=Ae.Empty,this.allWrites_=[],this.lastWriteId_=-1}return t.prototype.childWrites=function(t){return new Le(t,this)},t.prototype.addOverwrite=function(t,e,n,r){s.assert(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},t.prototype.addMerge=function(t,e,n){s.assert(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},t.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e]
if(n.writeId===t)return n}return null},t.prototype.removeWrite=function(t){var e=this,n=this.allWrites_.findIndex((function(e){return e.writeId===t}))
s.assert(n>=0,"removeWrite called with nonexistent writeId.")
var r=this.allWrites_[n]
this.allWrites_.splice(n,1)
for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&a>=0;){var u=this.allWrites_[a]
u.visible&&(a>=n&&this.recordContainsPath_(u,r.path)?i=!1:r.path.contains(u.path)&&(o=!0)),a--}return!!i&&(o?(this.resetTree_(),!0):(r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):F(r.children,(function(t){e.visibleWrites_=e.visibleWrites_.removeWrite(r.path.child(t))})),!0))},t.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcCompleteEventCache=function(e,n,r,i){if(r||i){var o=this.visibleWrites_.childCompoundWrite(e)
if(!i&&o.isEmpty())return n
if(i||null!=n||o.hasCompleteWrite(J.Empty)){var s=t.layerTree_(this.allWrites_,(function(t){return(t.visible||i)&&(!r||!~r.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))}),e)
return h=n||jt.EMPTY_NODE,s.apply(h)}return null}var a=this.visibleWrites_.getCompleteNode(e)
if(null!=a)return a
var u=this.visibleWrites_.childCompoundWrite(e)
if(u.isEmpty())return n
if(null!=n||u.hasCompleteWrite(J.Empty)){var h=n||jt.EMPTY_NODE
return u.apply(h)}return null},t.prototype.calcCompleteEventChildren=function(t,e){var n=jt.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(t)
if(r)return r.isLeafNode()||r.forEachChild(At,(function(t,e){n=n.updateImmediateChild(t,e)})),n
if(e){var i=this.visibleWrites_.childCompoundWrite(t)
return e.forEachChild(At,(function(t,e){var r=i.childCompoundWrite(new J(t)).apply(e)
n=n.updateImmediateChild(t,r)})),i.getCompleteChildren().forEach((function(t){n=n.updateImmediateChild(t.name,t.node)})),n}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach((function(t){n=n.updateImmediateChild(t.name,t.node)})),n},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){s.assert(n||r,"Either existingEventSnap or existingServerSnap must exist")
var i=t.child(e)
if(this.visibleWrites_.hasCompleteWrite(i))return null
var o=this.visibleWrites_.childCompoundWrite(i)
return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},t.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r)
return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},t.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var s,a=this.visibleWrites_.childCompoundWrite(t),u=a.getCompleteNode(J.Empty)
if(null!=u)s=u
else{if(null==e)return[]
s=a.apply(e)}if((s=s.withIndex(o)).isEmpty()||s.isLeafNode())return[]
for(var h=[],c=o.getCompare(),l=i?s.getReverseIteratorFrom(n,o):s.getIteratorFrom(n,o),p=l.getNext();p&&h.length<r;)0!==c(p,n)&&h.push(p),p=l.getNext()
return h},t.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e)
for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0
return!1},t.prototype.resetTree_=function(){this.visibleWrites_=t.layerTree_(this.allWrites_,t.DefaultFilter_,J.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},t.DefaultFilter_=function(t){return t.visible},t.layerTree_=function(t,e,n){for(var r=Ae.Empty,i=0;i<t.length;++i){var o=t[i]
if(e(o)){var a=o.path,u=void 0
if(o.snap)n.contains(a)?(u=J.relativePath(n,a),r=r.addWrite(u,o.snap)):a.contains(n)&&(u=J.relativePath(a,n),r=r.addWrite(J.Empty,o.snap.getChild(u)))
else{if(!o.children)throw s.assertionError("WriteRecord should have .snap or .children")
if(n.contains(a))u=J.relativePath(n,a),r=r.addWrites(u,o.children)
else if(a.contains(n))if((u=J.relativePath(a,n)).isEmpty())r=r.addWrites(J.Empty,o.children)
else{var h=s.safeGet(o.children,u.getFront())
if(h){var c=h.getChild(u.popFront())
r=r.addWrite(J.Empty,c)}}}}}return r},t}(),Le=function(){function t(t,e){this.treePath_=t,this.writeTree_=e}return t.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},t.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},t.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},t.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},t.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},t.prototype.child=function(e){return new t(this.treePath_.child(e),this.writeTree_)},t}(),Oe=function(){function t(t){this.listenProvider_=t,this.syncPointTree_=de.Empty,this.pendingWriteTree_=new Re,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return t.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new ye(le.User,t,e)):[]},t.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n)
var r=de.fromObject(e)
return this.applyOperationToSyncPoints_(new ge(le.User,t,r))},t.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1)
var n=this.pendingWriteTree_.getWrite(t)
if(this.pendingWriteTree_.removeWrite(t)){var r=de.Empty
return null!=n.snap?r=r.set(J.Empty,!0):F(n.children,(function(t,e){r=r.set(new J(t),e)})),this.applyOperationToSyncPoints_(new pe(n.path,r,e))}return[]},t.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new ye(le.Server,t,e))},t.prototype.applyServerMerge=function(t,e){var n=de.fromObject(e)
return this.applyOperationToSyncPoints_(new ge(le.Server,t,n))},t.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new fe(le.Server,t))},t.prototype.applyTaggedQueryOverwrite=function(e,n,r){var i=this.queryKeyForTag_(r)
if(null!=i){var o=t.parseQueryKey_(i),s=o.path,a=o.queryId,u=J.relativePath(s,e),h=new ye(le.forServerTaggedQuery(a),u,n)
return this.applyTaggedOperation_(s,h)}return[]},t.prototype.applyTaggedQueryMerge=function(e,n,r){var i=this.queryKeyForTag_(r)
if(i){var o=t.parseQueryKey_(i),s=o.path,a=o.queryId,u=J.relativePath(s,e),h=de.fromObject(n),c=new ge(le.forServerTaggedQuery(a),u,h)
return this.applyTaggedOperation_(s,c)}return[]},t.prototype.applyTaggedListenComplete=function(e,n){var r=this.queryKeyForTag_(n)
if(r){var i=t.parseQueryKey_(r),o=i.path,s=i.queryId,a=J.relativePath(o,e),u=new fe(le.forServerTaggedQuery(s),a)
return this.applyTaggedOperation_(o,u)}return[]},t.prototype.addEventRegistration=function(e,n){var r=e.path,i=null,o=!1
this.syncPointTree_.foreachOnPath(r,(function(t,e){var n=J.relativePath(t,r)
i=i||e.getCompleteServerCache(n),o=o||e.hasCompleteView()}))
var a,u=this.syncPointTree_.get(r)
u?(o=o||u.hasCompleteView(),i=i||u.getCompleteServerCache(J.Empty)):(u=new xe,this.syncPointTree_=this.syncPointTree_.set(r,u)),null!=i?a=!0:(a=!1,i=jt.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild((function(t,e){var n=e.getCompleteServerCache(J.Empty)
n&&(i=i.updateImmediateChild(t,n))})))
var h=u.viewExistsForQuery(e)
if(!h&&!e.getQueryParams().loadsAllData()){var c=t.makeQueryKey_(e)
s.assert(!this.queryToTagMap.has(c),"View does not exist, but we have a tag")
var l=t.getNextQueryTag_()
this.queryToTagMap.set(c,l),this.tagToQueryMap.set(l,c)}var p=this.pendingWriteTree_.childWrites(r),d=u.addEventRegistration(e,n,p,i,a)
if(!h&&!o){var f=u.viewForQuery(e)
d=d.concat(this.setupListener_(e,f))}return d},t.prototype.removeEventRegistration=function(e,n,r){var i=this,o=e.path,s=this.syncPointTree_.get(o),a=[]
if(s&&("default"===e.queryIdentifier()||s.viewExistsForQuery(e))){var u=s.removeEventRegistration(e,n,r)
s.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(o))
var h=u.removed
a=u.events
var c=-1!==h.findIndex((function(t){return t.getQueryParams().loadsAllData()})),l=this.syncPointTree_.findOnPath(o,(function(t,e){return e.hasCompleteView()}))
if(c&&!l){var p=this.syncPointTree_.subtree(o)
if(!p.isEmpty())for(var d=this.collectDistinctViewsForSubTree_(p),f=0;f<d.length;++f){var y=d[f],g=y.getQuery(),_=this.createListenerForView_(y)
this.listenProvider_.startListening(t.queryForListening_(g),this.tagForQuery_(g),_.hashFn,_.onComplete)}}!l&&h.length>0&&!r&&(c?this.listenProvider_.stopListening(t.queryForListening_(e),null):h.forEach((function(e){var n=i.queryToTagMap.get(t.makeQueryKey_(e))
i.listenProvider_.stopListening(t.queryForListening_(e),n)}))),this.removeTags_(h)}return a},t.prototype.calcCompleteEventCache=function(t,e){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(t,(function(e,n){var r=J.relativePath(e,t),i=n.getCompleteServerCache(r)
if(i)return i}))
return n.calcCompleteEventCache(t,r,e,!0)},t.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold((function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()]
var r=[]
return e&&(r=e.getQueryViews()),F(n,(function(t,e){r=r.concat(e)})),r}))},t.prototype.removeTags_=function(e){for(var n=0;n<e.length;++n){var r=e[n]
if(!r.getQueryParams().loadsAllData()){var i=t.makeQueryKey_(r),o=this.queryToTagMap.get(i)
this.queryToTagMap.delete(i),this.tagToQueryMap.delete(o)}}},t.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},t.prototype.setupListener_=function(e,n){var r=e.path,i=this.tagForQuery_(e),o=this.createListenerForView_(n),a=this.listenProvider_.startListening(t.queryForListening_(e),i,o.hashFn,o.onComplete),u=this.syncPointTree_.subtree(r)
if(i)s.assert(!u.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed")
else for(var h=u.fold((function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()]
var r=[]
return e&&(r=r.concat(e.getQueryViews().map((function(t){return t.getQuery()})))),F(n,(function(t,e){r=r.concat(e)})),r})),c=0;c<h.length;++c){var l=h[c]
this.listenProvider_.stopListening(t.queryForListening_(l),this.tagForQuery_(l))}return a},t.prototype.createListenerForView_=function(t){var e=this,n=t.getQuery(),r=this.tagForQuery_(n)
return{hashFn:function(){return(t.getServerCache()||jt.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?e.applyTaggedListenComplete(n.path,r):e.applyListenComplete(n.path)
var i=function(t,e){var n="Unknown Error"
"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?n="Client doesn't have permission to access the desired data.":"unavailable"===t&&(n="The service is unavailable")
var r=new Error(t+" at "+e.path.toString()+": "+n)
return r.code=t.toUpperCase(),r}(t,n)
return e.removeEventRegistration(n,null,i)}}},t.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},t.parseQueryKey_=function(t){var e=t.indexOf("$")
return s.assert(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new J(t.substr(0,e))}},t.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},t.prototype.tagForQuery_=function(e){var n=t.makeQueryKey_(e)
return this.queryToTagMap.get(n)},t.getNextQueryTag_=function(){return t.nextQueryTag_++},t.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t)
s.assert(n,"Missing sync point for query tag that we're tracking")
var r=this.pendingWriteTree_.childWrites(t)
return n.applyOperation(e,r,null)},t.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(J.Empty))},t.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r)
var i=e.get(J.Empty)
null==n&&null!=i&&(n=i.getCompleteServerCache(J.Empty))
var o=[],s=t.path.getFront(),a=t.operationForChild(s),u=e.children.get(s)
if(u&&a){var h=n?n.getImmediateChild(s):null,c=r.child(s)
o=o.concat(this.applyOperationHelper_(a,u,h,c))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},t.prototype.applyOperationDescendantsHelper_=function(t,e,n,r){var i=this,o=e.get(J.Empty)
null==n&&null!=o&&(n=o.getCompleteServerCache(J.Empty))
var s=[]
return e.children.inorderTraversal((function(e,o){var a=n?n.getImmediateChild(e):null,u=r.child(e),h=t.operationForChild(e)
h&&(s=s.concat(i.applyOperationDescendantsHelper_(h,o,a,u)))})),o&&(s=s.concat(o.applyOperation(t,r,n))),s},t.nextQueryTag_=1,t}(),De=function(){function t(){this.rootNode_=jt.EMPTY_NODE}return t.prototype.getNode=function(t){return this.rootNode_.getChild(t)},t.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},t}(),ke=function(){function t(){this.counters_={}}return t.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),s.contains(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},t.prototype.get=function(){return s.deepCopy(this.counters_)},t}(),Pe=function(){function t(){}return t.getCollection=function(t){var e=t.toString()
return this.collections_[e]||(this.collections_[e]=new ke),this.collections_[e]},t.getOrCreateReporter=function(t,e){var n=t.toString()
return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},t.collections_={},t.reporters_={},t}(),Fe=function(){function t(t){this.collection_=t,this.last_=null}return t.prototype.get=function(){var t=this.collection_.get(),e=o.__assign({},t)
return this.last_&&F(this.last_,(function(t,n){e[t]=e[t]-n})),this.last_=t,e},t}(),Me=function(){function t(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Fe(t)
var n=1e4+2e4*Math.random()
$(this.reportStats_.bind(this),Math.floor(n))}return t.prototype.includeStat=function(t){this.statsToReport_[t]=!0},t.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),n={},r=!1
F(e,(function(e,i){i>0&&s.contains(t.statsToReport_,e)&&(n[e]=i,r=!0)})),r&&this.server_.reportStats(n),$(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},t}(),We=function(){function t(){this.eventLists_=[],this.recursionDepth_=0}return t.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath()
null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new Ue(i)),e.add(r)}e&&this.eventLists_.push(e)},t.prototype.raiseEventsAtPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_((function(e){return e.equals(t)}))},t.prototype.raiseEventsForChangedPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_((function(e){return e.contains(t)||t.contains(e)}))},t.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++
for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n]
r&&(t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1)}e&&(this.eventLists_=[]),this.recursionDepth_--},t}(),Ue=function(){function t(t){this.path_=t,this.events_=[]}return t.prototype.add=function(t){this.events_.push(t)},t.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t]
if(null!==e){this.events_[t]=null
var n=e.getEventRunner()
b&&w("event: "+e.toString()),X(n)}}},t.prototype.getPath=function(){return this.path_},t}(),He=function(){function t(t){this.allowedEvents_=t,this.listeners_={},s.assert(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}return t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n]
if(Array.isArray(this.listeners_[t]))for(var r=o.__spread(this.listeners_[t]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},t.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n})
var r=this.getInitialEvent(t)
r&&e.apply(n,r)},t.prototype.off=function(t,e,n){this.validateEventType_(t)
for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},t.prototype.validateEventType_=function(t){s.assert(this.allowedEvents_.find((function(e){return e===t})),"Unknown event: "+t)},t}(),je=function(t){function e(){var e,n,r=t.call(this,["visible"])||this
return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",e="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",e="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,(function(){var t=!document[e]
t!==r.visible_&&(r.visible_=t,r.trigger("visible",t))}),!1),r}return o.__extends(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return s.assert("visible"===t,"Unknown event type: "+t),[this.visible_]},e}(He),Be=function(t){function e(){var e=t.call(this,["online"])||this
return e.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||s.isMobileCordova()||(window.addEventListener("online",(function(){e.online_||(e.online_=!0,e.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){e.online_&&(e.online_=!1,e.trigger("online",!1))}),!1)),e}return o.__extends(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return s.assert("online"===t,"Unknown event type: "+t),[this.online_]},e.prototype.currentlyOnline=function(){return this.online_},e}(He),qe=function(){function t(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return t.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},t.prototype.handleResponse=function(t,e){var n=this
this.pendingResponses[t]=e
for(var r=function(){var t=i.pendingResponses[i.currentResponseNum]
delete i.pendingResponses[i.currentResponseNum]
for(var e=function(e){t[e]&&X((function(){n.onMessage_(t[e])}))},r=0;r<t.length;++r)e(r)
if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break"
i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==r(););},t}(),Ve=function(){function t(t,e,n,r,i){this.connId=t,this.repoInfo=e,this.applicationId=n,this.transportSessionId=r,this.lastSessionId=i,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=T(t),this.stats_=Pe.getCollection(e),this.urlFn=function(t){return e.connectionURL("long_polling",t)}}return t.prototype.open=function(t,e){var n=this
this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new qe(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(t){if(s.isNodeSdk()||"complete"===document.readyState)t()
else{var e=!1,n=function n(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))}
document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new Qe((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]
var r=o.__read(t,5),i=r[0],s=r[1],a=r[2]
if(r[3],r[4],n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"===i)n.id=s,n.password=a
else{if("close"!==i)throw new Error("Unrecognized command received: "+i)
s?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(s,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]
var r=o.__read(t,2),i=r[0],s=r[1]
n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(i,s)}),(function(){n.onClosed_()}),n.urlFn)
var t={start:"t"}
t.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=n.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",n.transportSessionId&&(t.s=n.transportSessionId),n.lastSessionId&&(t.ls=n.lastSessionId),n.applicationId&&(t.p=n.applicationId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(t.r="f")
var e=n.urlFn(t)
n.log_("Connecting via long-poll to "+e),n.scriptTagHolder.addTag(e,(function(){}))}}))},t.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},t.forceAllow=function(){t.forceAllow_=!0},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){return!(s.isNodeSdk()||!t.forceAllow_&&(t.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"===("undefined"==typeof window?"undefined":r(window))&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"===("undefined"==typeof Windows?"undefined":r(Windows))&&"object"===r(Windows.UI)))},t.prototype.markConnectionHealthy=function(){},t.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},t.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},t.prototype.send=function(t){var e=s.stringify(t)
this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length)
for(var n=s.base64Encode(e),r=P(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},t.prototype.addDisconnectPingFrame=function(t,e){if(!s.isNodeSdk()){this.myDisconnFrame=document.createElement("iframe")
var n={dframe:"t"}
n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},t.prototype.incrementIncomingBytes_=function(t){var e=s.stringify(t).length
this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},t}(),Qe=function(){function t(e,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,s.isNodeSdk())this.commandCB=e,this.onMessageCB=n
else{this.uniqueCallbackIdentifier=_(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=t.createIFrame_()
var o=""
this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(o='<script>document.domain="'+document.domain+'";<\/script>')
var a="<html><body>"+o+"</body></html>"
try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(t){w("frame writing exception"),t.stack&&w(t.stack),w(t)}}}return t.createIFrame_=function(){var t=document.createElement("iframe")
if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready."
document.body.appendChild(t)
try{t.contentWindow.document||w("No IE domain setting required")}catch(n){var e=document.domain
t.src="javascript:void((function(){document.open();document.domain='"+e+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t},t.prototype.close=function(){var t=this
this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)}),Math.floor(0)))
var e=this.onDisconnect
e&&(this.onDisconnect=null,e())},t.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},t.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++
var t={}
t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial
for(var e=this.urlFn(t),n="",r=0;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift()
n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},t.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},t.prototype.addLongPollTag_=function(t,e){var n=this
this.outstandingRequests.add(e)
var r=function(){n.outstandingRequests.delete(e),n.newRequest_()},i=setTimeout(r,Math.floor(25e3))
this.addTag(t,(function(){clearTimeout(i),r()}))},t.prototype.addTag=function(t,e){var n=this
s.isNodeSdk()?this.doNodeLongPoll(t,e):setTimeout((function(){try{if(!n.sendNewPolls)return
var r=n.myIFrame.doc.createElement("script")
r.type="text/javascript",r.async=!0,r.src=t,r.onload=r.onreadystatechange=function(){var t=r.readyState
t&&"loaded"!==t&&"complete"!==t||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),e())},r.onerror=function(){w("Long-poll script failed to load: "+t),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(t){}}),Math.floor(1))},t}(),ze="",Ye=null

;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */"undefined"!=typeof MozWebSocket?Ye=MozWebSocket:"undefined"!=typeof WebSocket&&(Ye=WebSocket)
var Ke=function(){function t(e,n,r,i,o){this.connId=e,this.applicationId=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=T(this.connId),this.stats_=Pe.getCollection(n),this.connURL=t.connectionURL_(n,i,o)}return t.connectionURL_=function(t,e,n){var r={v:"5"}
return!s.isNodeSdk()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL("websocket",r)},t.prototype.open=function(t,e){var n=this
this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,f.set("previous_websocket_failure",!0)
try{if(s.isNodeSdk()){var r=s.CONSTANTS.NODE_ADMIN?"AdminNode":"Node",i={headers:{"User-Agent":"Firebase/5/"+ze+"/"+process.platform+"/"+r,"X-Firebase-GMPID":this.applicationId||""}},o=process.env,a=0===this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy
a&&(i.proxy={origin:a}),this.mySock=new Ye(this.connURL,[],i)}else i={headers:{"X-Firebase-GMPID":this.applicationId||""}},this.mySock=new Ye(this.connURL,[],i)}catch(t){this.log_("Error instantiating WebSocket.")
var u=t.message||t.data
return u&&this.log_(u),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.")
var e=t.message||t.data
e&&n.log_(e),n.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1
if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/)
n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==Ye&&!t.forceDisallow_},t.previouslyFailed=function(){return f.isInMemoryStorage||!0===f.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){f.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length===this.totalFrames){var e=this.frames.join("")
this.frames=null
var n=s.jsonEval(e)
this.onMessage(n)}},t.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},t.prototype.extractFrameCount_=function(t){if(s.assert(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t)
if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},t.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data
if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e)
else{var n=this.extractFrameCount_(e)
null!==n&&this.appendFrame_(n)}}},t.prototype.send=function(t){this.resetKeepAlive()
var e=s.stringify(t)
this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length)
var n=P(e,16384)
n.length>1&&this.sendString_(String(n.length))
for(var r=0;r<n.length;r++)this.sendString_(n[r])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var t=this
clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()}),Math.floor(45e3))},t.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),Ge=function(){function t(t){this.initTransports_(t)}return Object.defineProperty(t,"ALL_TRANSPORTS",{get:function(){return[Ve,Ke]},enumerable:!1,configurable:!0}),t.prototype.initTransports_=function(e){var n,r,i=Ke&&Ke.isAvailable(),s=i&&!Ke.previouslyFailed()
if(e.webSocketOnly&&(i||N("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Ke]
else{var a=this.transports_=[]
try{for(var u=o.__values(t.ALL_TRANSPORTS),h=u.next();!h.done;h=u.next()){var c=h.value
c&&c.isAvailable()&&a.push(c)}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}},t.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0]
throw new Error("No transports available")},t.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},t}(),Xe=function(){function t(t,e,n,r,i,o,s,a){this.id=t,this.repoInfo_=e,this.applicationId_=n,this.onMessage_=r,this.onReady_=i,this.onDisconnect_=o,this.onKill_=s,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=T("c:"+this.id+":"),this.transportManager_=new Ge(e),this.log_("Connection created"),this.start_()}return t.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport()
this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0
var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_)
this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){t.conn_&&t.conn_.open(n,r)}),Math.floor(0))
var i=e.healthyTimeout||0
i>0&&(this.healthyTimeout_=$((function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&t.conn_.bytesReceived>102400?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&t.conn_.bytesSent>10240?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))}),Math.floor(i)))},t.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},t.prototype.disconnReceiver_=function(t){var e=this
return function(n){t===e.conn_?e.onConnectionLost_(n):t===e.secondaryConn_?(e.log_("Secondary connection lost."),e.onSecondaryConnectionLost_()):e.log_("closing an old connection")}},t.prototype.connReceiver_=function(t){var e=this
return function(n){2!==e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(n):t===e.secondaryConn_?e.onSecondaryMessageReceived_(n):e.log_("message on old connection"))}},t.prototype.sendRequest=function(t){var e={t:"d",d:t}
this.sendData_(e)},t.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},t.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t
"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},t.prototype.onSecondaryMessageReceived_=function(t){var e=D("t",t),n=D("d",t)
if("c"===e)this.onSecondaryControl_(n)
else{if("d"!==e)throw new Error("Unknown protocol layer: "+e)
this.pendingDataMessages.push(n)}},t.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},t.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},t.prototype.onPrimaryMessageReceived_=function(t){var e=D("t",t),n=D("d",t)
"c"===e?this.onControl_(n):"d"===e&&this.onDataMessage_(n)},t.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},t.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},t.prototype.onControl_=function(t){var e=D("t",t)
if("d"in t){var n=t.d
if("h"===e)this.onHandshake_(n)
else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_
for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r])
this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?S("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):S("Unknown control packet command: "+e)}},t.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h
this.sessionId=t.s,this.repoInfo_.updateHost(r),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&N("Protocol version mismatch detected"),this.tryStartUpgrade_())},t.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport()
t&&this.startUpgrade_(t)},t.prototype.startUpgrade_=function(t){var e=this
this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0
var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_)
this.secondaryConn_.open(n,r),$((function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())}),Math.floor(6e4))},t.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},t.prototype.onConnectionEstablished_=function(t,e){var n=this
this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):$((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},t.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},t.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_
this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},t.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(f.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},t.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},t.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected"
this.tx_.send(t)},t.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},t.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},t}(),$e=function(){function t(){}return t.prototype.put=function(t,e,n,r){},t.prototype.merge=function(t,e,n,r){},t.prototype.refreshAuthToken=function(t){},t.prototype.onDisconnectPut=function(t,e,n){},t.prototype.onDisconnectMerge=function(t,e,n){},t.prototype.onDisconnectCancel=function(t,e){},t.prototype.reportStats=function(t){},t}(),Je=function(t){function e(n,r,i,o,a,u,h){var c=t.call(this)||this
if(c.repoInfo_=n,c.applicationId_=r,c.onDataUpdate_=i,c.onConnectStatus_=o,c.onServerInfoUpdate_=a,c.authTokenProvider_=u,c.authOverride_=h,c.id=e.nextPersistentConnectionId_++,c.log_=T("p:"+c.id+":"),c.interruptReasons_={},c.listens=new Map,c.outstandingPuts_=[],c.outstandingPutCount_=0,c.onDisconnectRequestQueue_=[],c.connected_=!1,c.reconnectDelay_=1e3,c.maxReconnectDelay_=3e5,c.securityDebugCallback_=null,c.lastSessionId=null,c.establishConnectionTimer_=null,c.visible_=!1,c.requestCBHash_={},c.requestNumber_=0,c.realtime_=null,c.authToken_=null,c.forceTokenRefresh_=!1,c.invalidAuthTokenCount_=0,c.firstConnection_=!0,c.lastConnectionAttemptTime_=null,c.lastConnectionEstablishedTime_=null,h&&!s.isNodeSdk())throw new Error("Auth override specified in options, but not supported on non Node.js platforms")
return c.scheduleConnect_(0),je.getInstance().on("visible",c.onVisible_,c),-1===n.host.indexOf("fblocal")&&Be.getInstance().on("online",c.onOnline_,c),c}return o.__extends(e,t),e.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e}
this.log_(s.stringify(i)),s.assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},e.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString()
this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),s.assert(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),s.assert(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.")
var a={onComplete:r,hashFn:e,query:t,tag:n}
this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)},e.prototype.sendListen_=function(t){var n=this,r=t.query,i=r.path.toString(),o=r.queryIdentifier()
this.log_("Listen on "+i+" for "+o)
var s={p:i}
t.tag&&(s.q=r.queryObject(),s.t=t.tag),s.h=t.hashFn(),this.sendRequest("q",s,(function(s){var a=s.d,u=s.s
e.warnOnListenWarnings_(a,r),(n.listens.get(i)&&n.listens.get(i).get(o))===t&&(n.log_("listen response",s),"ok"!==u&&n.removeListen_(i,o),t.onComplete&&t.onComplete(u,a))}))},e.warnOnListenWarnings_=function(t,e){if(t&&"object"===r(t)&&s.contains(t,"w")){var n=s.safeGet(t,"w")
if(Array.isArray(n)&&~n.indexOf("no_index")){var i='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',o=e.path.toString()
N("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+i+" at "+o+" to your security rules for better performance.")}}},e.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(t)},e.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||s.isAdmin(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},e.prototype.tryAuth=function(){var t=this
if(this.connected_&&this.authToken_){var e=this.authToken_,n=s.isValidFormat(e)?"auth":"gauth",i={cred:e}
null===this.authOverride_?i.noauth=!0:"object"===r(this.authOverride_)&&(i.authvar=this.authOverride_),this.sendRequest(n,i,(function(n){var r=n.s,i=n.d||"error"
t.authToken_===e&&("ok"===r?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(r,i))}))}},e.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier()
this.log_("Unlisten called for "+n+" "+r),s.assert(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},e.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e)
var i={p:t}
r&&(i.q=n,i.t=r),this.sendRequest("n",i)},e.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},e.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},e.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},e.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n}
this.log_("onDisconnect "+t,i),this.sendRequest(t,i,(function(t){r&&setTimeout((function(){r(t.s,t.d)}),Math.floor(0))}))},e.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},e.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},e.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n}
void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++
var s=this.outstandingPuts_.length-1
this.connected_?this.sendPut_(s):this.log_("Buffering put: "+e)},e.prototype.sendPut_=function(t){var e=this,n=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete
this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,r,(function(r){e.log_(n+" response",r),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),i&&i(r.s,r.d)}))},e.prototype.reportStats=function(t){var e=this
if(this.connected_){var n={c:t}
this.log_("reportStats",n),this.sendRequest("s",n,(function(t){if("ok"!==t.s){var n=t.d
e.log_("reportStats","Error sending stats: "+n)}}))}},e.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+s.stringify(t))
var e=t.r,n=this.requestCBHash_[e]
n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error
"a"in t&&this.onDataPush_(t.a,t.b)}},e.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):S("Unrecognized action received from server: "+s.stringify(t)+"\nAre you using the latest client?")},e.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},e.prototype.scheduleConnect_=function(t){var e=this
s.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){e.establishConnectionTimer_=null,e.establishConnection_()}),Math.floor(t))},e.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},e.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},e.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime())
var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t)
e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},e.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null
var t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+e.nextConnectionId_++,o=this,a=this.lastSessionId,u=!1,h=null,c=function(){h?h.close():(u=!0,r())}
this.realtime_={close:c,sendRequest:function(t){s.assert(h,"sendRequest call when we're not connected not allowed."),h.sendRequest(t)}}
var l=this.forceTokenRefresh_
this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(l).then((function(e){u?w("getToken() completed but was canceled"):(w("getToken() completed. Creating connection."),o.authToken_=e&&e.accessToken,h=new Xe(i,o.repoInfo_,o.applicationId_,t,n,r,(function(t){N(t+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")}),a))})).then(null,(function(t){o.log_("Failed to get token: "+t),u||(s.CONSTANTS.NODE_ADMIN&&N(t),c())}))}},e.prototype.interrupt=function(t){w("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},e.prototype.resume=function(t){w("Resuming connection for reason: "+t),delete this.interruptReasons_[t],s.isEmpty(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},e.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime()
this.onServerInfoUpdate_({serverTimeOffset:e})},e.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t]
e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},e.prototype.onListenRevoked_=function(t,e){var n
n=e?e.map((function(t){return k(t)})).join("$"):"default"
var r=this.removeListen_(t,n)
r&&r.onComplete&&r.onComplete("permission_denied")},e.prototype.removeListen_=function(t,e){var n,r=new J(t).toString()
if(this.listens.has(r)){var i=this.listens.get(r)
n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0
return n},e.prototype.onAuthRevoked_=function(t,e){w("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},e.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},e.prototype.restoreState_=function(){var t,e,n,r
this.tryAuth()
try{for(var i=o.__values(this.listens.values()),s=i.next();!s.done;s=i.next()){var a=s.value
try{for(var u=(n=void 0,o.__values(a.values())),h=u.next();!h.done;h=u.next()){var c=h.value
this.sendListen_(c)}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}for(var l=0;l<this.outstandingPuts_.length;l++)this.outstandingPuts_[l]&&this.sendPut_(l)
for(;this.onDisconnectRequestQueue_.length;){var p=this.onDisconnectRequestQueue_.shift()
this.sendOnDisconnect_(p.action,p.pathString,p.data,p.onComplete)}},e.prototype.sendConnectStats_=function(){var t={},e="js"
s.CONSTANTS.NODE_ADMIN?e="admin_node":s.CONSTANTS.NODE_CLIENT&&(e="node"),t["sdk."+e+"."+ze.replace(/\./g,"-")]=1,s.isMobileCordova()?t["framework.cordova"]=1:s.isReactNative()&&(t["framework.reactnative"]=1),this.reportStats(t)},e.prototype.shouldReconnect_=function(){var t=Be.getInstance().currentlyOnline()
return s.isEmpty(this.interruptReasons_)&&t},e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e}($e),Ze=function(t){function e(e,n,r){var i=t.call(this)||this
return i.repoInfo_=e,i.onDataUpdate_=n,i.authTokenProvider_=r,i.log_=T("p:rest:"),i.listens_={},i}return o.__extends(e,t),e.prototype.reportStats=function(t){throw new Error("Method not implemented.")},e.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(s.assert(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},e.prototype.listen=function(t,n,r,i){var o=this,a=t.path.toString()
this.log_("Listen called for "+a+" "+t.queryIdentifier())
var u=e.getListenId_(t,r),h={}
this.listens_[u]=h
var c=t.getQueryParams().toRestQueryStringParameters()
this.restRequest_(a+".json",c,(function(t,e){var n=e
404===t&&(n=null,t=null),null===t&&o.onDataUpdate_(a,n,!1,r),s.safeGet(o.listens_,u)===h&&i(t?401===t?"permission_denied":"rest_error:"+t:"ok",null)}))},e.prototype.unlisten=function(t,n){var r=e.getListenId_(t,n)
delete this.listens_[r]},e.prototype.refreshAuthToken=function(t){},e.prototype.restRequest_=function(t,e,n){var r=this
void 0===e&&(e={}),e.format="export",this.authTokenProvider_.getToken(!1).then((function(i){var o=i&&i.accessToken
o&&(e.auth=o)
var a=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+t+"?ns="+r.repoInfo_.namespace+s.querystring(e)
r.log_("Sending REST request for "+a)
var u=new XMLHttpRequest
u.onreadystatechange=function(){if(n&&4===u.readyState){r.log_("REST Response for "+a+" received. status:",u.status,"response:",u.responseText)
var t=null
if(u.status>=200&&u.status<300){try{t=s.jsonEval(u.responseText)}catch(t){N("Failed to parse JSON response for "+a+": "+u.responseText)}n(null,t)}else 401!==u.status&&404!==u.status&&N("Got unsuccessful REST response for "+a+" Status: "+u.status),n(u.status)
n=null}},u.open("GET",a,!0),u.send()}))},e}($e),tn=function(){function t(t,e,n,i){var o=this
if(this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new We,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new ue,this.persistentConnection_=null,this.stats_=Pe.getCollection(t),e||("object"===("undefined"==typeof window?"undefined":r(window))&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)this.server_=new Ze(this.repoInfo_,this.onDataUpdate_.bind(this),i),setTimeout(this.onConnectStatus_.bind(this,!0),0)
else{var a=n.options.databaseAuthVariableOverride
if(null!=a){if("object"!==r(a))throw new Error("Only objects are supported for option databaseAuthVariableOverride")
try{s.stringify(a)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new Je(this.repoInfo_,n.options.appId,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),i,a),this.server_=this.persistentConnection_}i.addTokenChangeListener((function(t){o.server_.refreshAuthToken(t)})),this.statsReporter_=Pe.getOrCreateReporter(t,(function(){return new Me(o.stats_,o.server_)})),this.transactionsInit_(),this.infoData_=new De,this.infoSyncTree_=new Oe({startListening:function(t,e,n,r){var i=[],s=o.infoData_.getNode(t.path)
return s.isEmpty()||(i=o.infoSyncTree_.applyServerOverwrite(t.path,s),setTimeout((function(){r("ok")}),0)),i},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Oe({startListening:function(t,e,n,r){return o.server_.listen(t,n,e,(function(e,n){var i=r(e,n)
o.eventQueue_.raiseEventsForChangedPath(t.path,i)})),[]},stopListening:function(t,e){o.server_.unlisten(t,e)}})}return t.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},t.prototype.name=function(){return this.repoInfo_.namespace},t.prototype.serverTime=function(){var t=this.infoData_.getNode(new J(".info/serverTimeOffset")).val()||0
return(new Date).getTime()+t},t.prototype.generateServerValues=function(){return(t=(t={timestamp:this.serverTime()})||{}).timestamp=t.timestamp||(new Date).getTime(),t
var t},t.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++
var i=new J(t)
e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e
var o=[]
if(r)if(n){var a=s.map(e,(function(t){return qt(t)}))
o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var u=qt(e)
o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,u,r)}else if(n){var h=s.map(e,(function(t){return qt(t)}))
o=this.serverSyncTree_.applyServerMerge(i,h)}else{var c=qt(e)
o=this.serverSyncTree_.applyServerOverwrite(i,c)}var l=i
o.length>0&&(l=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(l,o)},t.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},t.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},t.prototype.onServerInfoUpdate_=function(t){var e=this
F(t,(function(t,n){e.updateInfo_(t,n)}))},t.prototype.updateInfo_=function(t,e){var n=new J("/.info/"+t),r=qt(e)
this.infoData_.updateSnapshot(n,r)
var i=this.infoSyncTree_.applyServerOverwrite(n,r)
this.eventQueue_.raiseEventsForChangedPath(n,i)},t.prototype.getNextWriteId_=function(){return this.nextWriteId_++},t.prototype.setWithPriority=function(t,e,n,r){var i=this
this.log_("set",{path:t.toString(),value:e,priority:n})
var o=this.generateServerValues(),s=qt(e,n),a=this.serverSyncTree_.calcCompleteEventCache(t),u=oe(s,a,o),h=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(t,u,h,!0)
this.eventQueue_.queueEvents(c),this.server_.put(t.toString(),s.val(!0),(function(e,n){var o="ok"===e
o||N("set at "+t+" failed: "+e)
var s=i.serverSyncTree_.ackUserWrite(h,!o)
i.eventQueue_.raiseEventsForChangedPath(t,s),i.callOnCompleteCallback(r,e,n)}))
var l=this.abortTransactions_(t)
this.rerunTransactions_(l),this.eventQueue_.raiseEventsForChangedPath(l,[])},t.prototype.update=function(t,e,n){var r=this
this.log_("update",{path:t.toString(),value:e})
var i=!0,o=this.generateServerValues(),s={}
if(F(e,(function(e,n){i=!1,s[e]=ie(t.child(e),qt(n),r.serverSyncTree_,o)})),i)w("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok")
else{var a=this.getNextWriteId_(),u=this.serverSyncTree_.applyUserMerge(t,s,a)
this.eventQueue_.queueEvents(u),this.server_.merge(t.toString(),e,(function(e,i){var o="ok"===e
o||N("update at "+t+" failed: "+e)
var s=r.serverSyncTree_.ackUserWrite(a,!o),u=s.length>0?r.rerunTransactions_(t):t
r.eventQueue_.raiseEventsForChangedPath(u,s),r.callOnCompleteCallback(n,e,i)})),F(e,(function(e){var n=r.abortTransactions_(t.child(e))
r.rerunTransactions_(n)})),this.eventQueue_.raiseEventsForChangedPath(t,[])}},t.prototype.runOnDisconnectEvents_=function(){var t=this
this.log_("onDisconnectEvents")
var e=this.generateServerValues(),n=new ue
this.onDisconnect_.forEachTree(J.Empty,(function(r,i){var o=ie(r,i,t.serverSyncTree_,e)
n.remember(r,o)}))
var r=[]
n.forEachTree(J.Empty,(function(e,n){r=r.concat(t.serverSyncTree_.applyServerOverwrite(e,n))
var i=t.abortTransactions_(e)
t.rerunTransactions_(i)})),this.onDisconnect_=new ue,this.eventQueue_.raiseEventsForChangedPath(J.Empty,r)},t.prototype.onDisconnectCancel=function(t,e){var n=this
this.server_.onDisconnectCancel(t.toString(),(function(r,i){"ok"===r&&n.onDisconnect_.forget(t),n.callOnCompleteCallback(e,r,i)}))},t.prototype.onDisconnectSet=function(t,e,n){var r=this,i=qt(e)
this.server_.onDisconnectPut(t.toString(),i.val(!0),(function(e,o){"ok"===e&&r.onDisconnect_.remember(t,i),r.callOnCompleteCallback(n,e,o)}))},t.prototype.onDisconnectSetWithPriority=function(t,e,n,r){var i=this,o=qt(e,n)
this.server_.onDisconnectPut(t.toString(),o.val(!0),(function(e,n){"ok"===e&&i.onDisconnect_.remember(t,o),i.callOnCompleteCallback(r,e,n)}))},t.prototype.onDisconnectUpdate=function(t,e,n){var r=this
if(s.isEmpty(e))return w("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok")
this.server_.onDisconnectMerge(t.toString(),e,(function(i,o){"ok"===i&&F(e,(function(e,n){var i=qt(n)
r.onDisconnect_.remember(t.child(e),i)})),r.callOnCompleteCallback(n,i,o)}))},t.prototype.addEventCallbackForQuery=function(t,e){var n
n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.removeEventCallbackForQuery=function(t,e){var n
n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt("repo_interrupt")},t.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume("repo_interrupt")},t.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e
t?(this.statsListener_||(this.statsListener_=new Fe(this.stats_)),e=this.statsListener_.get()):e=this.stats_.get()
var n=Object.keys(e).reduce((function(t,e){return Math.max(e.length,t)}),0)
F(e,(function(t,e){for(var r=t,i=t.length;i<n+2;i++)r+=" "
console.log(r+e)}))}},t.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},t.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]
var n=""
this.persistentConnection_&&(n=this.persistentConnection_.id+":"),w.apply(void 0,o.__spread([n],t))},t.prototype.callOnCompleteCallback=function(t,e,n){t&&X((function(){if("ok"===e)t(null)
else{var r=(e||"error").toUpperCase(),i=r
n&&(i+=": "+n)
var o=new Error(i)
o.code=r,t(o)}}))},Object.defineProperty(t.prototype,"database",{get:function(){return this.__database||(this.__database=new dn(this))},enumerable:!1,configurable:!0}),t}(),en=function(){function t(e){this.indexedFilter_=new be(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e)}return t.prototype.getStartPost=function(){return this.startPost_},t.prototype.getEndPost=function(){return this.endPost_},t.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},t.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new Et(e,n))||(n=jt.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},t.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=jt.EMPTY_NODE)
var r=e.withIndex(this.index_)
r=r.updatePriority(jt.EMPTY_NODE)
var i=this
return e.forEachChild(At,(function(t,e){i.matches(new Et(t,e))||(r=r.updateImmediateChild(t,jt.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.indexedFilter_},t.prototype.getIndex=function(){return this.index_},t.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName()
return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},t.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName()
return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},t}(),nn=function(){function t(t){this.rangedFilter_=new en(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}return t.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new Et(e,n))||(n=jt.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},t.prototype.updateFullNode=function(t,e,n){var r
if(e.isLeafNode()||e.isEmpty())r=jt.EMPTY_NODE.withIndex(this.index_)
else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=jt.EMPTY_NODE.withIndex(this.index_)
var i=void 0
i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_)
for(var o=0;i.hasNext()&&o<this.limit_;){var s=i.getNext()
if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),s)<=0:this.index_.compare(s,this.rangedFilter_.getEndPost())<=0))break
r=r.updateImmediateChild(s.name,s.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(jt.EMPTY_NODE)
var a=void 0,u=void 0,h=void 0
if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),a=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost()
var c=this.index_.getCompare()
h=function(t,e){return c(e,t)}}else i=r.getIterator(this.index_),a=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),h=this.index_.getCompare()
o=0
for(var l=!1;i.hasNext();)s=i.getNext(),!l&&h(a,s)<=0&&(l=!0),l&&o<this.limit_&&h(s,u)<=0?o++:r=r.updateImmediateChild(s.name,jt.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},t.prototype.getIndex=function(){return this.index_},t.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o
if(this.reverse_){var a=this.index_.getCompare()
o=function(t,e){return a(e,t)}}else o=this.index_.getCompare()
var u=t
s.assert(u.numChildren()===this.limit_,"")
var h=new Et(e,n),c=this.reverse_?u.getFirstChild(this.index_):u.getLastChild(this.index_),l=this.rangedFilter_.matches(h)
if(u.hasChild(e)){for(var p=u.getImmediateChild(e),d=r.getChildAfterChild(this.index_,c,this.reverse_);null!=d&&(d.name===e||u.hasChild(d.name));)d=r.getChildAfterChild(this.index_,d,this.reverse_)
var f=null==d?1:o(d,h)
if(l&&!n.isEmpty()&&f>=0)return null!=i&&i.trackChildChange(me.childChangedChange(e,n,p)),u.updateImmediateChild(e,n)
null!=i&&i.trackChildChange(me.childRemovedChange(e,p))
var y=u.updateImmediateChild(e,jt.EMPTY_NODE)
return null!=d&&this.rangedFilter_.matches(d)?(null!=i&&i.trackChildChange(me.childAddedChange(d.name,d.node)),y.updateImmediateChild(d.name,d.node)):y}return n.isEmpty()?t:l&&o(c,h)>=0?(null!=i&&(i.trackChildChange(me.childRemovedChange(c.name,c.node)),i.trackChildChange(me.childAddedChange(e,n))),u.updateImmediateChild(e,n).updateImmediateChild(c.name,jt.EMPTY_NODE)):t},t}(),rn=function(){function t(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=At}return t.prototype.hasStart=function(){return this.startSet_},t.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},t.prototype.getIndexStartValue=function(){return s.assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},t.prototype.getIndexStartName=function(){return s.assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:A},t.prototype.hasEnd=function(){return this.endSet_},t.prototype.getIndexEndValue=function(){return s.assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},t.prototype.getIndexEndName=function(){return s.assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:R},t.prototype.hasLimit=function(){return this.limitSet_},t.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},t.prototype.getLimit=function(){return s.assert(this.limitSet_,"Only valid if limit has been set"),this.limit_},t.prototype.getIndex=function(){return this.index_},t.prototype.copy_=function(){var e=new t
return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},t.prototype.limit=function(t){var e=this.copy_()
return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},t.prototype.limitToFirst=function(e){var n=this.copy_()
return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,n},t.prototype.limitToLast=function(e){var n=this.copy_()
return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,n},t.prototype.startAt=function(t,e){var n=this.copy_()
return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},t.prototype.endAt=function(t,e){var n=this.copy_()
return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},t.prototype.orderBy=function(t){var e=this.copy_()
return e.index_=t,e},t.prototype.getQueryObject=function(){var e=t.WIRE_PROTOCOL_CONSTANTS_,n={}
if(this.startSet_&&(n[e.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(n[e.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(n[e.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(n[e.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){n[e.LIMIT]=this.limit_
var r=this.viewFrom_
""===r&&(r=this.isViewFromLeft()?e.VIEW_FROM_LEFT:e.VIEW_FROM_RIGHT),n[e.VIEW_FROM]=r}return this.index_!==At&&(n[e.INDEX]=this.index_.toString()),n},t.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},t.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===At},t.prototype.getNodeFilter=function(){return this.loadsAllData()?new be(this.getIndex()):this.hasLimit()?new nn(this):new en(this)},t.prototype.toRestQueryStringParameters=function(){var e,n=t.REST_QUERY_CONSTANTS_,r={}
return this.isDefault()||(this.index_===At?e=n.PRIORITY_INDEX:this.index_===Qt?e=n.VALUE_INDEX:this.index_===St?e=n.KEY_INDEX:(s.assert(this.index_ instanceof zt,"Unrecognized index type!"),e=this.index_.toString()),r[n.ORDER_BY]=s.stringify(e),this.startSet_&&(r[n.START_AT]=s.stringify(this.indexStartValue_),this.startNameSet_&&(r[n.START_AT]+=","+s.stringify(this.indexStartName_))),this.endSet_&&(r[n.END_AT]=s.stringify(this.indexEndValue_),this.endNameSet_&&(r[n.END_AT]+=","+s.stringify(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?r[n.LIMIT_TO_FIRST]=this.limit_:r[n.LIMIT_TO_LAST]=this.limit_)),r},t.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},t.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},t.DEFAULT=new t,t}(),on=function(t){function e(e,n){if(!(e instanceof tn))throw new Error("new Reference() no longer supported - use app.database().")
return t.call(this,e,n,rn.DEFAULT,!1)||this}return o.__extends(e,t),e.prototype.getKey=function(){return s.validateArgCount("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},e.prototype.child=function(t){return s.validateArgCount("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof J||(null===this.path.getFront()?yt("Reference.child",1,t,!1):ft("Reference.child",1,t,!1)),new e(this.repo,this.path.child(t))},e.prototype.getParent=function(){s.validateArgCount("Reference.parent",0,0,arguments.length)
var t=this.path.parent()
return null===t?null:new e(this.repo,t)},e.prototype.getRoot=function(){s.validateArgCount("Reference.root",0,0,arguments.length)
for(var t=this;null!==t.getParent();)t=t.getParent()
return t},e.prototype.databaseProp=function(){return this.repo.database},e.prototype.set=function(t,e){s.validateArgCount("Reference.set",1,2,arguments.length),gt("Reference.set",this.path),ut("Reference.set",1,t,this.path,!1),s.validateCallback("Reference.set",2,e,!0)
var n=new s.Deferred
return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},e.prototype.update=function(t,e){if(s.validateArgCount("Reference.update",1,2,arguments.length),gt("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r]
t=n,N("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ct("Reference.update",1,t,this.path,!1),s.validateCallback("Reference.update",2,e,!0)
var i=new s.Deferred
return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},e.prototype.setWithPriority=function(t,e,n){if(s.validateArgCount("Reference.setWithPriority",2,3,arguments.length),gt("Reference.setWithPriority",this.path),ut("Reference.setWithPriority",1,t,this.path,!1),lt("Reference.setWithPriority",2,e,!1),s.validateCallback("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object."
var r=new s.Deferred
return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},e.prototype.remove=function(t){return s.validateArgCount("Reference.remove",0,1,arguments.length),gt("Reference.remove",this.path),s.validateCallback("Reference.remove",1,t,!0),this.set(null,t)},e.prototype.transaction=function(t,e,n){if(s.validateArgCount("Reference.transaction",1,3,arguments.length),gt("Reference.transaction",this.path),s.validateCallback("Reference.transaction",1,t,!1),s.validateCallback("Reference.transaction",2,e,!0),vt("Reference.transaction",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object."
void 0===n&&(n=!0)
var r=new s.Deferred
"function"==typeof e&&r.promise.catch((function(){}))
var i=function(t,n,i){t?r.reject(t):r.resolve(new bt(n,i)),"function"==typeof e&&e(t,n,i)}
return this.repo.startTransaction(this.path,t,i,n),r.promise},e.prototype.setPriority=function(t,e){s.validateArgCount("Reference.setPriority",1,2,arguments.length),gt("Reference.setPriority",this.path),lt("Reference.setPriority",1,t,!1),s.validateCallback("Reference.setPriority",2,e,!0)
var n=new s.Deferred
return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},e.prototype.push=function(t,e){s.validateArgCount("Reference.push",0,2,arguments.length),gt("Reference.push",this.path),ut("Reference.push",1,t,this.path,!0),s.validateCallback("Reference.push",2,e,!0)
var n,r=this.repo.serverTime(),i=Ct(r),o=this.child(i),a=this.child(i)
return n=null!=t?o.set(t,e).then((function(){return a})):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch((function(){})),o},e.prototype.onDisconnect=function(){return gt("Reference.onDisconnect",this.path),new mt(this.repo,this.path)},Object.defineProperty(e.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),e}(Jt)

;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Jt.__referenceConstructor=on,xe.__referenceConstructor=on

;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var sn,an=function(){this.children={},this.childCount=0,this.value=null},un=function(){function t(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new an),this.name_=t,this.parent_=e,this.node_=n}return t.prototype.subTree=function(e){for(var n=e instanceof J?e:new J(e),r=this,i=n.getFront();null!==i;)r=new t(i,r,s.safeGet(r.node_.children,i)||new an),i=(n=n.popFront()).getFront()
return r},t.prototype.getValue=function(){return this.node_.value},t.prototype.setValue=function(t){s.assert(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},t.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},t.prototype.hasChildren=function(){return this.node_.childCount>0},t.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},t.prototype.forEachChild=function(e){var n=this
F(this.node_.children,(function(r,i){e(new t(r,n,i))}))},t.prototype.forEachDescendant=function(t,e,n){e&&!n&&t(this),this.forEachChild((function(e){e.forEachDescendant(t,!0,n)})),e&&n&&t(this)},t.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0
n=n.parent()}return!1},t.prototype.forEachImmediateDescendantWithValue=function(t){this.forEachChild((function(e){null!==e.getValue()?t(e):e.forEachImmediateDescendantWithValue(t)}))},t.prototype.path=function(){return new J(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},t.prototype.name=function(){return this.name_},t.prototype.parent=function(){return this.parent_},t.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},t.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=s.contains(this.node_.children,t)
n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},t}()
!function(t){t[t.RUN=0]="RUN",t[t.SENT=1]="SENT",t[t.COMPLETED=2]="COMPLETED",t[t.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",t[t.NEEDS_ABORT=4]="NEEDS_ABORT"}(sn||(sn={})),tn.MAX_TRANSACTION_RETRIES_=25,tn.prototype.transactionsInit_=function(){this.transactionQueueTree_=new un},tn.prototype.startTransaction=function(t,e,n,i){this.log_("transaction on "+t)
var o=function(){},a=new on(this,t)
a.on("value",o)
var u={path:t,update:e,onComplete:n,status:null,order:_(),applyLocally:i,retryCount:0,unwatcher:function(){a.off("value",o)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},h=this.getLatestState_(t)
u.currentInputSnapshot=h
var c=u.update(h.val())
if(void 0===c){if(u.unwatcher(),u.currentOutputSnapshotRaw=null,u.currentOutputSnapshotResolved=null,u.onComplete){var l=new Yt(u.currentInputSnapshot,new on(this,u.path),At)
u.onComplete(null,!1,l)}}else{ht("transaction failed: Data returned ",c,u.path),u.status=sn.RUN
var p=this.transactionQueueTree_.subTree(t),d=p.getValue()||[]
d.push(u),p.setValue(d)
var f=void 0
"object"===r(c)&&null!==c&&s.contains(c,".priority")?(f=s.safeGet(c,".priority"),s.assert(at(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(this.serverSyncTree_.calcCompleteEventCache(t)||jt.EMPTY_NODE).getPriority().val(),f=f
var y=this.generateServerValues(),g=qt(c,f),v=oe(g,h,y)
u.currentOutputSnapshotRaw=g,u.currentOutputSnapshotResolved=v,u.currentWriteId=this.getNextWriteId_()
var m=this.serverSyncTree_.applyUserOverwrite(t,v,u.currentWriteId,u.applyLocally)
this.eventQueue_.raiseEventsForChangedPath(t,m),this.sendReadyTransactions_()}},tn.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||jt.EMPTY_NODE},tn.prototype.sendReadyTransactions_=function(t){var e=this
if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t)
s.assert(n.length>0,"Sending zero length transaction queue"),n.every((function(t){return t.status===sn.RUN}))&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild((function(t){e.sendReadyTransactions_(t)}))},tn.prototype.sendTransactionQueue_=function(t,e){for(var n=this,r=e.map((function(t){return t.currentWriteId})),i=this.getLatestState_(t,r),o=i,a=i.hash(),u=0;u<e.length;u++){var h=e[u]
s.assert(h.status===sn.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=sn.SENT,h.retryCount++
var c=J.relativePath(t,h.path)
o=o.updateChild(c,h.currentOutputSnapshotRaw)}var l=o.val(!0),p=t
this.server_.put(p.toString(),l,(function(r){n.log_("transaction put response",{path:p.toString(),status:r})
var i=[]
if("ok"===r){for(var o=[],s=0;s<e.length;s++){if(e[s].status=sn.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(e[s].currentWriteId)),e[s].onComplete){var a=e[s].currentOutputSnapshotResolved,u=new on(n,e[s].path),h=new Yt(a,u,At)
o.push(e[s].onComplete.bind(null,null,!0,h))}e[s].unwatcher()}for(n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(t)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(t,i),s=0;s<o.length;s++)X(o[s])}else{if("datastale"===r)for(s=0;s<e.length;s++)e[s].status===sn.SENT_NEEDS_ABORT?e[s].status=sn.NEEDS_ABORT:e[s].status=sn.RUN
else for(N("transaction at "+p.toString()+" failed: "+r),s=0;s<e.length;s++)e[s].status=sn.NEEDS_ABORT,e[s].abortReason=r
n.rerunTransactions_(t)}}),a)},tn.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e)
return this.rerunTransactionQueue_(r,n),n},tn.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,i=[],o=[],a=t.filter((function(t){return t.status===sn.RUN})).map((function(t){return t.currentWriteId})),u=0;u<t.length;u++){var h=t[u],c=J.relativePath(e,h.path),l=!1,p=void 0
if(s.assert(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),h.status===sn.NEEDS_ABORT)l=!0,p=h.abortReason,o=o.concat(this.serverSyncTree_.ackUserWrite(h.currentWriteId,!0))
else if(h.status===sn.RUN)if(h.retryCount>=tn.MAX_TRANSACTION_RETRIES_)l=!0,p="maxretry",o=o.concat(this.serverSyncTree_.ackUserWrite(h.currentWriteId,!0))
else{var d=this.getLatestState_(h.path,a)
h.currentInputSnapshot=d
var f=t[u].update(d.val())
if(void 0!==f){ht("transaction failed: Data returned ",f,h.path)
var y=qt(f)
"object"===r(f)&&null!=f&&s.contains(f,".priority")||(y=y.updatePriority(d.getPriority()))
var g=h.currentWriteId,_=this.generateServerValues(),v=oe(y,d,_)
h.currentOutputSnapshotRaw=y,h.currentOutputSnapshotResolved=v,h.currentWriteId=this.getNextWriteId_(),a.splice(a.indexOf(g),1),o=(o=o.concat(this.serverSyncTree_.applyUserOverwrite(h.path,v,h.currentWriteId,h.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(g,!0))}else l=!0,p="nodata",o=o.concat(this.serverSyncTree_.ackUserWrite(h.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,o),o=[],l&&(t[u].status=sn.COMPLETED,n=t[u].unwatcher,setTimeout(n,Math.floor(0)),t[u].onComplete))if("nodata"===p){var m=new on(this,t[u].path),b=t[u].currentInputSnapshot,C=new Yt(b,m,At)
i.push(t[u].onComplete.bind(null,null,!1,C))}else i.push(t[u].onComplete.bind(null,new Error(p),!1,null))}for(this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_),u=0;u<i.length;u++)X(i[u])
this.sendReadyTransactions_()}},tn.prototype.getAncestorTransactionNode_=function(t){var e,n=this.transactionQueueTree_
for(e=t.getFront();null!==e&&null===n.getValue();)n=n.subTree(e),e=(t=t.popFront()).getFront()
return n},tn.prototype.buildTransactionQueue_=function(t){var e=[]
return this.aggregateTransactionQueuesForNode_(t,e),e.sort((function(t,e){return t.order-e.order})),e},tn.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue()
if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i])
t.forEachChild((function(t){n.aggregateTransactionQueuesForNode_(t,e)}))},tn.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue()
if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==sn.COMPLETED&&(n[r]=n[i],r++)
n.length=r,t.setValue(n.length>0?n:null)}t.forEachChild((function(t){e.pruneCompletedTransactionsBelowNode_(t)}))},tn.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t)
return r.forEachAncestor((function(t){e.abortTransactionsOnNode_(t)})),this.abortTransactionsOnNode_(r),r.forEachDescendant((function(t){e.abortTransactionsOnNode_(t)})),n},tn.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue()
if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)e[o].status===sn.SENT_NEEDS_ABORT||(e[o].status===sn.SENT?(s.assert(i===o-1,"All SENT items should be at beginning of queue."),i=o,e[o].status=sn.SENT_NEEDS_ABORT,e[o].abortReason="set"):(s.assert(e[o].status===sn.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete&&n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))))
for(-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r),o=0;o<n.length;o++)X(n[o])}}

;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var hn,cn=function(){function t(t,e){var n=this
this.app_=t,this.authProvider_=e,this.auth_=null,this.auth_=e.getImmediate({optional:!0}),this.auth_||e.get().then((function(t){return n.auth_=t}))}return t.prototype.getToken=function(t){return this.auth_?this.auth_.getToken(t).catch((function(t){return t&&"auth/token-not-initialized"===t.code?(w("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})):Promise.resolve(null)},t.prototype.addTokenChangeListener=function(t){this.auth_?this.auth_.addAuthTokenListener(t):(setTimeout((function(){return t(null)}),0),this.authProvider_.get().then((function(e){return e.addAuthTokenListener(t)})))},t.prototype.removeTokenChangeListener=function(t){this.authProvider_.get().then((function(e){return e.removeAuthTokenListener(t)}))},t.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. '
"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',N(t)},t}(),ln=function(){function t(){}return t.prototype.getToken=function(e){return Promise.resolve({accessToken:t.EMULATOR_AUTH_TOKEN})},t.prototype.addTokenChangeListener=function(e){e(t.EMULATOR_AUTH_TOKEN)},t.prototype.removeTokenChangeListener=function(t){},t.prototype.notifyForInvalidToken=function(){},t.EMULATOR_AUTH_TOKEN="owner",t}(),pn=function(){function t(){this.repos_={},this.useRestClient_=!1}return t.getInstance=function(){return hn||(hn=new t),hn},t.prototype.interrupt=function(){var t,e,n,r
try{for(var i=o.__values(Object.keys(this.repos_)),s=i.next();!s.done;s=i.next()){var a=s.value
try{for(var u=(n=void 0,o.__values(Object.keys(this.repos_[a]))),h=u.next();!h.done;h=u.next()){var c=h.value
this.repos_[a][c].interrupt()}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},t.prototype.resume=function(){var t,e,n,r
try{for(var i=o.__values(Object.keys(this.repos_)),s=i.next();!s.done;s=i.next()){var a=s.value
try{for(var u=(n=void 0,o.__values(Object.keys(this.repos_[a]))),h=u.next();!h.done;h=u.next()){var c=h.value
this.repos_[a][c].resume()}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},t.prototype.databaseFromApp=function(t,e,n){var r=n||t.options.databaseURL
void 0===r&&(t.options.projectId||I("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),w("Using default host for project ",t.options.projectId),r=t.options.projectId+"-default-rtdb.firebaseio.com")
var i,o=et(r),a=o.repoInfo,u=void 0
"undefined"!=typeof process&&(u=process.env.FIREBASE_DATABASE_EMULATOR_HOST),u?(i=!0,r="http://"+u+"?ns="+a.namespace,a=(o=et(r)).repoInfo):i=!o.repoInfo.secure
var h=s.CONSTANTS.NODE_ADMIN&&i?new ln:new cn(t,e)
return _t("Invalid Firebase Database URL",1,o),o.path.isEmpty()||I("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(a,t,h).database},t.prototype.deleteRepo=function(t){var e=s.safeGet(this.repos_,t.app.name)
e&&s.safeGet(e,t.repoInfo_.toURLString())===t||I("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},t.prototype.createRepo=function(t,e,n){var r=s.safeGet(this.repos_,e.name)
r||(r={},this.repos_[e.name]=r)
var i=s.safeGet(r,t.toURLString())
return i&&I("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new tn(t,this.useRestClient_,e,n),r[t.toURLString()]=i,i},t.prototype.forceRestClient=function(t){this.useRestClient_=t},t}(),dn=function(){function t(t){this.repo_=t,t instanceof tn||I("Don't call new Database() directly - please use firebase.database()."),this.root_=new on(t,J.Empty),this.INTERNAL=new fn(this)}return Object.defineProperty(t.prototype,"app",{get:function(){return this.repo_.app},enumerable:!1,configurable:!0}),t.prototype.ref=function(t){return this.checkDeleted_("ref"),s.validateArgCount("database.ref",0,1,arguments.length),t instanceof on?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},t.prototype.refFromURL=function(t){var e="database.refFromURL"
this.checkDeleted_(e),s.validateArgCount(e,1,1,arguments.length)
var n=et(t)
_t(e,1,n)
var r=n.repoInfo
return r.host!==this.repo_.repoInfo_.host&&I(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},t.prototype.checkDeleted_=function(t){null===this.repo_&&I("Cannot call "+t+" on a deleted database.")},t.prototype.goOffline=function(){s.validateArgCount("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},t.prototype.goOnline=function(){s.validateArgCount("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},t.ServerValue={TIMESTAMP:{".sv":"timestamp"},increment:function(t){return{".sv":{increment:t}}}},t}(),fn=function(){function t(t){this.database=t}return t.prototype.delete=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){return this.database.checkDeleted_("delete"),pn.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]}))}))},t}(),yn=Object.freeze({__proto__:null,forceLongPolling:function(){Ke.forceDisallow(),Ve.forceAllow()},forceWebSockets:function(){Ve.forceDisallow()},isWebSocketsAvailable:function(){return Ke.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),gn=Je
Je.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Je.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)}
var _n=Xe,vn=tt,mn=Object.freeze({__proto__:null,DataConnection:gn,RealTimeConnection:_n,hijackHash:function(t){var e=Je.prototype.put
return Je.prototype.put=function(n,r,i,o){void 0!==o&&(o=t()),e.call(this,n,r,i,o)},function(){Je.prototype.put=e}},ConnectionTarget:vn,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){pn.getInstance().forceRestClient(t)}}),bn=dn.ServerValue
function Cn(e){!function(t){ze=t}(e.SDK_VERSION)
var n=e.INTERNAL.registerComponent(new u.Component("database",(function(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal")
return pn.getInstance().databaseFromApp(n,r,e)}),"PUBLIC").setServiceProps({Reference:on,Query:Jt,Database:dn,DataSnapshot:Yt,enableLogging:E,INTERNAL:yn,ServerValue:bn,TEST_ACCESS:mn}).setMultipleInstances(!0))
e.registerVersion("@firebase/database","0.6.12"),s.isNodeSdk()&&(t.exports=n)}Cn(c.default),e.DataSnapshot=Yt,e.Database=dn,e.OnDisconnect=mt,e.Query=Jt,e.Reference=on,e.ServerValue=bn,e.enableLogging=E,e.registerDatabase=Cn}}])

//# sourceMappingURL=chunk.3.9f8dce6025313dad6932-355bf8d168a0c1038d64145503c043ef.map